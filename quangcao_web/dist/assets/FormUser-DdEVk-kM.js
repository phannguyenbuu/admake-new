import{l as i,n as F,r as c,q as K,s as e,B as v,at as Q,v as G,t as k}from"./index-DNMvp0xH.js";import{d as W,e as Y}from"./dashboard-CSIkuXrI.js";import{F as r,l as b,C as l,I as d}from"./index-C7VIqwt4.js";import{T as M,S as U,s as p}from"./TitlePanel-JyalwT5X.js";import{T as O}from"./JobAsset-CEaj8SAH.js";const V={getAll:()=>i.get("/setting/get-setting"),update:a=>i.put("/setting/update-setting",a),updateStandardWorkingDays:a=>i.put("/setting/update-standard-working-days",a)},X="setting/queryAll";function R(){return F({queryKey:[X],queryFn:()=>V.getAll()})}const J={getAll:()=>i.get("/role/"),getId:a=>i.get(`/role/${a}`),getPermission:()=>i.get("/role/list/permission/"),create:a=>i.post("/role/",a),update:(a,o)=>i.put(`/role/${a}`,o),delete:a=>i.delete(`/role/${a}`)},Z="role/queryPagination";function ee(){return F({queryKey:[Z],queryFn:()=>J.getAll()})}function me({onCancel:a,onRefresh:o,user:t,buttonText:I,isSupplier:m,isAppend:q}){var T;const[y]=r.useForm(),[E,se]=c.useState(null),[te,ae]=c.useState(!1),h=c.useRef(null),{mutate:L,isPending:f}=W(),{mutate:_,isPending:N}=Y(),{data:j}=R(),{data:x}=ee(),{userLeadId:C}=K(),[$,S]=c.useState(0);c.useEffect(()=>{h.current&&S(h.current.offsetWidth);function s(){h.current&&S(h.current.offsetWidth)}return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const B=((T=j==null?void 0:j.find(s=>s.key==="salary_level"))==null?void 0:T.value)||[],w=x==null?void 0:x.find(s=>{var n;return s.id===((n=t==null?void 0:t.role)==null?void 0:n.id)}),A=!!t,D=(Array.isArray(x)&&x||[]).map(s=>({label:s.name,value:s.id}));B.map(s=>({label:`Bậc ${s.index} - ${s.salary.toLocaleString("vi-VN")} VNĐ`,value:s.index}));const P=()=>I||(A?"Cập nhật":"Tạo");c.useEffect(()=>{var s;t?y.setFieldsValue({lead_id:C,fullName:t.fullName,phone:t.phone,username:t.username,password:t.password,role_id:m?101:w?w.id:(s=t.role)==null?void 0:s.id,salary:t.salary,gender:t.gender,address:t.address,citizenId:t.citizenId,email:t.email,facebookAccount:t.facebookAccount,bankAccount:t.bankAccount,referrer:t.referrer}):y.resetFields()},[t,y,w]);const z=()=>{t&&fetch(`${G()}/user/${t.id}`,{method:"DELETE"}).then(s=>{s.ok||k.error({message:"Xóa user thất bại"}),k.success({message:`User ${t.fullName} đã được xóa`}),o&&o(),a&&a()}).catch(s=>{k.error({message:"Lỗi khi xóa user:",description:s}),a&&a()})},H=async s=>{try{const n=new FormData;console.log("Role",m,s),Object.entries(s).forEach(([g,u])=>{g==="avatar"&&E?n.append(g,E):u!=null&&n.append(g,u.toString())}),m&&n.append("role_id","101"),s.password&&s.password.trim()!==""&&n.append("password",s.password),n.append("lead_id",C.toString()),console.log("Create User");for(const[g,u]of n.entries())console.log(`${g}:`,u);A&&t?_({dto:n,id:t.id},{onSuccess:()=>{p.success("Cập nhật người dùng thành công!"),a(),o==null||o()},onError:()=>p.error("Có lỗi xảy ra khi cập nhật người dùng!")}):L(n,{onSuccess:()=>{p.success("Tạo người dùng thành công!"),a(),o==null||o()},onError:()=>p.error("Có lỗi xảy ra khi tạo người dùng!")})}catch{p.error("Có lỗi xảy ra!")}};return e.jsxs("div",{ref:h,className:`
        w-full max-w-4xl mx-auto bg-white rounded-lg sm:rounded-xl lg:rounded-2xl
        shadow-lg sm:shadow-xl lg:shadow-2xl p-3 sm:p-4 border border-gray-100
        flex flex-col overflow-hidden
        max-h-[calc(100vh-200px)] -mt-13 sm:max-h-[calc(100vh-120px)]
      `,children:[e.jsx(v,{type:"text",icon:e.jsx(Q,{}),onClick:a,style:{position:"relative",marginLeft:$-60},size:"small"}),e.jsx(M.Title,{level:3,className:"text-center !text-[#00B4B6] !mb-4 sm:mb-6 !font-bold !text-lg sm:!text-xl lg:!text-2xl flex-shrink-0",children:m?"BẢNG THẦU PHỤ":"BẢNG NHÂN SỰ"}),e.jsxs(r,{form:y,layout:"vertical",onFinish:H,autoComplete:"off",className:"flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto space-y-3 sm:space-y-4 pr-2 scrollbar-thin scrollbar-thumb-cyan-500 scrollbar-track-gray-100 hover:scrollbar-thumb-cyan-600",children:[e.jsxs(b,{gutter:[16,16],children:[e.jsx(l,{xs:24,sm:12,lg:12,children:e.jsx(r.Item,{name:"fullName",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Họ và tên:"}),rules:[{required:!0,message:"Nhập họ tên nhân sự"}],className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập họ tên nhân sự",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})}),e.jsx(l,{xs:24,sm:12,lg:12,children:e.jsx(r.Item,{name:"phone",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Số điện thoại:"}),rules:[{required:!0,message:"Nhập số điện thoại"}],className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập số điện thoại",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})})]}),!m&&e.jsxs(b,{gutter:[16,16],children:[e.jsx(l,{xs:24,sm:12,lg:12,children:e.jsx(r.Item,{name:"role_id",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Chức vụ:"}),rules:[{required:!0,message:"Chọn chức vụ"}],className:"!mb-0",children:e.jsx(U,{placeholder:"Chọn chức vụ",options:D,showSearch:!0,allowClear:!0,optionFilterProp:"label",getPopupContainer:()=>document.body,dropdownStyle:{zIndex:1e4},className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})}),e.jsx(l,{xs:24,sm:12,lg:12,children:e.jsx(r.Item,{name:"salary",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Lương:"}),className:"!mb-0",children:e.jsx(O,{style:{width:"100%"},placeholder:"Nhập số tiền lương",formatter:s=>s?s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".").replace(",",","):"",parser:s=>s?s.replace(/\./g,"").replace(",","."):""})})})]}),e.jsxs(b,{gutter:[16,16],children:[e.jsx(l,{xs:24,sm:12,lg:12,children:e.jsx(r.Item,{name:"gender",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Giới tính:"}),className:"!mb-0",children:e.jsx(U,{placeholder:"Chọn giới tính",options:[{label:"Nam",value:"male"},{label:"Nữ",value:"female"},{label:"Khác",value:"other"}],allowClear:!0,getPopupContainer:()=>document.body,className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})}),e.jsx(l,{xs:24,sm:12,lg:12,children:e.jsx(r.Item,{name:"address",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Địa chỉ:"}),className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập địa chỉ",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})})]}),e.jsxs(b,{gutter:[16,16],children:[e.jsx(l,{xs:24,sm:12,lg:12,children:e.jsx(r.Item,{name:"citizenId",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Căn cước công dân:"}),className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập số căn cước",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})}),e.jsx(l,{xs:24,sm:12,lg:12,children:e.jsx(r.Item,{name:"email",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Email:"}),className:"!mb-0",rules:[{type:"email",message:"Email không hợp lệ"}],children:e.jsx(d,{placeholder:"Nhập email",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})})]}),e.jsxs(b,{gutter:[16,16],children:[e.jsx(l,{xs:24,sm:12,lg:8,children:e.jsx(r.Item,{name:"bankAccount",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Tài khoản ngân hàng:"}),className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập tài khoản ngân hàng",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})}),e.jsx(l,{xs:24,sm:12,lg:8,children:e.jsx(r.Item,{name:"facebookAccount",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Tài khoản facebook:"}),className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập tài khoản facebook",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})}),e.jsx(l,{xs:24,sm:12,lg:8,children:e.jsx(r.Item,{name:"taxCode",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Mã số thuế cá nhân:"}),className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập mã số thuế cá nhân",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})}),e.jsx(l,{xs:24,sm:12,lg:8,children:e.jsx(r.Item,{name:"referrer",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Người giới thiệu:"}),className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập tên người giới thiệu",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-3 sm:gap-4 lg:gap-6 mt-4 sm:mt-6 flex-shrink-0",children:[!q&&e.jsx(v,{onClick:z,disabled:f||N,className:"!border-cyan-400 !text-cyan-500 !text-sm sm:!text-base !font-semibold !px-6 sm:!px-8 !py-2 sm:!py-3 !h-9 sm:!h-10 !min-w-[100px] sm:!min-w-[120px] !rounded-lg hover:!bg-cyan-50 hover:!border-cyan-500 !transition-all !duration-300 !shadow-lg hover:!shadow-xl !order-2 sm:!order-1",children:m?"XÓA THẦU PHỤ":"XÓA NHÂN SỰ"}),e.jsx(v,{type:"primary",htmlType:"submit",loading:f||N,className:"!bg-cyan-500 !border-cyan-500 !text-white !text-sm sm:!text-base !font-semibold !px-6 sm:!px-8 !py-2 sm:!py-3 !h-9 sm:!h-10 !min-w-[100px] sm:!min-w-[120px] !rounded-lg hover:!bg-cyan-600 hover:!border-cyan-600 !transition-all !duration-300 !shadow-xl hover:!shadow-2xl hover:!scale-105 !order-1 sm:!order-2",children:f||N?"Đang xử lý...":P()})]})]})]})}export{me as F};
