import{r as c,bX as vn,c as Sn,v as wn,j as n,q as Y,T as P,p as A,f as rn}from"./index-BOs83NHc.js";import{M as _n,a as kn}from"./TitlePanel-B4MphDSI.js";import{J as on,d as Wn}from"./JobAsset-B5-JC0zL.js";import{T as Mn,a as E}from"./Tabs-C2J7iBc_.js";import{T as G,a as I,d as F,b as d,c as t}from"./TableRow-DtffpQev.js";function Dn(s,g){const y=new Date(s);return y.setHours(g+7,0,0,0),y.toString()}function ln(s){return s.in?1:0}function U(s,g){if(!s.in)return 0;if(!(s!=null&&s.out)){s.out={img:"",lat:s.in.lat,long:s.in.long,time:Dn(s.in.time,g)};const p=(new Date(s.out.time).getTime()-new Date(s.in.time).getTime())/(1e3*60*60);s.workhour=p}return s!=null&&s.workhour&&s.workhour>1?s.workhour:0}const x=s=>s.toLocaleString("en-US",{maximumFractionDigits:0}),On=({selectedRecord:s,modalVisible:g,handleOk:y})=>{const[p,L]=c.useState(0),[N,cn]=c.useState(0),[$,hn]=c.useState(0),[b,dn]=c.useState(0),[Bn,xn]=c.useState(0),[k,z]=c.useState(0),[J,V]=c.useState(0),[q,K]=c.useState(0),[X,Q]=c.useState(0),{workpointSetting:r}=vn(),Z=(r==null?void 0:r.multiply_in_night_overtime)||0,{isMobile:h}=Sn(),W=new Date;W.getMonth();const[R,un]=c.useState([]),{taskDetail:T,setTaskDetail:jn}=wn(),[H,nn]=c.useState([0,0,0,0,0]),[S,fn]=c.useState(0),[gn,yn]=c.useState(0),[En,pn]=c.useState(0);c.useEffect(()=>{T||(async()=>{try{const a=await fetch(`${rn()}/task/${s==null?void 0:s.user_id}/salary`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error("Network response was not ok "+a.statusText);const o=await a.json();jn(o.infor),nn(o.rates),console.log("Salary tasks data:",o)}catch(a){console.error("Fetch error:",a)}})()},[s,g]),c.useEffect(()=>{if(!T||!T.assets){xn(0),z(0),V(0),K(0),Q(0),nn([0,0,0,0,0]);return}let e=0,a=0,o=0;T.assets.forEach(i=>{if(i.text!==""&&i.text)if(i.type==="bonus-cash"){const l=Number(i.text.split("/")[0].replace(/\./g,""));e+=l>0?l:0,o+=l<0?l:0}else i.type==="advance-salary-cash"&&(a+=Number(i.text.split("/")[0].replace(/\./g,"")))}),V(a),K(o),Q(e)},[T]);const mn=(e,a)=>{fn(a)},tn=!window.location.href.includes("/point/"),Tn=async()=>{const e=await fetch(`${rn()}/task/${s==null?void 0:s.user_id}/by_user`);if(!e.ok)throw console.log("Error in fetching"),new Error(`Error fetching tasks for user ${s==null?void 0:s.user_id}`);const a=await e.json(),o=a.data??[],i=a.reward??[],l=o.filter(u=>{if(!u.end_time||u.status!=="REWARD")return!1;const v=Wn(u.end_time).toDate(),B=new Date;return v.getMonth()===B.getMonth()&&v.getFullYear()===B.getFullYear()});un(i);const w=i.reduce((u,v)=>u+(v.reward||0),0);return z(w),l};function bn(e,a){const o=new Date(a,e,0).getDate();let i=0;for(let l=1;l<=o;l++){const u=new Date(a,e-1,l).getDay();u===0?i+=r!=null&&r.work_in_sunday?8:0:u===6?i+=r!=null&&r.work_in_saturday_noon?8:4:i+=8}return i}function M(e,a){const[o,i]=e.split(":").map(Number),l=new Date(a);return l.setHours(o,i,0,0),l}function sn(e){if(e===void 0)return"00:00";const a=Math.floor(e),o=Math.round((e-a)*60);return`${a.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`}c.useEffect(()=>{if(!s)return;const e={morning:{start:r==null?void 0:r.morning_in_hour,end:r==null?void 0:r.morning_out_hour},noon:{start:r==null?void 0:r.noon_in_hour,end:r==null?void 0:r.noon_in_hour}},a=bn(W.getMonth()+1,W.getFullYear());let o=0,i=0,l=0,w=0,u=0;s.items&&s.items.forEach(B=>{const j=B.checklist;j&&(j.morning&&(o+=U(j.morning,12),l+=ln(j.morning)),j.noon&&(o+=U(j.noon,17),l+=ln(j.noon)),j.evening&&(i+=U(j.evening,22)),["morning","noon"].forEach(O=>{const f=O==="morning"?j.morning:j.noon;if(!f)return;const en=M(sn(O==="morning"?e.morning.start:e.noon.start),f.day),an=M(sn(O==="morning"?e.morning.end:e.noon.end),f.day);if(f.in&&f.in.time){const _=M(f.in.time,f.day);_>en&&(w+=(_.getTime()-en.getTime())/6e4)}if(f.out&&f.out.time){const _=M(f.out.time,f.day);_<an&&(u+=(an.getTime()-_.getTime())/6e4)}}))}),yn(w),pn(u),L(o),cn(l),hn(i);const v=s.salary/a;dn(v),Tn()},[s,g]);const m={fontStyle:"italic",color:"red"},D={fontSize:10,minWidth:70,maxWidth:70,paddingLeft:h?0:50,paddingRight:h?0:50,whiteSpace:h?"wrap":"nowrap",borderLeft:"1px solid #666"};return n.jsx(_n,{open:g,onOk:y,onCancel:y,footer:null,title:"",okText:"OK",cancelButtonProps:{style:{display:"none"}},children:n.jsx(kn,{children:n.jsxs(Y,{sx:{width:"100%"},children:[n.jsxs(Y,{sx:{width:250,borderRadius:1,backgroundColor:"#00B4B6",px:1,py:1,mb:0,position:"relative","&:after":{content:'""',position:"absolute",right:-26,top:"50%",transform:"translateY(-50%)",width:0,height:0,borderTop:"28px solid transparent",borderBottom:"28px solid transparent",borderLeft:"28px solid #00B4B6"}},children:[n.jsxs(P,{sx:{textTransform:"uppercase",color:"#ccc",fontSize:12,fontWeight:500},children:["BẢNG LƯƠNG THÁNG ",W.getMonth()+1]}),n.jsx(P,{sx:{textTransform:"uppercase",color:"#fff"},children:s==null?void 0:s.username.toUpperCase()})]}),n.jsxs(Mn,{value:S,onChange:mn,"aria-label":"nav tabs example",variant:h?"scrollable":"standard",scrollButtons:"auto",style:{marginTop:10},children:[n.jsx(E,{style:D,label:"Lương",id:"nav-tab-0","aria-controls":"nav-tabpanel-0"}),n.jsx(E,{style:D,label:"Thưởng Phạt",id:"nav-tab-1","aria-controls":"nav-tabpanel-1"}),n.jsx(E,{style:D,label:"Chuyên Cần",id:"nav-tab-2","aria-controls":"nav-tabpanel-2"}),n.jsx(E,{style:D,label:"Ứng Tiền",id:"nav-tab-3","aria-controls":"nav-tabpanel-3"})]}),n.jsxs(C,{value:S,index:0,children:[n.jsx(G,{component:A,sx:{mt:h?0:2,ml:h?-10:0,width:h?400:"100%",scale:h?.75:1},children:n.jsx(I,{style:{padding:0},children:n.jsxs(F,{children:[n.jsxs(d,{children:[n.jsx(t,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(t,{style:{fontWeight:700},children:"Giá trị"}),n.jsx(t,{style:{fontWeight:700},children:"Lương/ĐVT"}),n.jsx(t,{style:{fontWeight:700},children:"Thành tiền"})]}),n.jsxs(d,{children:[n.jsx(t,{children:"Số buổi làm"}),n.jsx(t,{children:N}),n.jsxs(t,{children:[x(b*4)," ₫"]}),n.jsxs(t,{children:[x(b*4*N)," ₫"]})]}),n.jsxs(d,{children:[n.jsx(t,{children:"Số giờ làm"}),n.jsx(t,{children:p.toLocaleString()}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"})]}),n.jsxs(d,{children:[n.jsx(t,{children:"Tổng giờ tăng ca"}),n.jsx(t,{children:$.toFixed(3)}),n.jsxs(t,{children:[x(b*Z)," ₫"]}),n.jsxs(t,{children:[x(b*Z*$)," ₫"]})]}),n.jsxs(d,{children:[n.jsx(t,{children:"Tổng phụ cấp"}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[x(k)," ₫"]})]}),n.jsxs(d,{children:[n.jsx(t,{children:"Tổng thưởng"}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[x(X)," ₫"]})]}),n.jsxs(d,{children:[n.jsx(t,{children:"Tổng phạt"}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[x(q)," ₫"]})]}),n.jsxs(d,{children:[n.jsx(t,{children:"Tạm ứng"}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[x(J)," ₫"]})]})]})})}),n.jsxs(P,{style:{marginTop:20,textAlign:"center",color:"#00B5B4"},children:["Tổng lương: ",x(b*4*N+b*1.5*$+k+X+q+J)," ₫"]})]}),n.jsxs(C,{value:S,index:1,children:[n.jsx(G,{component:A,sx:{mt:h?0:2,ml:h?-10:0,width:h?400:"100%",scale:h?.75:1},children:n.jsx(I,{style:{padding:0},children:n.jsxs(F,{children:[n.jsxs(d,{children:[n.jsx(t,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(t,{style:{fontWeight:700},children:"Giá trị"}),n.jsx(t,{style:{fontWeight:700},children:"Lương/ĐVT"}),n.jsx(t,{style:{fontWeight:700},children:"Thành tiền"})]}),n.jsxs(d,{children:[n.jsx(t,{children:"Thưởng theo việc"}),n.jsxs(t,{children:[x(k)," ₫"]}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[x(k)," ₫"]})]}),R.map((e,a)=>n.jsxs(d,{children:[n.jsxs(t,{style:m,children:["+ ",e.workspace]}),n.jsxs(t,{style:m,children:["(",e.title,")"]}),n.jsx(t,{style:m,children:"-"}),n.jsxs(t,{style:m,children:[x(e.reward)," ₫"]})]},a))]})})}),T&&n.jsx(on,{title:"Thưởng/Phạt",type:"bonus-cash",readOnly:!tn},"cash-assets")]}),n.jsx(C,{value:S,index:2,children:n.jsx(G,{component:A,sx:{mt:h?0:2,ml:h?-10:0,width:h?400:"100%",scale:h?.75:1},children:n.jsx(I,{style:{padding:0},children:n.jsxs(F,{children:[n.jsxs(d,{children:[n.jsx(t,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(t,{style:{fontWeight:700},children:"Giá trị"})]}),n.jsxs(d,{children:[n.jsx(t,{children:"Số phút đi trễ"}),n.jsx(t,{children:gn})]}),H&&H.length===5&&H.map((e,a)=>n.jsxs(d,{children:[n.jsxs(t,{children:["Số việc chấm ",a+1," sao"]}),n.jsx(t,{children:e})]})),R.map((e,a)=>n.jsxs(d,{children:[n.jsxs(t,{style:m,children:["+ ",e.workspace]}),n.jsxs(t,{style:m,children:["(",e.title,")"]}),n.jsx(t,{style:m,children:"-"}),n.jsxs(t,{style:m,children:[x(e.reward)," ₫"]})]},a))]})})})}),n.jsx(C,{value:S,index:3,children:T&&n.jsx(on,{title:"Ứng tiền cho nhân viên",type:"advance-salary-cash",readOnly:!tn},"cash-assets")})]})})})};function C(s){const{children:g,value:y,index:p,...L}=s;return n.jsx("div",{role:"tabpanel",hidden:y!==p,id:`nav-tabpanel-${p}`,"aria-labelledby":`nav-tab-${p}`,...L,children:y===p&&n.jsx(Y,{sx:{p:3},children:g})})}export{On as S};
