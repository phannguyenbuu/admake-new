import{r as e,ac as C,v as n,a5 as D,aL as B,a4 as E,U as _,ad as L,ae as U,af as N,aj as O,ah as m,ai as s,a0 as F,aa as H}from"./index-Bt9suicv.js";import{T as I,c as P}from"./data-DaFaQNML.js";import"./index-ybYmeI-F.js";function G(t,l){const o=new Date(l,t,0).getDate();let a=0;const{workpointSetting:u}=C();for(let c=1;c<=o;c++){const r=new Date(l,t-1,c).getDay();r!==0&&(r===6?a+=u!=null&&u.work_in_saturday_noon?8:4:a+=8)}return a}function V(t,l){const o=new Date(t);return o.setHours(l+7,0,0,0),o.toString()}function b(t,l){if(!t.in)return 0;if(!(t!=null&&t.out)){t.out={img:"",lat:t.in.lat,long:t.in.long,time:V(t.in.time,l)};const a=(new Date(t.out.time).getTime()-new Date(t.in.time).getTime())/(1e3*60*60);t.workhour=a}return t!=null&&t.workhour&&t.workhour>1?t.workhour:0}const x=t=>t.toLocaleString("en-US",{maximumFractionDigits:0}),$=({selectedRecord:t,modalVisible:l,handleOk:o})=>{const[a,u]=e.useState(0),[c,T]=e.useState(0),[r,k]=e.useState(0),[W,M]=e.useState(0),[d,v]=e.useState(0),{workpointSetting:f}=C(),j=(f==null?void 0:f.multiply_in_night_overtime)||0,p=new Date,h=G(p.getMonth()+1,p.getFullYear());return e.useEffect(()=>{if(console.log("selectedRecord",t),!t)return;let i=0,y=0;t.items&&t.items.forEach(w=>{const g=w.checklist;g&&(g.morning&&(i+=b(g.morning,12)),g.noon&&(i+=b(g.noon,17)),g.evening&&(y+=b(g.evening,22)))}),u(i),T(y);const S=t.salary/h;k(S),M((i+y*j)*S)},[t]),n.jsx(D,{open:l,onOk:o,onCancel:o,footer:null,title:"",okText:"OK",cancelButtonProps:{style:{display:"none"}},style:{padding:20,minWidth:"80vw"},children:n.jsxs(B,{children:[n.jsx(E,{sx:{borderRadius:10,backgroundColor:"#00B4B6",px:5,py:1,mb:2},children:n.jsxs(_,{sx:{textTransform:"uppercase",color:"#fff",fontWeight:500,textAlign:"center"},children:["BẢNG LƯƠNG THÁNG ",p.getMonth()+1]})}),n.jsx(_,{children:t==null?void 0:t.username.toUpperCase()}),n.jsx(_,{style:{fontWeight:300,fontSize:12,fontStyle:"italic"},children:t==null?void 0:t.userrole}),n.jsx(L,{component:U,sx:{mt:2},children:n.jsx(N,{children:n.jsxs(O,{children:[n.jsxs(m,{children:[n.jsx(s,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(s,{style:{fontWeight:700},children:"Giá trị"}),n.jsx(s,{style:{fontWeight:700},children:"Lương giờ"}),n.jsx(s,{style:{fontWeight:700},children:"Nhân hệ số"}),n.jsx(s,{style:{fontWeight:700},children:"Thành tiền"})]}),n.jsxs(m,{children:[n.jsx(s,{children:"Tổng giờ làm trong tháng"}),n.jsx(s,{children:a.toFixed(3)}),n.jsxs(s,{children:[x(r)," ₫"]}),n.jsx(s,{children:"1.0"}),n.jsxs(s,{children:[x(r*1*a)," ₫"]})]}),n.jsxs(m,{children:[n.jsx(s,{children:"Tổng giờ tăng ca trong tháng"}),n.jsx(s,{children:c.toFixed(3)}),n.jsxs(s,{children:[x(r)," ₫"]}),n.jsx(s,{children:j}),n.jsxs(s,{children:[x(r*j*c)," ₫"]})]}),n.jsxs(m,{children:[n.jsx(s,{children:"Thưởng theo việc"}),n.jsxs(s,{children:[x(d)," ₫"]}),n.jsx(s,{children:"-"}),n.jsx(s,{children:"-"}),n.jsxs(s,{children:[x(d)," ₫"]})]}),n.jsxs(m,{children:[n.jsx(s,{style:{fontWeight:700},children:"Tổng lương"}),n.jsx(s,{children:"-"}),n.jsx(s,{children:"-"}),n.jsx(s,{children:"-"}),n.jsxs(s,{children:[x(r*1*a+r*1.5*c+d)," ₫"]})]})]})})})]})})},K=()=>{const[t,l]=e.useState({page:1,limit:10,search:""}),[o,a]=e.useState([]),[u,c]=e.useState(!1),[T,r]=e.useState(0),[k,W]=e.useState(!1),[M,d]=e.useState(null),{userLeadId:v}=F(),f=h=>{d(h),W(!0)},j=()=>{W(!1),d(null)},p=async({page:h,limit:i,search:y})=>{c(!0);try{const w=await(await fetch(`${H()}/workpoint/page?`+new URLSearchParams({lead:v.toString(),page:String(h),limit:String(i),search:y}))).json();a(w.data),r(w.pagination.total)}catch(S){console.error("Failed to fetch users",S)}finally{c(!1)}};return e.useEffect(()=>{p(t)},[t]),e.useEffect(()=>{console.log("Workpoints",o)},[o]),n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"min-h-screen p-2 w-full",children:n.jsx(I,{columns:P(f),dataSource:o,loading:u,pagination:{pageSize:t.limit,current:t.page,total:T,onChange:(h,i)=>{l({...t,page:h,limit:i})},showSizeChanger:!0,showTotal:(h,i)=>`${i[0]}-${i[1]} của ${h} nhân sự`,style:{paddingRight:"15px"},locale:{items_per_page:"/ Trang"}}})}),k&&n.jsx($,{selectedRecord:M,modalVisible:k,handleOk:j})]})};export{K as default};
