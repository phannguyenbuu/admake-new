import{r as a,br as A,a as G,j as t,X as I,T as D,V as P,i as V}from"./index-D0MEbSpB.js";import{a as Y}from"./TitlePanel-Bv-1Xr5r.js";import{M as $,d as z}from"./index-PxL5M9pQ.js";import{T as K,a as X,b as j,c as s}from"./TableRow-DR1I80jN.js";import{T as q}from"./TableBody-BypG4HZr.js";function J(n,o,e){const y=new Date(o,n,0).getDate();let d=0;for(let u=1;u<=y;u++){const c=new Date(o,n-1,u).getDay();c!==0&&(c===6?d+=e?8:4:d+=8)}return d}function Q(n,o){const e=new Date(n);return e.setHours(o+7,0,0,0),e.toString()}function v(n){return n.in?1:0}function b(n,o){if(!n.in)return 0;if(!(n!=null&&n.out)){n.out={img:"",lat:n.in.lat,long:n.in.long,time:Q(n.in.time,o)};const y=(new Date(n.out.time).getTime()-new Date(n.in.time).getTime())/(1e3*60*60);n.workhour=y}return n!=null&&n.workhour&&n.workhour>1?n.workhour:0}const l=n=>n.toLocaleString("en-US",{maximumFractionDigits:0}),on=({selectedRecord:n,modalVisible:o,handleOk:e})=>{const[y,d]=a.useState(0),[u,E]=a.useState(0),[c,C]=a.useState(0),[f,H]=a.useState(0),[Z,U]=a.useState(0),[m,F]=a.useState(0),{workpointSetting:g}=A(),W=(g==null?void 0:g.multiply_in_night_overtime)||0,{isMobile:_}=G(),w=new Date;w.getMonth();const[L,N]=a.useState([]),O=async()=>{const i=await fetch(`${V()}/task/${n==null?void 0:n.user_id}/by_user`);if(!i.ok)throw console.log("Error in fetching"),new Error(`Error fetching tasks for user ${n==null?void 0:n.user_id}`);const x=await i.json(),p=x.data??[],h=x.reward??[],k=p.filter(r=>{if(!r.end_time||r.status!=="REWARD")return!1;const S=z(r.end_time).toDate(),B=new Date;return S.getMonth()===B.getMonth()&&S.getFullYear()===B.getFullYear()});N(h);const M=h.reduce((r,S)=>r+(S.reward||0),0);return F(M),k};a.useEffect(()=>{if(console.log("selectedRecord",n),!n)return;const i=J(w.getMonth()+1,w.getFullYear(),(g==null?void 0:g.work_in_saturday_noon)??!1);let x=0,p=0,h=0;n.items&&n.items.forEach(M=>{const r=M.checklist;r&&(r.morning&&(x+=b(r.morning,12),h+=v(r.morning)),r.noon&&(x+=b(r.noon,17),h+=v(r.noon)),r.evening&&(p+=b(r.evening,22)))}),d(x),E(h),C(p);const k=n.salary/i;H(k),U((h*4+p*W)*k),O()},[n,o]);const T={fontStyle:"italic",color:"red"};return t.jsx($,{open:o,onOk:e,onCancel:e,footer:null,title:"",okText:"OK",cancelButtonProps:{style:{display:"none"}},style:{padding:20,minWidth:"90vw"},children:t.jsxs(Y,{children:[t.jsx(I,{sx:{borderRadius:10,backgroundColor:"#00B4B6",px:5,py:1,mb:0},children:t.jsxs(D,{sx:{textTransform:"uppercase",color:"#fff",fontWeight:500,textAlign:"center"},children:["BẢNG LƯƠNG THÁNG ",w.getMonth()+1]})}),t.jsx(D,{children:n==null?void 0:n.username.toUpperCase()}),t.jsx(D,{style:{fontWeight:300,fontSize:12,fontStyle:"italic"},children:n==null?void 0:n.userrole}),t.jsx(K,{component:P,sx:{mt:_?0:2,width:_?400:"100%",scale:_?.75:1},children:t.jsx(X,{style:{padding:0},children:t.jsxs(q,{children:[t.jsxs(j,{children:[t.jsx(s,{style:{fontWeight:700},children:"Nội dung"}),t.jsx(s,{style:{fontWeight:700},children:"Giá trị"}),t.jsx(s,{style:{fontWeight:700},children:"Lương/ĐVT"}),t.jsx(s,{style:{fontWeight:700},children:"Thành tiền"})]}),t.jsxs(j,{children:[t.jsx(s,{children:"Số buổi làm trong tháng"}),t.jsx(s,{children:u}),t.jsxs(s,{children:[l(f*4)," ₫"]}),t.jsxs(s,{children:[l(f*4*u)," ₫"]})]}),t.jsxs(j,{children:[t.jsx(s,{children:"Tổng giờ tăng ca trong tháng"}),t.jsx(s,{children:c.toFixed(3)}),t.jsxs(s,{children:[l(f*W)," ₫"]}),t.jsxs(s,{children:[l(f*W*c)," ₫"]})]}),t.jsxs(j,{children:[t.jsx(s,{children:"Thưởng theo việc"}),t.jsxs(s,{children:[l(m)," ₫"]}),t.jsx(s,{children:"-"}),t.jsxs(s,{children:[l(m)," ₫"]})]}),L.map(i=>t.jsxs(j,{children:[t.jsxs(s,{style:T,children:["+ ",i.workspace]}),t.jsxs(s,{style:T,children:["(",i.title,")"]}),t.jsx(s,{style:T,children:"-"}),t.jsxs(s,{style:T,children:[l(i.reward)," ₫"]})]})),t.jsxs(j,{children:[t.jsx(s,{style:{fontWeight:700},children:"Tổng lương"}),t.jsx(s,{children:"-"}),t.jsx(s,{children:"-"}),t.jsxs(s,{children:[l(f*1*y+f*1.5*c+m)," ₫"]})]})]})})})]})})};export{on as S};
