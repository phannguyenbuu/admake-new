import{r as h,br as G,a as I,j as t,X as P,T as _,V,i as Y}from"./index-CkKRrd3p.js";import{a as $}from"./TitlePanel-2Qbmj1Am.js";import{M as z,d as K}from"./index-BMTynkeh.js";import{T as X,a as q,b as j,c as s}from"./TableRow-DG6TBMtv.js";import{T as J}from"./TableBody-DOFiDW7i.js";function Q(n,f){const x=new Date(n);return x.setHours(f+7,0,0,0),x.toString()}function B(n){return n.in?1:0}function M(n,f){if(!n.in)return 0;if(!(n!=null&&n.out)){n.out={img:"",lat:n.in.lat,long:n.in.long,time:Q(n.in.time,f)};const b=(new Date(n.out.time).getTime()-new Date(n.in.time).getTime())/(1e3*60*60);n.workhour=b}return n!=null&&n.workhour&&n.workhour>1?n.workhour:0}const u=n=>n.toLocaleString("en-US",{maximumFractionDigits:0}),on=({selectedRecord:n,modalVisible:f,handleOk:x})=>{const[b,E]=h.useState(0),[T,v]=h.useState(0),[k,C]=h.useState(0),[g,H]=h.useState(0),[Z,U]=h.useState(0),[m,F]=h.useState(0),{workpointSetting:i}=G(),S=(i==null?void 0:i.multiply_in_night_overtime)||0,{isMobile:W}=I(),y=new Date;y.getMonth();const[L,N]=h.useState([]),O=async()=>{const e=await fetch(`${Y()}/task/${n==null?void 0:n.user_id}/by_user`);if(!e.ok)throw console.log("Error in fetching"),new Error(`Error fetching tasks for user ${n==null?void 0:n.user_id}`);const a=await e.json(),c=a.data??[],o=a.reward??[],l=c.filter(r=>{if(!r.end_time||r.status!=="REWARD")return!1;const w=K(r.end_time).toDate(),D=new Date;return w.getMonth()===D.getMonth()&&w.getFullYear()===D.getFullYear()});N(o);const p=o.reduce((r,w)=>r+(w.reward||0),0);return F(p),l};function A(e,a){const c=new Date(a,e,0).getDate();let o=0;for(let l=1;l<=c;l++){const r=new Date(a,e-1,l).getDay();r===0?o+=i!=null&&i.work_in_sunday?8:0:r===6?o+=i!=null&&i.work_in_saturday_noon?8:4:o+=8}return o}h.useEffect(()=>{if(console.log("selectedRecord",n),!n)return;const e=A(y.getMonth()+1,y.getFullYear());let a=0,c=0,o=0;n.items&&n.items.forEach(p=>{const r=p.checklist;r&&(r.morning&&(a+=M(r.morning,12),o+=B(r.morning)),r.noon&&(a+=M(r.noon,17),o+=B(r.noon)),r.evening&&(c+=M(r.evening,22)))}),E(a),v(o),C(c);const l=n.salary/e;H(l),U((o*4+c*S)*l),O()},[n,f]);const d={fontStyle:"italic",color:"red"};return t.jsx(z,{open:f,onOk:x,onCancel:x,footer:null,title:"",okText:"OK",cancelButtonProps:{style:{display:"none"}},style:{padding:20,minWidth:"90vw"},children:t.jsxs($,{children:[t.jsx(P,{sx:{borderRadius:10,backgroundColor:"#00B4B6",px:5,py:1,mb:0},children:t.jsxs(_,{sx:{textTransform:"uppercase",color:"#fff",fontWeight:500,textAlign:"center"},children:["BẢNG LƯƠNG THÁNG ",y.getMonth()+1]})}),t.jsx(_,{children:n==null?void 0:n.username.toUpperCase()}),t.jsx(_,{style:{fontWeight:300,fontSize:12,fontStyle:"italic"},children:n==null?void 0:n.userrole}),t.jsx(X,{component:V,sx:{mt:W?0:2,width:W?400:"100%",scale:W?.75:1},children:t.jsx(q,{style:{padding:0},children:t.jsxs(J,{children:[t.jsxs(j,{children:[t.jsx(s,{style:{fontWeight:700},children:"Nội dung"}),t.jsx(s,{style:{fontWeight:700},children:"Giá trị"}),t.jsx(s,{style:{fontWeight:700},children:"Lương/ĐVT"}),t.jsx(s,{style:{fontWeight:700},children:"Thành tiền"})]}),t.jsxs(j,{children:[t.jsx(s,{children:"Số buổi làm trong tháng"}),t.jsx(s,{children:T}),t.jsxs(s,{children:[u(g*4)," ₫"]}),t.jsxs(s,{children:[u(g*4*T)," ₫"]})]}),t.jsxs(j,{children:[t.jsx(s,{children:"Tổng giờ tăng ca trong tháng"}),t.jsx(s,{children:k.toFixed(3)}),t.jsxs(s,{children:[u(g*S)," ₫"]}),t.jsxs(s,{children:[u(g*S*k)," ₫"]})]}),t.jsxs(j,{children:[t.jsx(s,{children:"Thưởng theo việc"}),t.jsxs(s,{children:[u(m)," ₫"]}),t.jsx(s,{children:"-"}),t.jsxs(s,{children:[u(m)," ₫"]})]}),L.map(e=>t.jsxs(j,{children:[t.jsxs(s,{style:d,children:["+ ",e.workspace]}),t.jsxs(s,{style:d,children:["(",e.title,")"]}),t.jsx(s,{style:d,children:"-"}),t.jsxs(s,{style:d,children:[u(e.reward)," ₫"]})]})),t.jsxs(j,{children:[t.jsx(s,{style:{fontWeight:700},children:"Tổng lương"}),t.jsx(s,{children:"-"}),t.jsx(s,{children:"-"}),t.jsxs(s,{children:[u(g*4*T+g*1.5*k+m)," ₫"]})]})]})})})]})})};export{on as S};
