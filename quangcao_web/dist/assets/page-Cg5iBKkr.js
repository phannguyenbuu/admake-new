import{r as o,I as L,_ as M,aM as j,b as U,p as _,u as q,j as e,B as D,a as K,s as T}from"./index-DL2Gg38m.js";import{u as Q,B as H}from"./useDebounce-D88NNBCa.js";import{T as W,b as X}from"./data-59owuLrD.js";import"./JobAsset-WMNGhkZA.js";import{F as h,I as N}from"./index-CLFkv2bp.js";import{M as J,s as u}from"./TitlePanel-C_bl8A8I.js";import{T as G,R as Z}from"./index-CextRBOM.js";import{R as w}from"./auth.service-BDWn_4Wx.js";import"./index-Cjz4jmbK.js";import"./QRCode-BYu17lIG.js";import"./Send-C0uPP9VJ.js";var V={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 289.1a362.49 362.49 0 00-79.9-115.7 370.83 370.83 0 00-118.2-77.8C610.7 76.6 562.1 67 512 67c-50.1 0-98.7 9.6-144.5 28.5-44.3 18.3-84 44.5-118.2 77.8A363.6 363.6 0 00169.4 289c-19.5 45-29.4 92.8-29.4 142 0 70.6 16.9 140.9 50.1 208.7 26.7 54.5 64 107.6 111 158.1 80.3 86.2 164.5 138.9 188.4 153a43.9 43.9 0 0022.4 6.1c7.8 0 15.5-2 22.4-6.1 23.9-14.1 108.1-66.8 188.4-153 47-50.4 84.3-103.6 111-158.1C867.1 572 884 501.8 884 431.1c0-49.2-9.9-97-29.4-142zM512 880.2c-65.9-41.9-300-207.8-300-449.1 0-77.9 31.1-151.1 87.6-206.3C356.3 169.5 431.7 139 512 139s155.7 30.5 212.4 85.9C780.9 280 812 353.2 812 431.1c0 241.3-234.1 407.2-300 449.1zm0-617.2c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 551c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 439c0-29.9 11.7-58 32.8-79.2C454 338.6 482.1 327 512 327c29.9 0 58 11.6 79.2 32.8C612.4 381 624 409.1 624 439c0 29.9-11.6 58-32.8 79.2z"}}]},name:"environment",theme:"outlined"},ee=function(t,r){return o.createElement(L,M({},t,{ref:r,icon:V}))},se=o.forwardRef(ee),te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M877.1 238.7L770.6 132.3c-13-13-30.4-20.3-48.8-20.3s-35.8 7.2-48.8 20.3L558.3 246.8c-13 13-20.3 30.5-20.3 48.9 0 18.5 7.2 35.8 20.3 48.9l89.6 89.7a405.46 405.46 0 01-86.4 127.3c-36.7 36.9-79.6 66-127.2 86.6l-89.6-89.7c-13-13-30.4-20.3-48.8-20.3a68.2 68.2 0 00-48.8 20.3L132.3 673c-13 13-20.3 30.5-20.3 48.9 0 18.5 7.2 35.8 20.3 48.9l106.4 106.4c22.2 22.2 52.8 34.9 84.2 34.9 6.5 0 12.8-.5 19.2-1.6 132.4-21.8 263.8-92.3 369.9-198.3C818 606 888.4 474.6 910.4 342.1c6.3-37.6-6.3-76.3-33.3-103.4zm-37.6 91.5c-19.5 117.9-82.9 235.5-178.4 331s-213 158.9-330.9 178.4c-14.8 2.5-30-2.5-40.8-13.2L184.9 721.9 295.7 611l119.8 120 .9.9 21.6-8a481.29 481.29 0 00285.7-285.8l8-21.6-120.8-120.7 110.8-110.9 104.5 104.5c10.8 10.8 15.8 26 13.3 40.8z"}}]},name:"phone",theme:"outlined"},re=function(t,r){return o.createElement(L,M({},t,{ref:r,icon:te}))},ae=o.forwardRef(re);const y={getCustomers:(s={})=>j.get("/customer/",{params:s}),getCustomerDetail:s=>(console.log("HY useCustomerDetail",s),j.get(`/customer/${s}`)),createCustomer:s=>j.post("/customer/",s).then(t=>t.data),updateCustomer:(s,t)=>j.put(`/customer/${s}`,t),deleteCustomer:s=>j.delete(`/customer/${s}`)},ne="customer/queryPagination",oe="customer/queryDetail";function me(s={}){return U({queryKey:[ne,s],queryFn:()=>y.getCustomers(s)})}function le(s){return U({queryKey:[oe,s],queryFn:()=>y.getCustomerDetail(s||""),enabled:!!s})}function ce(){return _({mutationFn:s=>y.createCustomer(s)})}function de(){return _({mutationFn:({dto:s,id:t})=>y.updateCustomer(t,s)})}const{Title:ie,Text:C}=G;function z({onDelete:s,onCancel:t,initialValues:r,open:d,onRefresh:x}){const[n]=h.useForm(),{userLeadId:m,workspaces:S,setWorkspaces:g}=q(),[i,l]=o.useState({}),{mutate:B,data:p,error:F,isPending:k}=ce(),{mutate:a,isPending:c}=de(),{data:O,isLoading:P}=le(r==null?void 0:r.id),f=!!r,I=k||c||P;o.useEffect(()=>{console.log("initialValues",r,m),r?n.setFieldsValue({...r}):n.resetFields()},[r,n]);const $=v=>{const b={...v,lead:m};O?a({dto:b,id:(r==null?void 0:r.id)||""},{onSuccess:()=>{u.success("Cập nhật khách hàng thành công"),n.resetFields(),x()},onError:()=>{u.error("Cập nhật khách hàng thất bại")}}):(console.log("Cretae customer",b),B(b,{onSuccess:()=>{u.success("Tạo khách hàng thành công"),n.resetFields(),x()},onError:()=>{u.error("Tạo khách hàng thất bại")}}))},R=()=>{try{return!(!i.fullName||!i.phone)}catch{return!1}},E=R(),A=()=>{n.resetFields(),t()},Y=()=>{if(!R()){u.warning("Vui lòng nhập đầy đủ thông tin bắt buộc");return}n.validateFields().then(()=>{$(n.getFieldsValue())}).catch(()=>{u.error("Vui lòng kiểm tra lại thông tin")}),t()};return o.useEffect(()=>{const v=setInterval(()=>{const b=n.getFieldsValue();l(b)},100);return()=>clearInterval(v)},[n]),e.jsx(J,{title:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 px-1 sm:px-2",children:[e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-lg sm:rounded-xl bg-gradient-to-br from-[#00B4B6] to-[#0891b2] flex items-center justify-center shadow-lg",children:e.jsx(w,{className:"!text-white !text-sm sm:!text-base"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(ie,{level:5,className:"!m-0 !text-gray-900 !font-bold !text-sm sm:!text-base",children:f?"Chỉnh sửa khách hàng":"Thêm khách hàng mới"}),e.jsx(C,{className:"text-gray-500 text-xs sm:text-sm !block !truncate",children:f?"Cập nhật thông tin khách hàng":"Điền thông tin khách hàng mới"})]})]}),open:d,onCancel:t,footer:null,width:"calc(100vw - 32px)",style:{maxWidth:"600px"},centered:!0,destroyOnHidden:!0,maskClosable:!1,className:"!rounded-xl sm:!rounded-2xl customer-modal",styles:{content:{borderRadius:"12px",overflow:"hidden",padding:0,boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.8)"},body:{padding:0,borderRadius:"12px",maxHeight:"calc(100vh - 250px)",overflowY:"auto"},header:{borderBottom:"1px solid #f1f3f4",padding:"12px 16px",background:"linear-gradient(135deg, #fafbfc 0%, #f8fafc 100%)",borderRadius:"12px 12px 0 0",flexShrink:0},mask:{backdropFilter:"blur(12px)",backgroundColor:"rgba(0, 0, 0, 0.4)"}},children:e.jsxs("div",{className:"bg-white h-full flex flex-col",children:[e.jsx("div",{className:"px-4 sm:px-6 py-3 sm:py-4 bg-gradient-to-r from-[#00B4B6]/10 via-white to-[#0891b2]/10 border-b border-[#00B4B6]/20 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-1 h-1 sm:w-1.5 sm:h-1.5 rounded-full bg-[#00B4B6] animate-pulse"}),e.jsx(C,{className:"text-[#00B4B6] text-xs sm:text-sm font-medium",children:"Thông tin khách hàng"})]}),e.jsx("div",{className:"ml-auto",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:"text-xs text-gray-500",children:E?e.jsx("span",{className:"text-green-600 font-medium",children:"✓ Đã hoàn thành"}):e.jsx("span",{className:"text-orange-600 font-medium",children:"⚠ Cần bổ sung"})})})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 sm:px-6 pt-4 sm:pt-6 custom-scrollbar",children:e.jsx(h,{form:n,layout:"vertical",onFinish:$,autoComplete:"off",className:"space-y-3 sm:space-y-4",children:e.jsxs("div",{className:"bg-gray-50 rounded-lg border border-gray-200 shadow-sm p-3 sm:p-4 mb-3 sm:mb-4 hover:shadow-md transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 sm:mb-3",children:[e.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 rounded-md bg-gradient-to-r from-[#00B4B6]/10 to-[#0891b2]/10 flex items-center justify-center",children:e.jsx(w,{className:"!text-[#0891b2] !text-xs sm:!text-sm"})}),e.jsx(C,{strong:!0,className:"!text-gray-800 !text-sm sm:!text-base",children:"Thông tin cơ bản"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:gap-4",children:[e.jsx(h.Item,{name:"fullName",label:e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("span",{className:"text-gray-800 font-medium text-xs sm:text-sm",children:"Tên khách hàng"}),e.jsx("div",{className:"w-1 h-1 bg-[#00B4B6] rounded-full"})]}),rules:[{required:!0,message:"Nhập tên khách hàng"}],className:"!mb-0",children:e.jsx(N,{placeholder:"Nhập tên khách hàng",className:"!h-9 sm:!h-10 !text-xs sm:!text-sm !rounded-lg !border !border-gray-300 focus:!border-[#00B4B6] focus:!shadow-lg hover:!border-[#00B4B6] !transition-all !duration-200 !shadow-sm",size:"middle",prefix:e.jsx(w,{className:"text-[#00B4B6] mr-2"})})}),e.jsx(h.Item,{name:"name",label:e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("span",{className:"text-gray-800 font-medium text-xs sm:text-sm",children:"Tên gợi nhớ"}),e.jsx("div",{className:"w-1 h-1 bg-[#00B4B6] rounded-full"})]}),rules:[{required:!1,message:"Nhập tên gợi nhớ"}],className:"!mb-0",children:e.jsx(N,{placeholder:"Nhập tên gợi nhớ",className:"!h-9 sm:!h-10 !text-xs sm:!text-sm !rounded-lg !border !border-gray-300 focus:!border-[#00B4B6] focus:!shadow-lg hover:!border-[#00B4B6] !transition-all !duration-200 !shadow-sm",size:"middle",prefix:e.jsx(w,{className:"text-[#00B4B6] mr-2"})})}),e.jsx(h.Item,{name:"phone",label:e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("span",{className:"text-gray-800 font-medium text-xs sm:text-sm",children:"Số điện thoại"}),e.jsx("div",{className:"w-1 h-1 bg-[#00B4B6] rounded-full"})]}),rules:[{required:!0,message:"Nhập số điện thoại"},{pattern:/^[0-9]{9,10}$/,message:"Số điện thoại không hợp lệ"}],className:"!mb-0",children:e.jsx(N,{placeholder:"Nhập số điện thoại",className:"!h-9 sm:!h-10 !text-xs sm:!text-sm !rounded-lg !border !border-gray-300 focus:!border-[#00B4B6] focus:!shadow-lg hover:!border-[#00B4B6] !transition-all !duration-200 !shadow-sm",size:"middle",prefix:e.jsx(ae,{className:"text-[#00B4B6] mr-2"})})}),e.jsxs("div",{className:"bg-gray-50 rounded-lg border border-gray-200 shadow-sm p-3 sm:p-4 hover:shadow-md transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 sm:mb-3",children:[e.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 rounded-md bg-gradient-to-r from-purple-100 to-purple-200 flex items-center justify-center",children:e.jsx(se,{className:"!text-purple-600 !text-xs sm:!text-sm"})}),e.jsx(C,{strong:!0,className:"!text-gray-800 !text-sm sm:!text-base",children:"Địa chỉ"})]}),e.jsx(h.Item,{name:"address",label:e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-1 h-1 bg-purple-500 rounded-full"}),e.jsx("span",{className:"text-gray-400 text-xs font-normal",children:"(Tùy chọn)"})]}),className:"!mb-3",children:e.jsx(N.TextArea,{rows:2,placeholder:"Nhập địa điểm thi công...",className:"!rounded-lg !border !border-gray-300 focus:!border-[#00B4B6] focus:!shadow-lg hover:!border-[#00B4B6] !transition-all !duration-200 !shadow-sm !resize-none !text-xs sm:!text-sm"})})]})]})]})})}),e.jsxs("div",{className:"flex flex-row justify-end gap-2 sm:gap-3 pt-4 sm:pt-6 border-t border-gray-100 mt-4 sm:mt-6 bg-white sticky bottom-0 px-4 sm:px-6 pb-4 sm:pb-6",children:[s&&e.jsx(D,{onClick:()=>{s(),x(),A()},disabled:I,size:"middle",className:"!h-9 sm:!h-10 !px-4 sm:!px-6 !rounded-lg !text-gray-700 hover:!bg-gray-50 !font-medium !text-xs sm:!text-sm !transition-all !duration-200 !shadow-sm hover:!shadow-md hover:!scale-105 !order-1 sm:!order-1 !drop-shadow-md !border-none",children:"❌ Xóa khách hàng"}),e.jsx(D,{type:"primary",htmlType:"submit",size:"middle",className:`!h-9 sm:!h-10 !px-4 sm:px-6 !rounded-lg !border-0 !shadow-lg !font-bold !text-xs sm:!text-sm !transition-all !duration-200 !transform !order-2 sm:!order-2 !drop-shadow-md ${E?"!bg-gradient-to-r !from-[#00B4B6] !to-[#0891b2] hover:!from-[#0891b2] hover:!to-[#00B4B6] hover:!shadow-xl hover:!scale-105":"!bg-gray-300 !text-gray-500 !cursor-not-allowed hover:!shadow-lg"}`,onClick:Y,disabled:!E,children:I?e.jsxs("span",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"hidden sm:inline",children:f?"Đang cập nhật...":"Đang tạo..."}),e.jsx("span",{className:"sm:hidden",children:f?"Cập nhật...":"Tạo..."})]}):`✅ ${f?"Cập nhật":"Tạo khách hàng"}`})]})]})})}const Ce=()=>{const{userLeadId:s}=q(),[t,r]=o.useState({page:1,limit:10,lead:s,search:""}),[d,x]=o.useState({openCreate:!1,openUpdate:!1}),n=Q(t.search,500),{data:m,isLoading:S,refetch:g,error:i}=me({...t,search:n});o.useEffect(()=>{m&&console.log("Received new data:",m)},[m]),o.useEffect(()=>{i&&console.error("Error fetching customers:",i)},[i]);const[l,B]=o.useState(null);o.useEffect(()=>{console.log("Current customer:",l)},[l]);const p=a=>()=>{x({...d,[a]:!d[a]})},F=a=>{r({...t,search:a,page:1})},k=()=>{console.log("DELETE",l),!(!l||!l.owner_id)&&fetch(`${K()}/customer/${l.id}`,{method:"DELETE"}).then(a=>(a.ok?T.success({message:`Xóa khách hàng ${l.name} thành công`}):T.error({message:"Không xóa được khách hàng"}),a.json())).then(()=>{g()}).catch(a=>{T.error({message:`Delete error: ${a}`})})};return e.jsxs("div",{className:"min-h-screen p-2 w-full",children:[e.jsx(H,{toggle:p("openCreate"),refetch:g,title:"Thêm khách hàng",onSearch:F}),e.jsx(W,{columns:X,dataSource:m==null?void 0:m.data,loading:S,rowSelection:{type:"radio",columnWidth:100,renderCell:(a,c)=>e.jsx(e.Fragment,{children:e.jsx(Z,{className:"!text-cyan-600 !cursor-pointer !text-xl",onClick:()=>{B(c),p("openUpdate")()}})})},pagination:{pageSize:t.limit,current:t.page,total:(m==null?void 0:m.total)||0,onChange:(a,c)=>{r({...t,page:a,limit:c})},showSizeChanger:!0,showTotal:(a,c)=>`${c[0]}-${c[1]} của ${a} khách hàng`,style:{paddingRight:"15px"},locale:{items_per_page:"/ Trang"}}}),e.jsx(z,{onCancel:p("openCreate"),open:d.openCreate,onRefresh:g}),e.jsx(z,{onDelete:k,onCancel:p("openUpdate"),open:d.openUpdate,initialValues:l,onRefresh:g})]})},ye=async()=>(await new Promise(s=>setTimeout(s,2e3)),{userId:1,name:"John Doe"});export{Ce as default,ye as loader};
