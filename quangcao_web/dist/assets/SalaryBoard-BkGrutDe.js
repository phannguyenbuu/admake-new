import{r as i,c4 as vn,q as Wn,Z as Mn,s as n,X as z,A as O,V as U,v as on}from"./index-DlDbvK2b.js";import{M as _n,a as Dn}from"./TitlePanel-C9Rfj9pl.js";import{J as ln,d as Bn}from"./JobAsset-DjiAzVM5.js";import{T as Cn,a as L}from"./Tabs-DcSvX9ib.js";import{T as $,a as H,d as Y,b as c,c as t}from"./TableRow-DD9q3zCd.js";function En(s,f){const g=new Date(s);return g.setHours(f+7,0,0,0),g.toString()}function hn(s){return s.in?1:0}function V(s,f){if(!s.in)return 0;if(!(s!=null&&s.out)){s.out={img:"",lat:s.in.lat,long:s.in.long,time:En(s.in.time,f)};const p=(new Date(s.out.time).getTime()-new Date(s.in.time).getTime())/(1e3*60*60);s.workhour=p}return s!=null&&s.workhour&&s.workhour>1?s.workhour:0}const d=s=>s.toLocaleString("en-US",{maximumFractionDigits:0}),On=({selectedRecord:s,modalVisible:f,handleOk:g})=>{const[p,A]=i.useState(0),[P,cn]=i.useState(0),[F,xn]=i.useState(0),[m,dn]=i.useState(0),[Ln,un]=i.useState(0),[_,J]=i.useState(0),[q,K]=i.useState(0),[X,Z]=i.useState(0),[Q,R]=i.useState(0),{workpointSetting:u}=vn(),nn=(u==null?void 0:u.multiply_in_night_overtime)||0,{isMobile:o}=Wn(),D=new Date;D.getMonth();const[jn,fn]=i.useState([]),{taskDetail:b,setTaskDetail:gn}=Mn(),[G,tn]=i.useState([0,0,0,0,0]),[w,pn]=i.useState(0),[yn,mn]=i.useState(0),[Nn,Tn]=i.useState(0);i.useEffect(()=>{b&&(async()=>{try{const e=await fetch(`${on()}/task/${s==null?void 0:s.user_id}/salary`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error("Network response was not ok "+e.statusText);const x=await e.json();gn(x.infor),tn(x.rates),console.log("Salary tasks data:",x)}catch(e){console.error("Fetch error:",e)}})()},[s,f]),i.useEffect(()=>{if(!b||!b.assets){un(0),J(0),K(0),Z(0),R(0),tn([0,0,0,0,0]);return}let r=0,e=0,x=0;b.assets.forEach(a=>{if(a.text!==""&&a.text)if(a.type==="bonus-cash"){const h=Number(a.text.split("/")[0].replace(/\./g,""));r+=h>0?h:0,x+=h<0?h:0}else a.type==="advance-salary-cash"&&(e+=Number(a.text.split("/")[0].replace(/\./g,"")))}),K(e),Z(x),R(r)},[b]);const bn=(r,e)=>{pn(e)},sn=!window.location.href.includes("/point/"),wn=async()=>{const r=await fetch(`${on()}/task/${s==null?void 0:s.user_id}/by_user`);if(!r.ok)throw new Error(`Error fetching tasks for user ${s==null?void 0:s.user_id}`);const e=await r.json(),x=e.data??[],a=e.reward??[],h=x.filter(j=>{if(!j.end_time||j.status!=="REWARD")return!1;const T=Bn(j.end_time).toDate(),E=new Date;return T.getMonth()===E.getMonth()&&T.getFullYear()===E.getFullYear()});fn(a);const y=a.reduce((j,T)=>j+(T.reward||0),0);return J(y),h};function Sn(r,e){const x=new Date(e,r,0).getDate();let a=0;for(let h=1;h<=x;h++){const j=new Date(e,r-1,h).getDay();j===0?a+=u!=null&&u.work_in_sunday?8:0:j===6?a+=u!=null&&u.work_in_saturday_noon?8:4:a+=8}return a}i.useEffect(()=>{var en;if(!((en=s==null?void 0:s.items)!=null&&en.length))return;const r=D.getMonth(),e=D.getFullYear();console.log("Current month/year:",r,e);const x=s.items.filter(S=>{var W,M,rn,an;const l=S.checklist;if(!l)return!1;const k=((M=(W=l.morning)==null?void 0:W.in)==null?void 0:M.time)||((an=(rn=l.noon)==null?void 0:rn.in)==null?void 0:an.time);if(!k)return!1;const v=new Date(k);return v.getMonth()===r&&v.getFullYear()===e});let a=0,h=0,y=0,j=0,T=0;x.forEach(S=>{var k,v,I,W,M;const l=S.checklist;l&&(s!=null&&s.username.includes("LỘC")&&((k=l.morning)!=null&&k.in||console.log("No morning",S),(v=l.noon)!=null&&v.in||console.log("No noon",S)),(I=l.morning)!=null&&I.in&&(a+=V(l.morning,12),y+=hn(l.morning)),(W=l.noon)!=null&&W.in&&(a+=V(l.noon,17),y+=hn(l.noon)),(M=l.evening)!=null&&M.in&&(h+=V(l.evening,22)))}),console.log("✅ RESULTS:",{timeWork:a,periodWork:y,overTimeWork:h}),A(a),cn(y),xn(h),mn(j),Tn(T);const E=Sn(r+1,e),kn=s.salary/E;dn(kn),wn()},[s,f,u]);const B={fontStyle:"italic",color:"red"},C={fontSize:10,minWidth:70,maxWidth:70,paddingLeft:o?0:50,paddingRight:o?0:50,whiteSpace:o?"wrap":"nowrap",borderLeft:"1px solid #666"};return n.jsx(_n,{open:f,onOk:g,onCancel:g,footer:null,title:"",okText:"OK",cancelButtonProps:{style:{display:"none"}},children:n.jsx(Dn,{children:n.jsxs(z,{sx:{width:"100%"},children:[n.jsxs(z,{sx:{width:250,borderRadius:1,backgroundColor:"#00B4B6",px:1,py:1,mb:0,position:"relative","&:after":{content:'""',position:"absolute",right:-26,top:"50%",transform:"translateY(-50%)",width:0,height:0,borderTop:"28px solid transparent",borderBottom:"28px solid transparent",borderLeft:"28px solid #00B4B6"}},children:[n.jsxs(O,{sx:{textTransform:"uppercase",color:"#ccc",fontSize:12,fontWeight:500},children:["BẢNG LƯƠNG THÁNG ",D.getMonth()+1]}),n.jsx(O,{sx:{textTransform:"uppercase",color:"#fff"},children:s==null?void 0:s.username.toUpperCase()})]}),n.jsxs(Cn,{value:w,onChange:bn,"aria-label":"nav tabs example",variant:o?"scrollable":"standard",scrollButtons:"auto",style:{marginTop:10},children:[n.jsx(L,{style:C,label:"Lương",id:"nav-tab-0","aria-controls":"nav-tabpanel-0"}),n.jsx(L,{style:C,label:"Thưởng Phạt",id:"nav-tab-1","aria-controls":"nav-tabpanel-1"}),n.jsx(L,{style:C,label:"Chuyên Cần",id:"nav-tab-2","aria-controls":"nav-tabpanel-2"}),n.jsx(L,{style:C,label:"Ứng Tiền",id:"nav-tab-3","aria-controls":"nav-tabpanel-3"})]}),n.jsxs(N,{value:w,index:0,children:[n.jsx($,{component:U,sx:{mt:o?0:2,ml:o?-10:0,width:o?400:"100%",scale:o?.75:1},children:n.jsx(H,{style:{padding:0},children:n.jsxs(Y,{children:[n.jsxs(c,{children:[n.jsx(t,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(t,{style:{fontWeight:700},children:"Giá trị"}),n.jsx(t,{style:{fontWeight:700},children:"Lương/ĐVT"}),n.jsx(t,{style:{fontWeight:700},children:"Thành tiền"})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Số buổi làm"}),n.jsx(t,{children:P}),n.jsxs(t,{children:[d(m*4)," ₫"]}),n.jsxs(t,{children:[d(m*4*P)," ₫"]})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Số giờ làm"}),n.jsx(t,{children:p.toLocaleString()}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Tổng giờ tăng ca"}),n.jsx(t,{children:F.toFixed(3)}),n.jsxs(t,{children:[d(m*nn)," ₫"]}),n.jsxs(t,{children:[d(m*nn*F)," ₫"]})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Tổng phụ cấp"}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[d(_)," ₫"]})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Tổng thưởng"}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[d(Q)," ₫"]})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Tổng phạt"}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[d(X)," ₫"]})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Tạm ứng"}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[d(q)," ₫"]})]})]})})}),n.jsxs(O,{style:{marginTop:20,textAlign:"center",color:"#00B5B4"},children:["Tổng lương: ",d(m*4*P+m*1.5*F+_+Q+X+q)," ₫"]})]}),n.jsxs(N,{value:w,index:1,children:[n.jsx($,{component:U,sx:{mt:o?0:2,ml:o?-10:0,width:o?400:"100%",scale:o?.75:1},children:n.jsx(H,{style:{padding:0},children:n.jsxs(Y,{children:[n.jsxs(c,{children:[n.jsx(t,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(t,{style:{fontWeight:700},children:"Giá trị"}),n.jsx(t,{style:{fontWeight:700},children:"Lương/ĐVT"}),n.jsx(t,{style:{fontWeight:700},children:"Thành tiền"})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Thưởng theo việc"}),n.jsxs(t,{children:[d(_)," ₫"]}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[d(_)," ₫"]})]}),jn.map((r,e)=>n.jsxs(c,{children:[n.jsxs(t,{style:B,children:["+ ",r.workspace]}),n.jsxs(t,{style:B,children:["(",r.title,")"]}),n.jsx(t,{style:B,children:"-"}),n.jsxs(t,{style:B,children:[d(r.reward)," ₫"]})]},e))]})})}),n.jsx(ln,{title:"Thưởng/Phạt",type:"bonus-cash",readOnly:!sn},"cash-assets")]}),n.jsx(N,{value:w,index:2,children:n.jsx($,{component:U,sx:{mt:o?0:2,ml:o?-10:0,width:o?400:"100%",scale:o?.75:1},children:n.jsx(H,{style:{padding:0},children:n.jsxs(Y,{children:[n.jsxs(c,{children:[n.jsx(t,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(t,{style:{fontWeight:700},children:"Giá trị"})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Số phút đi trễ"}),n.jsx(t,{children:yn})]}),G&&G.length===5&&G.map((r,e)=>n.jsxs(c,{children:[n.jsxs(t,{children:["Số việc chấm ",e+1," sao"]}),n.jsx(t,{children:r})]}))]})})})}),n.jsx(N,{value:w,index:3,children:n.jsx(ln,{title:"Ứng tiền cho nhân viên",type:"advance-salary-cash",readOnly:!sn},"cash-assets")})]})})})};function N(s){const{children:f,value:g,index:p,...A}=s;return n.jsx("div",{role:"tabpanel",hidden:g!==p,id:`nav-tabpanel-${p}`,"aria-labelledby":`nav-tab-${p}`,...A,children:g===p&&n.jsx(z,{sx:{p:3},children:f})})}export{On as S};
