import{r as j,aR as R,a as nn,j as n,l as A,T as L,k as C,i as sn}from"./index-CO_hewGj.js";import{a as tn}from"./TitlePanel-4lI377aT.js";import{T as E,a as N,b as h,c as s,J as U}from"./JobAsset-D_-aZnEQ.js";import{M as en,d as rn}from"./index-GfEEWm_I.js";import{T as an,a as k}from"./Tabs-pNc9BiSR.js";import{T as O}from"./TableBody-BQP0MqdX.js";function on(t,u){const c=new Date(t);return c.setHours(u+7,0,0,0),c.toString()}function F(t){return t.in?1:0}function P(t,u){if(!t.in)return 0;if(!(t!=null&&t.out)){t.out={img:"",lat:t.in.lat,long:t.in.long,time:on(t.in.time,u)};const y=(new Date(t.out.time).getTime()-new Date(t.in.time).getTime())/(1e3*60*60);t.workhour=y}return t!=null&&t.workhour&&t.workhour>1?t.workhour:0}const o=t=>t.toLocaleString("en-US",{maximumFractionDigits:0}),gn=({selectedRecord:t,modalVisible:u,handleOk:c})=>{const[y,_]=j.useState(0),[B,$]=j.useState(0),[M,V]=j.useState(0),[b,Y]=j.useState(0),[ln,z]=j.useState(0),[d,J]=j.useState(0),{workpointSetting:x}=R(),D=(x==null?void 0:x.multiply_in_night_overtime)||0,{isMobile:r}=nn(),m=new Date;m.getMonth();const[G,K]=j.useState([]),[T,q]=j.useState(0),Q=(a,i)=>{q(i)},H=!window.location.href.includes("/point/"),X=async()=>{const a=await fetch(`${sn()}/task/${t==null?void 0:t.user_id}/by_user`);if(!a.ok)throw console.log("Error in fetching"),new Error(`Error fetching tasks for user ${t==null?void 0:t.user_id}`);const i=await a.json(),p=i.data??[],l=i.reward??[],f=p.filter(e=>{if(!e.end_time||e.status!=="REWARD")return!1;const W=rn(e.end_time).toDate(),I=new Date;return W.getMonth()===I.getMonth()&&W.getFullYear()===I.getFullYear()});K(l);const v=l.reduce((e,W)=>e+(W.reward||0),0);return J(v),f};function Z(a,i){const p=new Date(i,a,0).getDate();let l=0;for(let f=1;f<=p;f++){const e=new Date(i,a-1,f).getDay();e===0?l+=x!=null&&x.work_in_sunday?8:0:e===6?l+=x!=null&&x.work_in_saturday_noon?8:4:l+=8}return l}j.useEffect(()=>{if(!t)return;const a=Z(m.getMonth()+1,m.getFullYear());let i=0,p=0,l=0;t.items&&t.items.forEach(v=>{const e=v.checklist;e&&(e.morning&&(i+=P(e.morning,12),l+=F(e.morning)),e.noon&&(i+=P(e.noon,17),l+=F(e.noon)),e.evening&&(p+=P(e.evening,22)))}),_(i),$(l),V(p);const f=t.salary/a;Y(f),z((l*4+p*D)*f),X()},[t,u]);const g={fontStyle:"italic",color:"red"},w={fontSize:10,minWidth:70,maxWidth:70,paddingLeft:r?0:50,paddingRight:r?0:50,whiteSpace:r?"wrap":"nowrap",borderLeft:"1px solid #666"};return n.jsx(en,{open:u,onOk:c,onCancel:c,footer:null,title:"",okText:"OK",cancelButtonProps:{style:{display:"none"}},children:n.jsx(tn,{children:n.jsxs(A,{sx:{width:"100%"},children:[n.jsxs(A,{sx:{width:250,borderRadius:1,backgroundColor:"#00B4B6",px:1,py:1,mb:0,position:"relative","&:after":{content:'""',position:"absolute",right:-26,top:"50%",transform:"translateY(-50%)",width:0,height:0,borderTop:"28px solid transparent",borderBottom:"28px solid transparent",borderLeft:"28px solid #00B4B6"}},children:[n.jsxs(L,{sx:{textTransform:"uppercase",color:"#ccc",fontSize:12,fontWeight:500},children:["BẢNG LƯƠNG THÁNG ",m.getMonth()+1]}),n.jsx(L,{sx:{textTransform:"uppercase",color:"#fff"},children:t==null?void 0:t.username.toUpperCase()})]}),n.jsxs(an,{value:T,onChange:Q,"aria-label":"nav tabs example",variant:r?"scrollable":"standard",scrollButtons:"auto",style:{marginTop:10},children:[n.jsx(k,{style:w,label:"Lương",id:"nav-tab-0","aria-controls":"nav-tabpanel-0"}),n.jsx(k,{style:w,label:"Thưởng Phạt",id:"nav-tab-1","aria-controls":"nav-tabpanel-1"}),n.jsx(k,{style:w,label:"Chuyên Cần",id:"nav-tab-2","aria-controls":"nav-tabpanel-2"}),n.jsx(k,{style:w,label:"Ứng Tiền",id:"nav-tab-3","aria-controls":"nav-tabpanel-3"})]}),n.jsxs(S,{value:T,index:0,children:[n.jsx(E,{component:C,sx:{mt:r?0:2,ml:r?-10:0,width:r?400:"100%",scale:r?.75:1},children:n.jsx(N,{style:{padding:0},children:n.jsxs(O,{children:[n.jsxs(h,{children:[n.jsx(s,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(s,{style:{fontWeight:700},children:"Giá trị"}),n.jsx(s,{style:{fontWeight:700},children:"Lương/ĐVT"}),n.jsx(s,{style:{fontWeight:700},children:"Thành tiền"})]}),n.jsxs(h,{children:[n.jsx(s,{children:"Số buổi làm trong tháng"}),n.jsx(s,{children:B}),n.jsxs(s,{children:[o(b*4)," ₫"]}),n.jsxs(s,{children:[o(b*4*B)," ₫"]})]}),n.jsxs(h,{children:[n.jsx(s,{children:"Tổng giờ tăng ca trong tháng"}),n.jsx(s,{children:M.toFixed(3)}),n.jsxs(s,{children:[o(b*D)," ₫"]}),n.jsxs(s,{children:[o(b*D*M)," ₫"]})]}),n.jsxs(h,{children:[n.jsx(s,{children:"Tổng thưởng"}),n.jsxs(s,{children:[o(d)," ₫"]}),n.jsx(s,{children:"-"}),n.jsxs(s,{children:[o(d)," ₫"]})]}),n.jsxs(h,{children:[n.jsx(s,{children:"Tổng phạt"}),n.jsxs(s,{children:[o(d)," ₫"]}),n.jsx(s,{children:"-"}),n.jsxs(s,{children:[o(d)," ₫"]})]})]})})}),n.jsxs(L,{style:{marginTop:20,textAlign:"center",color:"#00B5B4"},children:["Tổng lương: ",o(b*4*B+b*1.5*M+d)," ₫"]})]}),n.jsxs(S,{value:T,index:1,children:[n.jsx(E,{component:C,sx:{mt:r?0:2,ml:r?-10:0,width:r?400:"100%",scale:r?.75:1},children:n.jsx(N,{style:{padding:0},children:n.jsxs(O,{children:[n.jsxs(h,{children:[n.jsx(s,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(s,{style:{fontWeight:700},children:"Giá trị"}),n.jsx(s,{style:{fontWeight:700},children:"Lương/ĐVT"}),n.jsx(s,{style:{fontWeight:700},children:"Thành tiền"})]}),n.jsxs(h,{children:[n.jsx(s,{children:"Thưởng theo việc"}),n.jsxs(s,{children:[o(d)," ₫"]}),n.jsx(s,{children:"-"}),n.jsxs(s,{children:[o(d)," ₫"]})]}),G.map((a,i)=>n.jsxs(h,{children:[n.jsxs(s,{style:g,children:["+ ",a.workspace]}),n.jsxs(s,{style:g,children:["(",a.title,")"]}),n.jsx(s,{style:g,children:"-"}),n.jsxs(s,{style:g,children:[o(a.reward)," ₫"]})]},i))]})})}),n.jsx(U,{title:"Thưởng/Phạt",type:"bonus-cash",readOnly:!H},"cash-assets")]}),n.jsx(S,{value:T,index:2,children:n.jsx(E,{component:C,sx:{mt:r?0:2,ml:r?-10:0,width:r?400:"100%",scale:r?.75:1},children:n.jsx(N,{style:{padding:0},children:n.jsxs(O,{children:[n.jsxs(h,{children:[n.jsx(s,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(s,{style:{fontWeight:700},children:"Giá trị"}),n.jsx(s,{style:{fontWeight:700},children:"Lương/ĐVT"}),n.jsx(s,{style:{fontWeight:700},children:"Thành tiền"})]}),n.jsxs(h,{children:[n.jsx(s,{children:"Số giờ đi trễ"}),n.jsxs(s,{children:[o(d)," ₫"]}),n.jsx(s,{children:"-"}),n.jsxs(s,{children:[o(d)," ₫"]})]}),G.map((a,i)=>n.jsxs(h,{children:[n.jsxs(s,{style:g,children:["+ ",a.workspace]}),n.jsxs(s,{style:g,children:["(",a.title,")"]}),n.jsx(s,{style:g,children:"-"}),n.jsxs(s,{style:g,children:[o(a.reward)," ₫"]})]},i))]})})})}),n.jsx(S,{value:T,index:3,children:n.jsx(U,{title:"Ứng tiền cho nhân viên",type:"advance-salary",readOnly:!H},"cash-assets")})]})})})};function S(t){const{children:u,value:c,index:y,..._}=t;return n.jsx("div",{role:"tabpanel",hidden:c!==y,id:`nav-tabpanel-${y}`,"aria-labelledby":`nav-tab-${y}`,..._,children:c===y&&n.jsx(A,{sx:{p:3},children:u})})}export{gn as S};
