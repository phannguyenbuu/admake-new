import{r as i,c4 as vn,q as Wn,Z as Mn,s as n,X as z,A as O,V as U,v as ln}from"./index-DNMvp0xH.js";import{M as _n,a as Dn}from"./TitlePanel-JyalwT5X.js";import{J as hn,d as Bn}from"./JobAsset-CVJxsk5C.js";import{T as Cn,a as L}from"./Tabs-DfnhsGrg.js";import{T as $,a as H,d as Y,b as h,c as s}from"./TableRow-FMhcyikg.js";function En(t,f){const g=new Date(t);return g.setHours(f+7,0,0,0),g.toString()}function cn(t){return t.in?1:0}function V(t,f){if(!t.in)return 0;if(!(t!=null&&t.out)){t.out={img:"",lat:t.in.lat,long:t.in.long,time:En(t.in.time,f)};const y=(new Date(t.out.time).getTime()-new Date(t.in.time).getTime())/(1e3*60*60);t.workhour=y}return t!=null&&t.workhour&&t.workhour>1?t.workhour:0}const x=t=>t.toLocaleString("en-US",{maximumFractionDigits:0}),On=({selectedRecord:t,modalVisible:f,handleOk:g})=>{const[y,A]=i.useState(0),[P,xn]=i.useState(0),[F,dn]=i.useState(0),[b,un]=i.useState(0),[Ln,jn]=i.useState(0),[D,J]=i.useState(0),[q,K]=i.useState(0),[X,Z]=i.useState(0),[Q,R]=i.useState(0),{workpointSetting:u}=vn(),nn=(u==null?void 0:u.multiply_in_night_overtime)||0,{isMobile:o}=Wn(),B=new Date;B.getMonth();const[sn,fn]=i.useState([]),{taskDetail:m,setTaskDetail:gn}=Mn(),[G,tn]=i.useState([0,0,0,0,0]),[S,yn]=i.useState(0),[pn,mn]=i.useState(0),[Nn,Tn]=i.useState(0);i.useEffect(()=>{m&&(async()=>{try{const e=await fetch(`${ln()}/task/${t==null?void 0:t.user_id}/salary`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error("Network response was not ok "+e.statusText);const d=await e.json();gn(d.infor),tn(d.rates),console.log("Salary tasks data:",d)}catch(e){console.error("Fetch error:",e)}})()},[t,f]),i.useEffect(()=>{if(!m||!m.assets){jn(0),J(0),K(0),Z(0),R(0),tn([0,0,0,0,0]);return}let r=0,e=0,d=0;m.assets.forEach(a=>{if(a.text!==""&&a.text)if(a.type==="bonus-cash"){const c=Number(a.text.split("/")[0].replace(/\./g,""));r+=c>0?c:0,d+=c<0?c:0}else a.type==="advance-salary-cash"&&(e+=Number(a.text.split("/")[0].replace(/\./g,"")))}),K(e),Z(d),R(r)},[m]);const bn=(r,e)=>{yn(e)},en=!window.location.href.includes("/point/"),wn=async()=>{const r=await fetch(`${ln()}/task/${t==null?void 0:t.user_id}/by_user`);if(!r.ok)throw new Error(`Error fetching tasks for user ${t==null?void 0:t.user_id}`);const e=await r.json(),d=e.data??[],a=e.reward??[],c=d.filter(j=>{if(!j.end_time||j.status!=="REWARD")return!1;const w=Bn(j.end_time).toDate(),E=new Date;return w.getMonth()===E.getMonth()&&w.getFullYear()===E.getFullYear()});fn(a);const T=a.reduce((j,w)=>j+(w.reward||0),0);return J(T),c};function Sn(r,e){const d=new Date(e,r,0).getDate();let a=0;for(let c=1;c<=d;c++){const j=new Date(e,r-1,c).getDay();j===0?a+=u!=null&&u.work_in_sunday?8:0:j===6?a+=u!=null&&u.work_in_saturday_noon?8:4:a+=8}return a}i.useEffect(()=>{var rn;if(!((rn=t==null?void 0:t.items)!=null&&rn.length))return;const r=B.getMonth(),e=B.getFullYear();console.log("Current month/year:",r,e);const d=t.items.filter(k=>{var M,_,an,on;const l=k.checklist;if(!l)return!1;const v=((_=(M=l.morning)==null?void 0:M.in)==null?void 0:_.time)||((on=(an=l.noon)==null?void 0:an.in)==null?void 0:on.time);if(!v)return!1;const W=new Date(v);return W.getMonth()===r&&W.getFullYear()===e});let a=0,c=0,T=0,j=0,w=0;d.forEach(k=>{var v,W,I,M,_;const l=k.checklist;l&&(t!=null&&t.username.includes("LỘC")&&((v=l.morning)!=null&&v.in||console.log("No morning",k),(W=l.noon)!=null&&W.in||console.log("No noon",k)),(I=l.morning)!=null&&I.in&&(a+=V(l.morning,12),T+=cn(l.morning)),(M=l.noon)!=null&&M.in&&(a+=V(l.noon,17),T+=cn(l.noon)),(_=l.evening)!=null&&_.in&&(c+=V(l.evening,22)))}),console.log("✅ RESULTS:",{timeWork:a,periodWork:T,overTimeWork:c}),A(a),xn(T),dn(c),mn(j),Tn(w);const E=Sn(r+1,e),kn=t.salary/E;un(kn),wn()},[t,f,u]);const p={fontStyle:"italic",color:"red"},C={fontSize:10,minWidth:70,maxWidth:70,paddingLeft:o?0:50,paddingRight:o?0:50,whiteSpace:o?"wrap":"nowrap",borderLeft:"1px solid #666"};return n.jsx(_n,{open:f,onOk:g,onCancel:g,footer:null,title:"",okText:"OK",cancelButtonProps:{style:{display:"none"}},children:n.jsx(Dn,{children:n.jsxs(z,{sx:{width:"100%"},children:[n.jsxs(z,{sx:{width:250,borderRadius:1,backgroundColor:"#00B4B6",px:1,py:1,mb:0,position:"relative","&:after":{content:'""',position:"absolute",right:-26,top:"50%",transform:"translateY(-50%)",width:0,height:0,borderTop:"28px solid transparent",borderBottom:"28px solid transparent",borderLeft:"28px solid #00B4B6"}},children:[n.jsxs(O,{sx:{textTransform:"uppercase",color:"#ccc",fontSize:12,fontWeight:500},children:["BẢNG LƯƠNG THÁNG ",B.getMonth()+1]}),n.jsx(O,{sx:{textTransform:"uppercase",color:"#fff"},children:t==null?void 0:t.username.toUpperCase()})]}),n.jsxs(Cn,{value:S,onChange:bn,"aria-label":"nav tabs example",variant:o?"scrollable":"standard",scrollButtons:"auto",style:{marginTop:10},children:[n.jsx(L,{style:C,label:"Lương",id:"nav-tab-0","aria-controls":"nav-tabpanel-0"}),n.jsx(L,{style:C,label:"Thưởng Phạt",id:"nav-tab-1","aria-controls":"nav-tabpanel-1"}),n.jsx(L,{style:C,label:"Chuyên Cần",id:"nav-tab-2","aria-controls":"nav-tabpanel-2"}),n.jsx(L,{style:C,label:"Ứng Tiền",id:"nav-tab-3","aria-controls":"nav-tabpanel-3"})]}),n.jsxs(N,{value:S,index:0,children:[n.jsx($,{component:U,sx:{mt:o?0:2,ml:o?-10:0,width:o?400:"100%",scale:o?.75:1},children:n.jsx(H,{style:{padding:0},children:n.jsxs(Y,{children:[n.jsxs(h,{children:[n.jsx(s,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(s,{style:{fontWeight:700},children:"Giá trị"}),n.jsx(s,{style:{fontWeight:700},children:"Lương/ĐVT"}),n.jsx(s,{style:{fontWeight:700},children:"Thành tiền"})]}),n.jsxs(h,{children:[n.jsx(s,{children:"Số buổi làm"}),n.jsx(s,{children:P}),n.jsxs(s,{children:[x(b*4)," ₫"]}),n.jsxs(s,{children:[x(b*4*P)," ₫"]})]}),n.jsxs(h,{children:[n.jsx(s,{children:"Số giờ làm"}),n.jsx(s,{children:y.toLocaleString()}),n.jsx(s,{children:"-"}),n.jsx(s,{children:"-"})]}),n.jsxs(h,{children:[n.jsx(s,{children:"Tổng giờ tăng ca"}),n.jsx(s,{children:F.toFixed(3)}),n.jsxs(s,{children:[x(b*nn)," ₫"]}),n.jsxs(s,{children:[x(b*nn*F)," ₫"]})]}),n.jsxs(h,{children:[n.jsx(s,{children:"Tổng phụ cấp"}),n.jsx(s,{children:"-"}),n.jsx(s,{children:"-"}),n.jsxs(s,{children:[x(D)," ₫"]})]}),n.jsxs(h,{children:[n.jsx(s,{children:"Tổng thưởng"}),n.jsx(s,{children:"-"}),n.jsx(s,{children:"-"}),n.jsxs(s,{children:[x(Q)," ₫"]})]}),n.jsxs(h,{children:[n.jsx(s,{children:"Tổng phạt"}),n.jsx(s,{children:"-"}),n.jsx(s,{children:"-"}),n.jsxs(s,{children:[x(X)," ₫"]})]}),n.jsxs(h,{children:[n.jsx(s,{children:"Tạm ứng"}),n.jsx(s,{children:"-"}),n.jsx(s,{children:"-"}),n.jsxs(s,{children:[x(q)," ₫"]})]})]})})}),n.jsxs(O,{style:{marginTop:20,textAlign:"center",color:"#00B5B4"},children:["Tổng lương: ",x(b*4*P+b*1.5*F+D+Q+X+q)," ₫"]})]}),n.jsxs(N,{value:S,index:1,children:[n.jsx($,{component:U,sx:{mt:o?0:2,ml:o?-10:0,width:o?400:"100%",scale:o?.75:1},children:n.jsx(H,{style:{padding:0},children:n.jsxs(Y,{children:[n.jsxs(h,{children:[n.jsx(s,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(s,{style:{fontWeight:700},children:"Giá trị"}),n.jsx(s,{style:{fontWeight:700},children:"Lương/ĐVT"}),n.jsx(s,{style:{fontWeight:700},children:"Thành tiền"})]}),n.jsxs(h,{children:[n.jsx(s,{children:"Thưởng theo việc"}),n.jsxs(s,{children:[x(D)," ₫"]}),n.jsx(s,{children:"-"}),n.jsxs(s,{children:[x(D)," ₫"]})]}),sn.map((r,e)=>n.jsxs(h,{children:[n.jsxs(s,{style:p,children:["+ ",r.workspace]}),n.jsxs(s,{style:p,children:["(",r.title,")"]}),n.jsx(s,{style:p,children:"-"}),n.jsxs(s,{style:p,children:[x(r.reward)," ₫"]})]},e))]})})}),m&&n.jsx(hn,{title:"Thưởng/Phạt",type:"bonus-cash",readOnly:!en},"cash-assets")]}),n.jsx(N,{value:S,index:2,children:n.jsx($,{component:U,sx:{mt:o?0:2,ml:o?-10:0,width:o?400:"100%",scale:o?.75:1},children:n.jsx(H,{style:{padding:0},children:n.jsxs(Y,{children:[n.jsxs(h,{children:[n.jsx(s,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(s,{style:{fontWeight:700},children:"Giá trị"})]}),n.jsxs(h,{children:[n.jsx(s,{children:"Số phút đi trễ"}),n.jsx(s,{children:pn})]}),G&&G.length===5&&G.map((r,e)=>n.jsxs(h,{children:[n.jsxs(s,{children:["Số việc chấm ",e+1," sao"]}),n.jsx(s,{children:r})]})),sn.map((r,e)=>n.jsxs(h,{children:[n.jsxs(s,{style:p,children:["+ ",r.workspace]}),n.jsxs(s,{style:p,children:["(",r.title,")"]}),n.jsx(s,{style:p,children:"-"}),n.jsxs(s,{style:p,children:[x(r.reward)," ₫"]})]},e))]})})})}),n.jsx(N,{value:S,index:3,children:m&&n.jsx(hn,{title:"Ứng tiền cho nhân viên",type:"advance-salary-cash",readOnly:!en},"cash-assets")})]})})})};function N(t){const{children:f,value:g,index:y,...A}=t;return n.jsx("div",{role:"tabpanel",hidden:g!==y,id:`nav-tabpanel-${y}`,"aria-labelledby":`nav-tab-${y}`,...A,children:g===y&&n.jsx(z,{sx:{p:3},children:f})})}export{On as S};
