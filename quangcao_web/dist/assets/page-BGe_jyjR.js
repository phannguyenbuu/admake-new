import{r as n,Z as b,q as P,s,v as U}from"./index-B8c7yZsF.js";import{T as B,c as E}from"./data-DHbLBp0t.js";import{S as L}from"./SalaryBoard-CRLhyAH2.js";import{U as $}from"./dashboard-BbDE_kbO.js";import{d as l}from"./JobAsset-DrSiecme.js";import{l as D,C as W}from"./index-BelHgnED.js";import{T as _,S as f}from"./TitlePanel-DagfMKAl.js";import"./index-xdt0xqNR.js";import"./QRCode-GLkfBKGk.js";import"./Tabs-DC3qZSSq.js";import"./TableRow-w9INko9v.js";import"./auth.service-CvIRCEWX.js";import"./Send-DNJ1agkQ.js";const{Option:q}=f,et=()=>{const[o,i]=n.useState({page:1,limit:10,search:"",month:l().format("YYYY-MM")}),{setTaskDetail:S}=b(),[x,w]=n.useState([]),[j,c]=n.useState(!1),[y,Y]=n.useState(0),[m,p]=n.useState(!1),[C,h]=n.useState(null),{userLeadId:M,canViewPermission:r}=P(),k=(()=>{const t=[],e=l();let a=l("2025-11-01");for(;a.isBefore(e)||a.isSame(e,"month");)t.unshift({value:a.format("YYYY-MM"),label:a.format("MM/YYYY")}),a=a.add(1,"month");return t})(),T=t=>{h(t),p(!0)},v=()=>{p(!1),h(null)},O=t=>{i(e=>({...e,...t,page:1}))},R=async({page:t,limit:e,search:d,month:a})=>{c(!0);try{const g=await(await fetch(`${U()}/workpoint/page?`+new URLSearchParams({lead:M.toString(),page:String(t),limit:String(e),search:d,month:a}))).json();w(g.data),Y(g.pagination.total)}catch(u){console.error("Failed to fetch workpoints",u)}finally{c(!1)}};return n.useEffect(()=>{R(o)},[o]),n.useEffect(()=>{console.log("canViewPermission",r),S(null)},[]),r!=null&&r.view_workpoint?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"min-h-screen p-2 w-full",children:[s.jsx(D,{gutter:16,style:{marginBottom:16},children:s.jsxs(W,{span:6,children:[s.jsx(_.Text,{strong:!0,children:"Chọn tháng:"}),s.jsx(f,{value:o.month,onChange:t=>O({month:t}),style:{width:"100%"},placeholder:"Chọn tháng",children:k.map(t=>s.jsx(q,{value:t.value,children:t.label},t.value))})]})}),s.jsx(B,{columns:E(T,o.month),dataSource:x,loading:j,pagination:{pageSize:o.limit,current:o.page,total:y,onChange:(t,e)=>{i({...o,page:t,limit:e})},showSizeChanger:!0,showTotal:(t,e)=>`${e[0]}-${e[1]} của ${t} nhân sự`,style:{paddingRight:"15px"},locale:{items_per_page:"/ Trang"}}})]}),m&&s.jsx(L,{selectedRecord:C,modalVisible:m,handleOk:v,month:o.month})]}):s.jsx($,{})};export{et as default};
