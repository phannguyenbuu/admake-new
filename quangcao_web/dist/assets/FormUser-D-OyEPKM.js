import{b4 as n,u as I,a0 as _,r as c,a as Y,j as e,b2 as v,aZ as G,i as M,ak as E}from"./index-D0MEbSpB.js";import{F as l,R as g,C as o,I as d}from"./index-euVFnfQv.js";import{T as W}from"./index-ZoXGdvuY.js";import{S as q,s as u}from"./index-PxL5M9pQ.js";import{T as O}from"./index-CjqwyseN.js";const R={getAll:()=>n.get("/setting/get-setting"),update:s=>n.put("/setting/update-setting",s),updateStandardWorkingDays:s=>n.put("/setting/update-standard-working-days",s)},V="setting/queryAll";function X(){return I({queryKey:[V],queryFn:()=>R.getAll()})}const k={getAll:(s={})=>n.get("/user/",{params:s}),getDetail:s=>n.get(`/user/${s}`),create:s=>n.post("/user/",s),update:(s,r)=>n.put(`/user/${s}`,r),delete:s=>n.delete(`/user/${s}`)},Z="user/queryPagination";function xe(s={}){return I({queryKey:[Z,s],queryFn:()=>k.getAll(s)})}function J(){return _({mutationFn:s=>k.create(s)})}function ee(){return _({mutationFn:({dto:s,id:r})=>k.update(r,s)})}const se={getAll:()=>n.get("/role/"),getId:s=>n.get(`/role/${s}`),getPermission:()=>n.get("/role/list/permission/"),create:s=>n.post("/role/",s),update:(s,r)=>n.put(`/role/${s}`,r),delete:s=>n.delete(`/role/${s}`)},te="role/queryPagination";function ae(){return I({queryKey:[te],queryFn:()=>se.getAll()})}function ge({onCancel:s,onRefresh:r,user:a,buttonText:S,isSupplier:m,isAppend:$}){var T;const[p]=l.useForm(),[A,re]=c.useState(null),[le,ne]=c.useState(!1),h=c.useRef(null),{mutate:D,isPending:f}=J(),{mutate:L,isPending:N}=ee(),{data:j}=X(),{data:x}=ae(),{userLeadId:C}=Y(),[P,U]=c.useState(0);c.useEffect(()=>{h.current&&U(h.current.offsetWidth);function t(){h.current&&U(h.current.offsetWidth)}return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const z=((T=j==null?void 0:j.find(t=>t.key==="salary_level"))==null?void 0:T.value)||[],w=x==null?void 0:x.find(t=>{var i;return t.id===((i=a==null?void 0:a.role)==null?void 0:i.id)}),F=!!a,B=(Array.isArray(x)&&x||[]).map(t=>({label:t.name,value:t.id}));z.map(t=>({label:`Bậc ${t.index} - ${t.salary.toLocaleString("vi-VN")} VNĐ`,value:t.index}));const H=()=>S||(F?"Cập nhật":"Tạo");c.useEffect(()=>{var t;a?p.setFieldsValue({lead_id:C,fullName:a.fullName,phone:a.phone,username:a.username,password:a.password,role_id:m?101:w?w.id:(t=a.role)==null?void 0:t.id,salary:a.salary,gender:a.gender,address:a.address,citizenId:a.citizenId,email:a.email,facebookAccount:a.facebookAccount,bankAccount:a.bankAccount,referrer:a.referrer}):p.resetFields()},[a,p,w]);const K=()=>{a&&fetch(`${M()}/user/${a.id}`,{method:"DELETE"}).then(t=>{t.ok||E.error({message:"Xóa user thất bại"}),E.success({message:`User ${a.fullName} đã được xóa`}),r&&r(),s&&s()}).catch(t=>{E.error({message:"Lỗi khi xóa user:",description:t}),s&&s()})},Q=async t=>{try{const i=new FormData;Object.entries(t).forEach(([b,y])=>{m&&b==="role_id"&&(y=101),b==="avatar"&&A?i.append(b,A):y!=null&&i.append(b,y.toString())}),t.password&&t.password.trim()!==""&&i.append("password",t.password),i.append("lead_id",C.toString()),console.log("Create User",i),F&&a?L({dto:i,id:a.id},{onSuccess:()=>{u.success("Cập nhật người dùng thành công!"),s(),r==null||r()},onError:()=>u.error("Có lỗi xảy ra khi cập nhật người dùng!")}):D(i,{onSuccess:()=>{u.success("Tạo người dùng thành công!"),s(),r==null||r()},onError:()=>u.error("Có lỗi xảy ra khi tạo người dùng!")})}catch{u.error("Có lỗi xảy ra!")}};return e.jsxs("div",{ref:h,className:`
        w-full max-w-4xl mx-auto bg-white rounded-lg sm:rounded-xl lg:rounded-2xl
        shadow-lg sm:shadow-xl lg:shadow-2xl p-3 sm:p-4 border border-gray-100
        flex flex-col overflow-hidden
        max-h-[calc(100vh-200px)] -mt-13 sm:max-h-[calc(100vh-120px)]
      `,children:[e.jsx(v,{type:"text",icon:e.jsx(G,{}),onClick:s,style:{position:"relative",marginLeft:P-60},size:"small"}),e.jsx(W.Title,{level:3,className:"text-center !text-[#00B4B6] !mb-4 sm:mb-6 !font-bold !text-lg sm:!text-xl lg:!text-2xl flex-shrink-0",children:m?"BẢNG THẦU PHỤ":"BẢNG NHÂN SỰ"}),e.jsxs(l,{form:p,layout:"vertical",onFinish:Q,autoComplete:"off",className:"flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto space-y-3 sm:space-y-4 pr-2 scrollbar-thin scrollbar-thumb-cyan-500 scrollbar-track-gray-100 hover:scrollbar-thumb-cyan-600",children:[e.jsxs(g,{gutter:[16,16],children:[e.jsx(o,{xs:24,sm:12,lg:12,children:e.jsx(l.Item,{name:"fullName",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Họ và tên:"}),rules:[{required:!0,message:"Nhập họ tên nhân sự"}],className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập họ tên nhân sự",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})}),e.jsx(o,{xs:24,sm:12,lg:12,children:e.jsx(l.Item,{name:"phone",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Số điện thoại:"}),rules:[{required:!0,message:"Nhập số điện thoại"}],className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập số điện thoại",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})})]}),!m&&e.jsxs(g,{gutter:[16,16],children:[e.jsx(o,{xs:24,sm:12,lg:12,children:e.jsx(l.Item,{name:"role_id",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Chức vụ:"}),rules:[{required:!0,message:"Chọn chức vụ"}],className:"!mb-0",children:e.jsx(q,{placeholder:"Chọn chức vụ",options:B,showSearch:!0,allowClear:!0,optionFilterProp:"label",getPopupContainer:()=>document.body,dropdownStyle:{zIndex:1e4},className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})}),e.jsx(o,{xs:24,sm:12,lg:12,children:e.jsx(l.Item,{name:"salary",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Lương:"}),className:"!mb-0",children:e.jsx(O,{style:{width:"100%"},placeholder:"Nhập số tiền lương",formatter:t=>t?t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".").replace(",",","):"",parser:t=>t?t.replace(/\./g,"").replace(",","."):""})})})]}),e.jsxs(g,{gutter:[16,16],children:[e.jsx(o,{xs:24,sm:12,lg:12,children:e.jsx(l.Item,{name:"gender",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Giới tính:"}),className:"!mb-0",children:e.jsx(q,{placeholder:"Chọn giới tính",options:[{label:"Nam",value:"male"},{label:"Nữ",value:"female"},{label:"Khác",value:"other"}],allowClear:!0,getPopupContainer:()=>document.body,className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})}),e.jsx(o,{xs:24,sm:12,lg:12,children:e.jsx(l.Item,{name:"address",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Địa chỉ:"}),className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập địa chỉ",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})})]}),e.jsxs(g,{gutter:[16,16],children:[e.jsx(o,{xs:24,sm:12,lg:12,children:e.jsx(l.Item,{name:"citizenId",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Căn cước công dân:"}),className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập số căn cước",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})}),e.jsx(o,{xs:24,sm:12,lg:12,children:e.jsx(l.Item,{name:"email",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Email:"}),className:"!mb-0",rules:[{type:"email",message:"Email không hợp lệ"}],children:e.jsx(d,{placeholder:"Nhập email",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})})]}),e.jsxs(g,{gutter:[16,16],children:[e.jsx(o,{xs:24,sm:12,lg:8,children:e.jsx(l.Item,{name:"bankAccount",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Tài khoản ngân hàng:"}),className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập tài khoản ngân hàng",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})}),e.jsx(o,{xs:24,sm:12,lg:8,children:e.jsx(l.Item,{name:"facebookAccount",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Tài khoản facebook:"}),className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập tài khoản facebook",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})}),e.jsx(o,{xs:24,sm:12,lg:8,children:e.jsx(l.Item,{name:"taxCode",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Mã số thuế cá nhân:"}),className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập mã số thuế cá nhân",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})}),e.jsx(o,{xs:24,sm:12,lg:8,children:e.jsx(l.Item,{name:"referrer",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Người giới thiệu:"}),className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập tên người giới thiệu",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-3 sm:gap-4 lg:gap-6 mt-4 sm:mt-6 flex-shrink-0",children:[!$&&e.jsx(v,{onClick:K,disabled:f||N,className:"!border-cyan-400 !text-cyan-500 !text-sm sm:!text-base !font-semibold !px-6 sm:!px-8 !py-2 sm:!py-3 !h-9 sm:!h-10 !min-w-[100px] sm:!min-w-[120px] !rounded-lg hover:!bg-cyan-50 hover:!border-cyan-500 !transition-all !duration-300 !shadow-lg hover:!shadow-xl !order-2 sm:!order-1",children:m?"XÓA THẦU PHỤ":"XÓA NHÂN SỰ"}),e.jsx(v,{type:"primary",htmlType:"submit",loading:f||N,className:"!bg-cyan-500 !border-cyan-500 !text-white !text-sm sm:!text-base !font-semibold !px-6 sm:!px-8 !py-2 sm:!py-3 !h-9 sm:!h-10 !min-w-[100px] sm:!min-w-[120px] !rounded-lg hover:!bg-cyan-600 hover:!border-cyan-600 !transition-all !duration-300 !shadow-xl hover:!shadow-2xl hover:!scale-105 !order-1 sm:!order-2",children:f||N?"Đang xử lý...":H()})]})]})]})}export{ge as F,xe as u};
