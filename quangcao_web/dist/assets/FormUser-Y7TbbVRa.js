import{l as i,n as T,r as c,q as H,s as e,B as w,av as L,v as $,t as v}from"./index-B8c7yZsF.js";import{d as K,e as Q}from"./dashboard-BbDE_kbO.js";import{F as r,l as b,C as l,I as d}from"./index-BelHgnED.js";import{T as G,S as A,s as p}from"./TitlePanel-DagfMKAl.js";import{T as W}from"./JobAsset-DrSiecme.js";const Y={getAll:()=>i.get("/setting/get-setting"),update:a=>i.put("/setting/update-setting",a),updateStandardWorkingDays:a=>i.put("/setting/update-standard-working-days",a)},M="setting/queryAll";function O(){return T({queryKey:[M],queryFn:()=>Y.getAll()})}const X={getAll:()=>i.get("/role/"),getId:a=>i.get(`/role/${a}`),getPermission:()=>i.get("/role/list/permission/"),create:a=>i.post("/role/",a),update:(a,o)=>i.put(`/role/${a}`,o),delete:a=>i.delete(`/role/${a}`)},R="role/queryPagination";function V(){return T({queryKey:[R],queryFn:()=>X.getAll()})}function de({onCancel:a,onRefresh:o,user:t,buttonText:I,isSupplier:m,isAppend:U}){const[f]=r.useForm(),[k,J]=c.useState(null),[Z,ee]=c.useState(!1),h=c.useRef(null),{mutate:F,isPending:y}=K(),{mutate:q,isPending:N}=Q(),{data:se}=O(),{data:x}=V(),{userLeadId:E}=H(),[D,C]=c.useState(0);c.useEffect(()=>{h.current&&C(h.current.offsetWidth);function s(){h.current&&C(h.current.offsetWidth)}return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const j=x==null?void 0:x.find(s=>{var n;return s.id===((n=t==null?void 0:t.role)==null?void 0:n.id)}),S=!!t,P=(Array.isArray(x)&&x||[]).map(s=>({label:s.name,value:s.id})),_=()=>I||(S?"Cập nhật":"Tạo");c.useEffect(()=>{var s;t?f.setFieldsValue({lead_id:E,fullName:t.fullName,phone:t.phone,username:t.username,password:t.password,role_id:m?101:j?j.id:(s=t.role)==null?void 0:s.id,salary:t.salary,gender:t.gender,address:t.address,citizenId:t.citizenId,email:t.email,facebookAccount:t.facebookAccount,bankAccount:t.bankAccount,referrer:t.referrer}):f.resetFields()},[t,f,j]);const z=()=>{t&&fetch(`${$()}/user/${t.id}`,{method:"DELETE"}).then(s=>{s.ok||v.error({message:"Xóa user thất bại"}),v.success({message:`User ${t.fullName} đã được xóa`}),o&&o(),a&&a()}).catch(s=>{v.error({message:"Lỗi khi xóa user:",description:s}),a&&a()})},B=async s=>{try{const n=new FormData;console.log("Role",m,s),Object.entries(s).forEach(([g,u])=>{g==="avatar"&&k?n.append(g,k):u!=null&&n.append(g,u.toString())}),m&&n.append("role_id","101"),s.password&&s.password.trim()!==""&&n.append("password",s.password),n.append("lead_id",E.toString()),console.log("Create User");for(const[g,u]of n.entries())console.log(`${g}:`,u);S&&t?q({dto:n,id:t.id},{onSuccess:()=>{p.success("Cập nhật người dùng thành công!"),a(),o==null||o()},onError:()=>p.error("Có lỗi xảy ra khi cập nhật người dùng!")}):F(n,{onSuccess:()=>{p.success("Tạo người dùng thành công!"),a(),o==null||o()},onError:()=>p.error("Có lỗi xảy ra khi tạo người dùng!")})}catch{p.error("Có lỗi xảy ra!")}};return e.jsxs("div",{ref:h,className:`
        w-full max-w-4xl mx-auto bg-white rounded-lg sm:rounded-xl lg:rounded-2xl
        shadow-lg sm:shadow-xl lg:shadow-2xl p-3 sm:p-4 border border-gray-100
        flex flex-col overflow-hidden
        max-h-[calc(100vh-200px)] -mt-13 sm:max-h-[calc(100vh-120px)]
      `,children:[e.jsx(w,{type:"text",icon:e.jsx(L,{}),onClick:a,style:{position:"relative",marginLeft:D-60},size:"small"}),e.jsx(G.Title,{level:3,className:"text-center !text-[#00B4B6] !mb-4 sm:mb-6 !font-bold !text-lg sm:!text-xl lg:!text-2xl flex-shrink-0",children:m?"BẢNG THẦU PHỤ":"BẢNG NHÂN SỰ"}),e.jsxs(r,{form:f,layout:"vertical",onFinish:B,autoComplete:"off",className:"flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto space-y-3 sm:space-y-4 pr-2 scrollbar-thin scrollbar-thumb-cyan-500 scrollbar-track-gray-100 hover:scrollbar-thumb-cyan-600",children:[e.jsxs(b,{gutter:[16,16],children:[e.jsx(l,{xs:24,sm:12,lg:12,children:e.jsx(r.Item,{name:"fullName",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Họ và tên:"}),rules:[{required:!0,message:"Nhập họ tên nhân sự"}],className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập họ tên nhân sự",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})}),e.jsx(l,{xs:24,sm:12,lg:12,children:e.jsx(r.Item,{name:"phone",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Số điện thoại:"}),rules:[{required:!0,message:"Nhập số điện thoại"}],className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập số điện thoại",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})})]}),!m&&e.jsxs(b,{gutter:[16,16],children:[e.jsx(l,{xs:24,sm:12,lg:12,children:e.jsx(r.Item,{name:"role_id",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Chức vụ:"}),rules:[{required:!0,message:"Chọn chức vụ"}],className:"!mb-0",children:e.jsx(A,{placeholder:"Chọn chức vụ",options:P,showSearch:!0,allowClear:!0,optionFilterProp:"label",getPopupContainer:()=>document.body,dropdownStyle:{zIndex:1e4},className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})}),e.jsx(l,{xs:24,sm:12,lg:12,children:e.jsx(r.Item,{name:"salary",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Lương:"}),className:"!mb-0",children:e.jsx(W,{style:{width:"100%"},placeholder:"Nhập số tiền lương",formatter:s=>s?s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".").replace(",",","):"",parser:s=>s?s.replace(/\./g,"").replace(",","."):""})})})]}),e.jsxs(b,{gutter:[16,16],children:[e.jsx(l,{xs:24,sm:12,lg:12,children:e.jsx(r.Item,{name:"gender",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Giới tính:"}),className:"!mb-0",children:e.jsx(A,{placeholder:"Chọn giới tính",options:[{label:"Nam",value:"male"},{label:"Nữ",value:"female"},{label:"Khác",value:"other"}],allowClear:!0,getPopupContainer:()=>document.body,className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})}),e.jsx(l,{xs:24,sm:12,lg:12,children:e.jsx(r.Item,{name:"address",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Địa chỉ:"}),className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập địa chỉ",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})})]}),e.jsxs(b,{gutter:[16,16],children:[e.jsx(l,{xs:24,sm:12,lg:12,children:e.jsx(r.Item,{name:"citizenId",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Căn cước công dân:"}),className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập số căn cước",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})}),e.jsx(l,{xs:24,sm:12,lg:12,children:e.jsx(r.Item,{name:"email",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Email:"}),className:"!mb-0",rules:[{type:"email",message:"Email không hợp lệ"}],children:e.jsx(d,{placeholder:"Nhập email",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})})]}),e.jsxs(b,{gutter:[16,16],children:[e.jsx(l,{xs:24,sm:12,lg:8,children:e.jsx(r.Item,{name:"bankAccount",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Tài khoản ngân hàng:"}),className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập tài khoản ngân hàng",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})}),e.jsx(l,{xs:24,sm:12,lg:8,children:e.jsx(r.Item,{name:"facebookAccount",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Tài khoản facebook:"}),className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập tài khoản facebook",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})}),e.jsx(l,{xs:24,sm:12,lg:8,children:e.jsx(r.Item,{name:"taxCode",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Mã số thuế cá nhân:"}),className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập mã số thuế cá nhân",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})}),e.jsx(l,{xs:24,sm:12,lg:8,children:e.jsx(r.Item,{name:"referrer",label:e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Người giới thiệu:"}),className:"!mb-0",children:e.jsx(d,{placeholder:"Nhập tên người giới thiệu",className:"!text-sm sm:!text-base !h-9 sm:!h-10 !rounded-lg !border-gray-300 focus:!border-cyan-500 !shadow-lg hover:!shadow-xl !transition-all !duration-300"})})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-3 sm:gap-4 lg:gap-6 mt-4 sm:mt-6 flex-shrink-0",children:[!U&&e.jsx(w,{onClick:z,disabled:y||N,className:"!border-cyan-400 !text-cyan-500 !text-sm sm:!text-base !font-semibold !px-6 sm:!px-8 !py-2 sm:!py-3 !h-9 sm:!h-10 !min-w-[100px] sm:!min-w-[120px] !rounded-lg hover:!bg-cyan-50 hover:!border-cyan-500 !transition-all !duration-300 !shadow-lg hover:!shadow-xl !order-2 sm:!order-1",children:m?"XÓA THẦU PHỤ":"XÓA NHÂN SỰ"}),e.jsx(w,{type:"primary",htmlType:"submit",loading:y||N,className:"!bg-cyan-500 !border-cyan-500 !text-white !text-sm sm:!text-base !font-semibold !px-6 sm:!px-8 !py-2 sm:!py-3 !h-9 sm:!h-10 !min-w-[100px] sm:!min-w-[120px] !rounded-lg hover:!bg-cyan-600 hover:!border-cyan-600 !transition-all !duration-300 !shadow-xl hover:!shadow-2xl hover:!scale-105 !order-1 sm:!order-2",children:y||N?"Đang xử lý...":_()})]})]})]})}export{de as F};
