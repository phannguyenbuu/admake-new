import{r as i,c4 as Mn,q as Wn,Z as Dn,s as n,X as q,A as U,V as O,v as H}from"./index-CC-dsR2w.js";import{M as Bn,a as Cn}from"./TitlePanel-BIg70oZi.js";import{J as cn,d as En}from"./JobAsset-Dzx5qRxS.js";import{T as Ln,a as L}from"./Tabs-AN1c8nJx.js";import{T as Y,a as V,d as z,b as c,c as t}from"./TableRow-DOZIULxC.js";function Nn(s,d){const g=new Date(s);return g.setHours(d+7,0,0,0),g.toString()}function xn(s){return s.in?1:0}function J(s,d){if(!s.in)return 0;if(!(s!=null&&s.out)){s.out={img:"",lat:s.in.lat,long:s.in.long,time:Nn(s.in.time,d)};const p=(new Date(s.out.time).getTime()-new Date(s.in.time).getTime())/(1e3*60*60);s.workhour=p}return s!=null&&s.workhour&&s.workhour>1?s.workhour:0}const u=s=>s.toLocaleString("en-US",{maximumFractionDigits:0}),On=({selectedRecord:s,modalVisible:d,handleOk:g})=>{const[p,I]=i.useState(0),[$,un]=i.useState(0),[A,jn]=i.useState(0),[y,fn]=i.useState(0),[K,F]=i.useState([]),[In,dn]=i.useState(0),[W,X]=i.useState(0),[Z,Q]=i.useState(0),[R,nn]=i.useState(0),[sn,tn]=i.useState(0),{workpointSetting:j}=Mn(),an=(j==null?void 0:j.multiply_in_night_overtime)||0,{isMobile:o}=Wn(),D=new Date;D.getMonth();const[gn,pn]=i.useState([]),{taskDetail:b,setTaskDetail:yn}=Dn(),[G,rn]=i.useState([0,0,0,0,0]),[w,mn]=i.useState(0),[Tn,bn]=i.useState(0),[$n,wn]=i.useState(0);i.useEffect(()=>{F([]),b?(async()=>{try{const a=await fetch(`${H()}/task/${s==null?void 0:s.user_id}/salary`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error("Network response was not ok "+a.statusText);const l=await a.json();yn(l.infor),rn(l.rates),F(l.messages),console.log("Salary tasks data:",l)}catch(a){console.error("Fetch error:",a)}})():(async()=>{try{const a=await fetch(`${H()}/workpoint/${s==null?void 0:s.user_id}/salary`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error("Network response was not ok "+a.statusText);const l=await a.json();F(l.messages),console.log("Salary tasks data:",s==null?void 0:s.user_id,l)}catch(a){console.error("Fetch error:",a)}})()},[s,d]),i.useEffect(()=>{if(!b||!b.assets){dn(0),X(0),Q(0),nn(0),tn(0),rn([0,0,0,0,0]);return}let r=0,a=0,l=0;b.assets.forEach(e=>{if(e.text!==""&&e.text)if(e.type==="bonus-cash"){const x=Number(e.text.split("/")[0].replace(/\./g,""));r+=x>0?x:0,l+=x<0?x:0}else e.type==="advance-salary-cash"&&(a+=Number(e.text.split("/")[0].replace(/\./g,"")))}),Q(a),nn(l),tn(r)},[b]);const Sn=(r,a)=>{mn(a)},en=!window.location.href.includes("/point/"),kn=async()=>{const r=await fetch(`${H()}/task/${s==null?void 0:s.user_id}/by_user`);if(!r.ok)throw new Error(`Error fetching tasks for user ${s==null?void 0:s.user_id}`);const a=await r.json(),l=a.data??[],e=a.reward??[],x=l.filter(f=>{if(!f.end_time||f.status!=="REWARD")return!1;const T=En(f.end_time).toDate(),E=new Date;return T.getMonth()===E.getMonth()&&T.getFullYear()===E.getFullYear()});pn(e);const m=e.reduce((f,T)=>f+(T.reward||0),0);return X(m),x};function vn(r,a){const l=new Date(a,r,0).getDate();let e=0;for(let x=1;x<=l;x++){const f=new Date(a,r-1,x).getDay();f===0?e+=j!=null&&j.work_in_sunday?8:0:f===6?e+=j!=null&&j.work_in_saturday_noon?8:4:e+=8}return e}i.useEffect(()=>{var on;if(!((on=s==null?void 0:s.items)!=null&&on.length))return;const r=D.getMonth(),a=D.getFullYear(),l=s.items.filter(S=>{var _,M,ln,hn;const h=S.checklist;if(!h)return!1;const k=((M=(_=h.morning)==null?void 0:_.in)==null?void 0:M.time)||((hn=(ln=h.noon)==null?void 0:ln.in)==null?void 0:hn.time);if(!k)return!1;const v=new Date(k);return v.getMonth()===r&&v.getFullYear()===a});let e=0,x=0,m=0,f=0,T=0;l.forEach(S=>{var k,v,P,_,M;const h=S.checklist;h&&(s!=null&&s.username.includes("LỘC")&&((k=h.morning)!=null&&k.in||console.log("No morning",S),(v=h.noon)!=null&&v.in||console.log("No noon",S)),(P=h.morning)!=null&&P.in&&(e+=J(h.morning,12),m+=xn(h.morning)),(_=h.noon)!=null&&_.in&&(e+=J(h.noon,17),m+=xn(h.noon)),(M=h.evening)!=null&&M.in&&(x+=J(h.evening,22)))}),I(e),un(m),jn(x),bn(f),wn(T);const E=vn(r+1,a),_n=s.salary/E;fn(_n),kn()},[s,d,j]);const B={fontStyle:"italic",color:"red"},C={fontSize:10,minWidth:70,maxWidth:70,paddingLeft:o?0:50,paddingRight:o?0:50,whiteSpace:o?"wrap":"nowrap",borderLeft:"1px solid #666"};return n.jsx(Bn,{open:d,onOk:g,onCancel:g,footer:null,title:"",okText:"OK",cancelButtonProps:{style:{display:"none"}},children:n.jsx(Cn,{children:n.jsxs(q,{sx:{width:"100%"},children:[n.jsxs(q,{sx:{width:250,borderRadius:1,backgroundColor:"#00B4B6",px:1,py:1,mb:0,position:"relative","&:after":{content:'""',position:"absolute",right:-26,top:"50%",transform:"translateY(-50%)",width:0,height:0,borderTop:"28px solid transparent",borderBottom:"28px solid transparent",borderLeft:"28px solid #00B4B6"}},children:[n.jsxs(U,{sx:{textTransform:"uppercase",color:"#ccc",fontSize:12,fontWeight:500},children:["BẢNG LƯƠNG THÁNG ",D.getMonth()+1]}),n.jsx(U,{sx:{textTransform:"uppercase",color:"#fff"},children:s==null?void 0:s.username.toUpperCase()})]}),n.jsxs(Ln,{value:w,onChange:Sn,"aria-label":"nav tabs example",variant:o?"scrollable":"standard",scrollButtons:"auto",style:{marginTop:10},children:[n.jsx(L,{style:C,label:"Lương",id:"nav-tab-0","aria-controls":"nav-tabpanel-0"}),n.jsx(L,{style:C,label:"Thưởng Phạt",id:"nav-tab-1","aria-controls":"nav-tabpanel-1"}),n.jsx(L,{style:C,label:"Chuyên Cần",id:"nav-tab-2","aria-controls":"nav-tabpanel-2"}),n.jsx(L,{style:C,label:"Ứng Tiền",id:"nav-tab-3","aria-controls":"nav-tabpanel-3"})]}),n.jsxs(N,{value:w,index:0,children:[n.jsx(Y,{component:O,sx:{mt:o?0:2,ml:o?-10:0,width:o?400:"100%",scale:o?.75:1},children:n.jsx(V,{style:{padding:0},children:n.jsxs(z,{children:[n.jsxs(c,{children:[n.jsx(t,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(t,{style:{fontWeight:700},children:"Giá trị"}),n.jsx(t,{style:{fontWeight:700},children:"Lương/ĐVT"}),n.jsx(t,{style:{fontWeight:700},children:"Thành tiền"})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Số buổi làm"}),n.jsx(t,{children:$}),n.jsxs(t,{children:[u(y*4)," ₫"]}),n.jsxs(t,{children:[u(y*4*$)," ₫"]})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Số giờ làm"}),n.jsx(t,{children:p.toLocaleString()}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Tổng giờ tăng ca"}),n.jsx(t,{children:A.toFixed(3)}),n.jsxs(t,{children:[u(y*an)," ₫"]}),n.jsxs(t,{children:[u(y*an*A)," ₫"]})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Tổng phụ cấp"}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[u(W)," ₫"]})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Tổng thưởng"}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[u(sn)," ₫"]})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Tổng phạt"}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[u(R)," ₫"]})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Tạm ứng"}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[u(Z)," ₫"]})]})]})})}),n.jsxs(U,{style:{marginTop:20,textAlign:"center",color:"#00B5B4"},children:["Tổng lương: ",u(y*4*$+y*1.5*A+W+sn+R+Z)," ₫"]})]}),n.jsxs(N,{value:w,index:1,children:[n.jsx(Y,{component:O,sx:{mt:o?0:2,ml:o?-10:0,width:o?400:"100%",scale:o?.75:1},children:n.jsx(V,{style:{padding:0},children:n.jsxs(z,{children:[n.jsxs(c,{children:[n.jsx(t,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(t,{style:{fontWeight:700},children:"Giá trị"}),n.jsx(t,{style:{fontWeight:700},children:"Lương/ĐVT"}),n.jsx(t,{style:{fontWeight:700},children:"Thành tiền"})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Thưởng theo việc"}),n.jsxs(t,{children:[u(W)," ₫"]}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[u(W)," ₫"]})]}),gn.map((r,a)=>n.jsxs(c,{children:[n.jsxs(t,{style:B,children:["+ ",r.workspace]}),n.jsxs(t,{style:B,children:["(",r.title,")"]}),n.jsx(t,{style:B,children:"-"}),n.jsxs(t,{style:B,children:[u(r.reward)," ₫"]})]},a))]})})}),n.jsx(cn,{targetUserId:s==null?void 0:s.user_id,messages:K.filter(r=>r.type==="bonus-cash"),title:"Thưởng/Phạt",type:"bonus-cash",readOnly:!en},"cash-assets")]}),n.jsx(N,{value:w,index:2,children:n.jsx(Y,{component:O,sx:{mt:o?0:2,ml:o?-10:0,width:o?400:"100%",scale:o?.75:1},children:n.jsx(V,{style:{padding:0},children:n.jsxs(z,{children:[n.jsxs(c,{children:[n.jsx(t,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(t,{style:{fontWeight:700},children:"Giá trị"})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Số phút đi trễ"}),n.jsx(t,{children:Tn})]}),G&&G.length===5&&G.map((r,a)=>n.jsxs(c,{children:[n.jsxs(t,{children:["Số việc chấm ",a+1," sao"]}),n.jsx(t,{children:r})]}))]})})})}),n.jsx(N,{value:w,index:3,children:n.jsx(cn,{targetUserId:s==null?void 0:s.user_id,messages:K.filter(r=>r.type==="advance-salary-cash"),title:"Ứng tiền cho nhân viên",type:"advance-salary-cash",readOnly:!en},"cash-assets")})]})})})};function N(s){const{children:d,value:g,index:p,...I}=s;return n.jsx("div",{role:"tabpanel",hidden:g!==p,id:`nav-tabpanel-${p}`,"aria-labelledby":`nav-tab-${p}`,...I,children:g===p&&n.jsx(q,{sx:{p:3},children:d})})}export{On as S};
