import{r as e,v as n,a7 as v,aM as B,a6 as E,U as W,ae as U,af as L,ag as N,ak as O,ai as y,aj as s,a2 as _,ac as F}from"./index-CbZL9ZyR.js";import{T as H,c as I}from"./data-D9JNdpgB.js";import"./index-CO1hwu7I.js";const M=1.5;function P(t,i){const o=new Date(i,t,0).getDate();let a=0;for(let u=1;u<=o;u++){const d=new Date(i,t-1,u).getDay();d!==0&&(d===6?a+=4:a+=8)}return a}function G(t,i){const o=new Date(t);return o.setHours(i+7,0,0,0),o.toString()}function b(t,i){if(!t.in)return 0;if(!(t!=null&&t.out)){t.out={img:"",lat:t.in.lat,long:t.in.long,time:G(t.in.time,i)};const a=(new Date(t.out.time).getTime()-new Date(t.in.time).getTime())/(1e3*60*60);t.workhour=a}return t!=null&&t.workhour&&t.workhour>1?t.workhour:0}const x=t=>t.toLocaleString("en-US",{maximumFractionDigits:0}),V=({selectedRecord:t,modalVisible:i,handleOk:o})=>{const[a,u]=e.useState(0),[g,d]=e.useState(0),[h,S]=e.useState(0),[T,m]=e.useState(0),[f,C]=e.useState(0),p=new Date,k=P(p.getMonth()+1,p.getFullYear());return e.useEffect(()=>{if(console.log("selectedRecord",t),!t)return;let j=0,r=0;t.items&&t.items.forEach(w=>{const l=w.checklist;l&&(l.morning&&(j+=b(l.morning,12)),l.noon&&(j+=b(l.noon,17)),l.evening&&(r+=b(l.evening,22)))}),u(j),d(r);const c=t.salary/k;S(c),m((j+r*M)*c)},[t]),n.jsx(v,{open:i,onOk:o,onCancel:o,footer:null,title:"",okText:"OK",cancelButtonProps:{style:{display:"none"}},style:{padding:20,minWidth:"80vw"},children:n.jsxs(B,{children:[n.jsx(E,{sx:{borderRadius:10,backgroundColor:"#00B4B6",px:5,py:1,mb:2},children:n.jsxs(W,{sx:{textTransform:"uppercase",color:"#fff",fontWeight:500,textAlign:"center"},children:["BẢNG LƯƠNG THÁNG ",p.getMonth()+1]})}),n.jsx(W,{children:t==null?void 0:t.username.toUpperCase()}),n.jsx(W,{style:{fontWeight:300,fontSize:12,fontStyle:"italic"},children:t==null?void 0:t.userrole}),n.jsx(U,{component:L,sx:{mt:2},children:n.jsx(N,{children:n.jsxs(O,{children:[n.jsxs(y,{children:[n.jsx(s,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(s,{style:{fontWeight:700},children:"Giá trị"}),n.jsx(s,{style:{fontWeight:700},children:"Lương giờ"}),n.jsx(s,{style:{fontWeight:700},children:"Nhân hệ số"}),n.jsx(s,{style:{fontWeight:700},children:"Thành tiền"})]}),n.jsxs(y,{children:[n.jsx(s,{children:"Tổng giờ làm trong tháng"}),n.jsx(s,{children:a.toFixed(3)}),n.jsxs(s,{children:[x(h)," ₫"]}),n.jsx(s,{children:"1.0"}),n.jsxs(s,{children:[x(h*1*a)," ₫"]})]}),n.jsxs(y,{children:[n.jsx(s,{children:"Tổng giờ tăng ca trong tháng"}),n.jsx(s,{children:g.toFixed(3)}),n.jsxs(s,{children:[x(h)," ₫"]}),n.jsx(s,{children:M}),n.jsxs(s,{children:[x(h*M*g)," ₫"]})]}),n.jsxs(y,{children:[n.jsx(s,{children:"Thưởng theo việc"}),n.jsxs(s,{children:[x(f)," ₫"]}),n.jsx(s,{children:"-"}),n.jsx(s,{children:"-"}),n.jsxs(s,{children:[x(f)," ₫"]})]}),n.jsxs(y,{children:[n.jsx(s,{style:{fontWeight:700},children:"Tổng lương"}),n.jsx(s,{children:"-"}),n.jsx(s,{children:"-"}),n.jsx(s,{children:"-"}),n.jsxs(s,{children:[x(h*1*a+h*1.5*g+f)," ₫"]})]})]})})})]})})},q=()=>{const[t,i]=e.useState({page:1,limit:10,search:""}),[o,a]=e.useState([]),[u,g]=e.useState(!1),[d,h]=e.useState(0),[S,T]=e.useState(!1),[m,f]=e.useState(null),{userLeadId:C}=_(),p=r=>{f(r),T(!0)},k=()=>{T(!1),f(null)},j=async({page:r,limit:c,search:w})=>{g(!0);try{const D=await(await fetch(`${F()}/workpoint/page?`+new URLSearchParams({lead:C.toString(),page:String(r),limit:String(c),search:w}))).json();a(D.data),h(D.pagination.total)}catch(l){console.error("Failed to fetch users",l)}finally{g(!1)}};return e.useEffect(()=>{j(t)},[t]),e.useEffect(()=>{console.log("Workpoints",o)},[o]),n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"min-h-screen p-2 w-full",children:n.jsx(H,{columns:I(p),dataSource:o,loading:u,pagination:{pageSize:t.limit,current:t.page,total:d,onChange:(r,c)=>{i({...t,page:r,limit:c})},showSizeChanger:!0,showTotal:(r,c)=>`${c[0]}-${c[1]} của ${r} nhân sự`,style:{paddingRight:"15px"},locale:{items_per_page:"/ Trang"}}})}),S&&n.jsx(V,{selectedRecord:m,modalVisible:S,handleOk:k})]})};export{q as default};
