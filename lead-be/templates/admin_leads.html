<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Leads</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">


    <style>
        table.table-striped.table-bordered tbody tr {
            max-height: 30px; /* giảm chiều cao hàng */
        }
        table.table-striped.table-bordered tbody tr td,
        table.table-striped.table-bordered tbody tr th {
            padding-top: 0px;
            padding-bottom: 0px;
            vertical-align: middle;
        }
        table.table-striped.table-bordered tbody tr td p {
            margin: 0;
            font-size: 12px; /* giảm cỡ chữ trong thẻ p */
        }
    </style>
</head>
<body>
  
    <div class="container-fluid" style="padding: 20px;background-color: #00B4B6;color:#fff">
      <a class="navbar-brand" href="#">ADMAKE ADMIN</a>
    </div>
  
  <div class="container mt-4">
    <h1 class="mb-4">Danh sách khách hàng</h1>
            <table class="table table-striped table-bordered table-sm">
      <thead class="table-light" style="background-color: #00B4B6;">
        <tr>
          <th style="width: 30px;">
            Inv
          </th>
          <th style="width: 30px;">
            Act
          </th>
          <th>ID</th>
          <th style="width:200px">Họ và tên</th>
          <th style="width:200px">Username</th>
          <th style="width:200px">Công ty</th>
          
          <th>Liên hệ</th>
          <th style="width:200px">Nhu cầu</th>
          
          <!-- <th style="width:200px; font-size:10px">Quy mô công ty</th> -->
          <th style="width:100px">Số dư</th>
          <th style="width:200px; font-size:10px">Ngày đăng ký/gia hạn/hết hạn</th>
          <th style="width:300px; font-size:10px">({{total_users}})</th>

        </tr>
      </thead>
      <tbody>
        {% for lead in leads %}
        <tr>
          <td>
            <input type="checkbox" name="selected_leads" value="{{ lead.id }}" {% if lead.isInvited %}checked{% endif %} />
          </td>
          <td>
            <input type="checkbox" name="activated_leads" value="{{ lead.id }}" {% if lead.isActivated %}checked{% endif %} />
          </td>
          <td>{{ lead.id }}</td>
          <td>{{ lead.name }}</td>
          <td>
            <p>{{ lead.username }}</p>
            <p style="font-size:10px">{{ lead.password }}</p>
          </td>
          <td>
            <p>{{ lead.company }}</p>
            <p style="font-size:10px">{{ lead.companySize }}</p>
          </td>
          
          <td>
            <p>{{ lead.phone }}</p>
            <p style="font-size:10px;text-transform: lowercase;">{{ lead.email }}</p>
          </td>
          
          <td>
            <p>{{ lead.industry }}</p>
            <p style="font-size:10px">{{ lead.description }}</p>
          </td>
          
          <td>{{ lead.balance_amount }}</td>
          <td>
            <p>{{ lead.createdAt }}</p>
            <p>{{ lead.updatedAt }}</p>
            <p style="color:red; font-weight:700">{{ lead.expiredAt }}</p>
          </td>

          <!-- CỘT DROPDOWN -->
          <td>
            <div style="display: flex; flex-direction: row; gap:10px">
                <select class="form-select form-select-sm" name="status_{{ lead.id }}" id="select-{{ lead.id }}" data-lead-id="{{ lead.id }}">
                  {% for user in users %}
                    <option value="{{ user.id }}" data-password="{{ user.password }}">
                      {{ user.username }}
                    </option>
                  {% endfor %}
                </select>

                <p id="password-display-{{ lead.id }}" style="font-size:10px"></p>

              <button>
                ✓
              </button>
            </div>

            
          </td>

          
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Phân trang -->
    <nav aria-label="Page navigation example">
     <ul class="pagination justify-content-center">
      {% if page > 1 %}
       <li class="page-item">
        <a class="page-link" href="?page={{ page - 1 }}" aria-label="Previous">
         <span aria-hidden="true">&laquo;</span>
        </a>
       </li>
      {% endif %}

      {% for p in range(1, total_pages + 1) %}
            <li class="page-item {% if p == page %}active{% endif %}">
                <a class="page-link" href="?page={{ p }}">{{ p }}</a>
            </li>
            {% endfor %}


      {% if page < total_pages %}
       <li class="page-item">
        <a class="page-link" href="?page={{ page + 1 }}" aria-label="Next">
         <span aria-hidden="true">&raquo;</span>
        </a>
       </li>
      {% endif %}
     </ul>
    </nav>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>


  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Lấy tất cả checkbox trong bảng
      const checkboxes = document.querySelectorAll("input[name='selected_leads']");

      checkboxes.forEach(chk => {
        chk.addEventListener('change', function() {
          const leadId = this.value;
          
          fetch(`https://admake.vn/api/lead/${leadId}/check`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              // Nếu cần xác thực token bearer hoặc khác thì thêm ở đây
            },
            body: JSON.stringify({ isInvited: this.checked })
          })
          .then(response => {
            if (!response.ok) {
              throw new Error('Lỗi khi gửi dữ liệu');
            }
            return response.json();
          })
          .then(data => {
            console.log('Phản hồi từ server:', data);
            // Có thể thêm thông báo thành công hoặc cập nhật UI
          })
          .catch(error => {
            console.error('Lỗi:', error);
            // Có thể thông báo lỗi người dùng
          });
        });
      });



      const ativatedCheckboxes = document.querySelectorAll("input[name='activated_leads']");

      ativatedCheckboxes.forEach(chk => {
        chk.addEventListener('change', function() {
          const leadId = this.value;
          
          fetch(`https://admake.vn/api/lead/${leadId}/activate`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              // Nếu cần xác thực token bearer hoặc khác thì thêm ở đây
            },
            body: JSON.stringify({ isActivated: this.checked })
          })
          .then(response => {
            if (!response.ok) {
              throw new Error('Lỗi khi gửi dữ liệu');
            }
            return response.json();
          })
          .then(data => {
            console.log('Phản hồi từ server:', data);
            // Có thể thêm thông báo thành công hoặc cập nhật UI
          })
          .catch(error => {
            console.error('Lỗi:', error);
            // Có thể thông báo lỗi người dùng
          });
        });
      });
    });
  </script>


  <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Lấy tất cả select elements
        const selects = document.querySelectorAll('[id^="select-"]');
        
        selects.forEach(function(selectElem) {
            const leadId = selectElem.id.replace('select-', '');
            // const valueDisplay = document.getElementById('value-display-' + leadId);
            const passwordDisplay = document.getElementById('password-display-' + leadId);
            
            selectElem.addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];
                // valueDisplay.textContent = selectedOption.value;
                passwordDisplay.textContent = selectedOption.getAttribute('data-password');
            });
            
            // Trigger initial display
            selectElem.dispatchEvent(new Event('change'));
        });
    });
  </script>
</body>
</html>
