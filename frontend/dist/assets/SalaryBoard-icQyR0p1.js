import{r as i,c6 as Wn,q as Dn,Z as Bn,s as n,X,Q as O,V as H,v as V}from"./index-DBnuHJB3.js";import{C as En}from"./TitlePanel-DO8YxNLB.js";import{d as z,J as xn}from"./JobAsset-87unebk6.js";import{M as Yn}from"./Add-DkLpEJzH.js";import{T as Cn,a as C}from"./Tabs-CGh3m69S.js";import{T as J,a as q,d as K,b as c,c as t}from"./TableRow-BnNiFHkB.js";function Ln(s,f){const g=new Date(s);return g.setHours(f+7,0,0,0),g.toString()}function un(s){return s.in?1:0}function Q(s,f){if(!s.in)return 0;if(!(s!=null&&s.out)){s.out={img:"",lat:s.in.lat,long:s.in.long,time:Ln(s.in.time,f)};const p=(new Date(s.out.time).getTime()-new Date(s.in.time).getTime())/(1e3*60*60);s.workhour=p}return s!=null&&s.workhour&&s.workhour>1?s.workhour:0}const u=s=>s.toLocaleString("en-US",{maximumFractionDigits:0}),Hn=({selectedRecord:s,modalVisible:f,handleOk:g,month:p=z().format("YYYY-MM")})=>{const[N,dn]=i.useState(0),[I,jn]=i.useState(0),[$,fn]=i.useState(0),[y,gn]=i.useState(0),[Z,G]=i.useState([]),[Nn,pn]=i.useState(0),[D,R]=i.useState(0),[nn,sn]=i.useState(0),[tn,an]=i.useState(0),[rn,en]=i.useState(0),{workpointSetting:d}=Wn(),on=(d==null?void 0:d.multiply_in_night_overtime)||0,{isMobile:l}=Dn();new Date().getMonth();const[yn,mn]=i.useState([]),{taskDetail:T,setTaskDetail:Tn}=Bn(),[P,ln]=i.useState([0,0,0,0,0]),[b,bn]=i.useState(0),[wn,Sn]=i.useState(0),[$n,kn]=i.useState(0),U=z(p,"YYYY-MM"),A=U.year(),F=U.month();i.useEffect(()=>{G([]),T?(async()=>{try{const a=await fetch(`${V()}/task/${s==null?void 0:s.user_id}/salary`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error("Network response was not ok "+a.statusText);const o=await a.json();Tn(o.infor),ln(o.rates),G(o.messages),console.log("Salary tasks data:",o)}catch(a){console.error("Fetch error:",a)}})():(async()=>{try{const a=await fetch(`${V()}/workpoint/${s==null?void 0:s.user_id}/salary`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error("Network response was not ok "+a.statusText);const o=await a.json();G(o.messages),console.log("Salary tasks data:",s==null?void 0:s.user_id,o)}catch(a){console.error("Fetch error:",a)}})()},[s,f]),i.useEffect(()=>{if(!T||!T.assets){pn(0),R(0),sn(0),an(0),en(0),ln([0,0,0,0,0]);return}let r=0,a=0,o=0;T.assets.forEach(e=>{if(e.text!==""&&e.text)if(e.type==="bonus-cash"){const x=Number(e.text.split("/")[0].replace(/\./g,""));r+=x>0?x:0,o+=x<0?x:0}else e.type==="advance-salary-cash"&&(a+=Number(e.text.split("/")[0].replace(/\./g,"")))}),sn(a),an(o),en(r)},[T]);const vn=(r,a)=>{bn(a)},hn=!window.location.href.includes("/point/"),Mn=async()=>{const r=await fetch(`${V()}/task/${s==null?void 0:s.user_id}/by_user`);if(!r.ok)throw new Error(`Error fetching tasks for user ${s==null?void 0:s.user_id}`);const a=await r.json(),o=a.data??[],e=a.reward??[],x=o.filter(j=>{if(!j.end_time||j.status!=="REWARD")return!1;const m=z(j.end_time).toDate(),w=new Date;return m.getMonth()===w.getMonth()&&m.getFullYear()===w.getFullYear()});mn(e);const Y=e.reduce((j,m)=>j+(m.reward||0),0);return R(Y),x};function _n(r,a){const o=new Date(a,r,0).getDate();let e=0;for(let x=1;x<=o;x++){const j=new Date(a,r-1,x).getDay();j===0?e+=d!=null&&d.work_in_sunday?8:0:j===6?e+=d!=null&&d.work_in_saturday_noon?8:4:e+=8}return e}i.useEffect(()=>{var w;if(!((w=s==null?void 0:s.items)!=null&&w.length))return;const r=s.items.filter(S=>{var M,_,W,cn;const h=S.checklist;if(!h)return!1;const k=((_=(M=h.morning)==null?void 0:M.in)==null?void 0:_.time)||((cn=(W=h.noon)==null?void 0:W.in)==null?void 0:cn.time);if(!k)return!1;const v=new Date(k);return v.getMonth()===F&&v.getFullYear()===A});let a=0,o=0,e=0,x=0,Y=0;r.forEach(S=>{var k,v,M,_,W;const h=S.checklist;h&&(s!=null&&s.username.includes("LỘC")&&((k=h.morning)!=null&&k.in||console.log("No morning",S),(v=h.noon)!=null&&v.in||console.log("No noon",S)),(M=h.morning)!=null&&M.in&&(a+=Q(h.morning,12),e+=un(h.morning)),(_=h.noon)!=null&&_.in&&(a+=Q(h.noon,17),e+=un(h.noon)),(W=h.evening)!=null&&W.in&&(o+=Q(h.evening,22)))});const j=_n(F+1,A),m=s.salary/j;dn(a),jn(e),fn(o),Sn(x),kn(Y),gn(m),Mn()},[s,f,d,F,A]);const B={fontStyle:"italic",color:"red"},E={fontSize:10,minWidth:70,maxWidth:70,paddingLeft:l?0:50,paddingRight:l?0:50,whiteSpace:l?"wrap":"nowrap",borderLeft:"1px solid #666"};return n.jsx(Yn,{open:f,onOk:g,onCancel:g,footer:null,title:"",okText:"OK",cancelButtonProps:{style:{display:"none"}},children:n.jsx(En,{children:n.jsxs(X,{sx:{width:"100%"},children:[n.jsxs(X,{sx:{width:250,borderRadius:1,backgroundColor:"#00B4B6",px:1,py:1,mb:0,position:"relative","&:after":{content:'""',position:"absolute",right:-26,top:"50%",transform:"translateY(-50%)",width:0,height:0,borderTop:"28px solid transparent",borderBottom:"28px solid transparent",borderLeft:"28px solid #00B4B6"}},children:[n.jsxs(O,{sx:{textTransform:"uppercase",color:"#ccc",fontSize:12,fontWeight:500},children:["BẢNG LƯƠNG THÁNG ",U.format("MM/YYYY")]}),n.jsx(O,{sx:{textTransform:"uppercase",color:"#fff"},children:s==null?void 0:s.username.toUpperCase()})]}),n.jsxs(Cn,{value:b,onChange:vn,"aria-label":"nav tabs example",variant:l?"scrollable":"standard",scrollButtons:"auto",style:{marginTop:10},children:[n.jsx(C,{style:E,label:"Lương",id:"nav-tab-0","aria-controls":"nav-tabpanel-0"}),n.jsx(C,{style:E,label:"Thưởng Phạt",id:"nav-tab-1","aria-controls":"nav-tabpanel-1"}),n.jsx(C,{style:E,label:"Chuyên Cần",id:"nav-tab-2","aria-controls":"nav-tabpanel-2"}),n.jsx(C,{style:E,label:"Ứng Tiền",id:"nav-tab-3","aria-controls":"nav-tabpanel-3"})]}),n.jsxs(L,{value:b,index:0,children:[n.jsx(J,{component:H,sx:{mt:l?0:2,ml:l?-10:0,width:l?400:"100%",scale:l?.75:1},children:n.jsx(q,{style:{padding:0},children:n.jsxs(K,{children:[n.jsxs(c,{children:[n.jsx(t,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(t,{style:{fontWeight:700},children:"Giá trị"}),n.jsx(t,{style:{fontWeight:700},children:"Lương/ĐVT"}),n.jsx(t,{style:{fontWeight:700},children:"Thành tiền"})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Số buổi làm"}),n.jsx(t,{children:I}),n.jsxs(t,{children:[u(y*4)," ₫"]}),n.jsxs(t,{children:[u(y*4*I)," ₫"]})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Số giờ làm"}),n.jsx(t,{children:N.toLocaleString()}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Tổng giờ tăng ca"}),n.jsx(t,{children:$.toFixed(3)}),n.jsxs(t,{children:[u(y*on)," ₫"]}),n.jsxs(t,{children:[u(y*on*$)," ₫"]})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Tổng phụ cấp"}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[u(D)," ₫"]})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Tổng thưởng"}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[u(rn)," ₫"]})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Tổng phạt"}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[u(tn)," ₫"]})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Tạm ứng"}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[u(nn)," ₫"]})]})]})})}),n.jsxs(O,{style:{marginTop:20,textAlign:"center",color:"#00B5B4"},children:["Tổng lương: ",u(y*4*I+y*1.5*$+D+rn+tn+nn)," ₫"]})]}),n.jsxs(L,{value:b,index:1,children:[n.jsx(J,{component:H,sx:{mt:l?0:2,ml:l?-10:0,width:l?400:"100%",scale:l?.75:1},children:n.jsx(q,{style:{padding:0},children:n.jsxs(K,{children:[n.jsxs(c,{children:[n.jsx(t,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(t,{style:{fontWeight:700},children:"Giá trị"}),n.jsx(t,{style:{fontWeight:700},children:"Lương/ĐVT"}),n.jsx(t,{style:{fontWeight:700},children:"Thành tiền"})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Thưởng theo việc"}),n.jsxs(t,{children:[u(D)," ₫"]}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[u(D)," ₫"]})]}),yn.map((r,a)=>n.jsxs(c,{children:[n.jsxs(t,{style:B,children:["+ ",r.workspace]}),n.jsxs(t,{style:B,children:["(",r.title,")"]}),n.jsx(t,{style:B,children:"-"}),n.jsxs(t,{style:B,children:[u(r.reward)," ₫"]})]},a))]})})}),n.jsx(xn,{targetUserId:s==null?void 0:s.user_id,messages:Z.filter(r=>r.type==="bonus-cash"),title:"Thưởng/Phạt",type:"bonus-cash",readOnly:!hn},"cash-assets")]}),n.jsx(L,{value:b,index:2,children:n.jsx(J,{component:H,sx:{mt:l?0:2,ml:l?-10:0,width:l?400:"100%",scale:l?.75:1},children:n.jsx(q,{style:{padding:0},children:n.jsxs(K,{children:[n.jsxs(c,{children:[n.jsx(t,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(t,{style:{fontWeight:700},children:"Giá trị"})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Số phút đi trễ"}),n.jsx(t,{children:wn})]}),P&&P.length===5&&P.map((r,a)=>n.jsxs(c,{children:[n.jsxs(t,{children:["Số việc chấm ",a+1," sao"]}),n.jsx(t,{children:r})]}))]})})})}),n.jsx(L,{value:b,index:3,children:n.jsx(xn,{targetUserId:s==null?void 0:s.user_id,messages:Z.filter(r=>r.type==="advance-salary-cash"),title:"Ứng tiền cho nhân viên",type:"advance-salary-cash",readOnly:!hn},"cash-assets")})]})})})};function L(s){const{children:f,value:g,index:p,...N}=s;return n.jsx("div",{role:"tabpanel",hidden:g!==p,id:`nav-tabpanel-${p}`,"aria-labelledby":`nav-tab-${p}`,...N,children:g===p&&n.jsx(X,{sx:{p:3},children:f})})}export{Hn as S};
