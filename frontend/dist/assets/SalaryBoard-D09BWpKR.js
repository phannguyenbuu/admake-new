import{r as i,c6 as Wn,q as Dn,Z as Bn,s as n,X as Q,Q as O,V as F,v as H}from"./index-DSXg4j8h.js";import{C as En}from"./TitlePanel-Blu2GmVX.js";import{J as xn}from"./JobAsset-D7TWggFq.js";import{d as V}from"./DeleteConfirm-fc_XuyEG.js";import{M as Cn}from"./Add-C2G_wMcD.js";import{T as Yn,a as L}from"./Tabs-D63ZjrfH.js";import{T as z,a as J,d as q,b as c,c as t}from"./TableRow-Cizu5ALW.js";function Ln(s,g){const p=new Date(s);return p.setHours(g+7,0,0,0),p.toString()}function un(s){return s.in?1:0}function K(s,g){if(!s.in)return 0;if(!(s!=null&&s.out)){s.out={img:"",lat:s.in.lat,long:s.in.long,time:Ln(s.in.time,g)};const x=(new Date(s.out.time).getTime()-new Date(s.in.time).getTime())/(1e3*60*60);s.workhour=x}return s!=null&&s.workhour&&s.workhour>1?s.workhour:0}const d=s=>s.toLocaleString("en-US",{maximumFractionDigits:0}),Vn=({selectedRecord:s,modalVisible:g,handleOk:p,month:x=V().format("YYYY-MM")})=>{const[$,dn]=i.useState(0),[I,fn]=i.useState(0),[G,jn]=i.useState(0),[y,gn]=i.useState(0),[X,P]=i.useState([]),[Nn,pn]=i.useState(0),[W,Z]=i.useState(0),[R,nn]=i.useState(0),[sn,tn]=i.useState(0),[an,rn]=i.useState(0),{workpointSetting:f}=Wn(),en=(f==null?void 0:f.multiply_in_night_overtime)||0,{isMobile:l}=Dn();new Date().getMonth();const[yn,mn]=i.useState([]),{taskDetail:T,setTaskDetail:Tn}=Bn(),[U,on]=i.useState([0,0,0,0,0]),[b,bn]=i.useState(0),[wn,Sn]=i.useState(0),[In,kn]=i.useState(0),A=V(x,"YYYY-MM"),D=A.year(),B=A.month();i.useEffect(()=>{P([]),T?(async()=>{try{const a=await fetch(`${H()}/task/${s==null?void 0:s.user_id}/salary?month=${x}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error("Network response was not ok "+a.statusText);const o=await a.json();Tn(o.infor),on(o.rates),P(o.messages),console.log("Salary tasks data:",o)}catch(a){console.error("Fetch error:",a)}})():(async()=>{try{const a=await fetch(`${H()}/workpoint/${s==null?void 0:s.user_id}/salary?month=${x}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error("Network response was not ok "+a.statusText);const o=await a.json();P(o.messages),console.log("Salary tasks data:",s==null?void 0:s.user_id,o)}catch(a){console.error("Fetch error:",a)}})()},[s,g,x]),i.useEffect(()=>{if(!T||!T.assets){pn(0),Z(0),nn(0),tn(0),rn(0),on([0,0,0,0,0]);return}let r=0,a=0,o=0;T.assets.forEach(e=>{if(e.text!==""&&e.text)if(e.type==="bonus-cash"){const u=Number(e.text.split("/")[0].replace(/\./g,""));r+=u>0?u:0,o+=u<0?u:0}else e.type==="advance-salary-cash"&&(a+=Number(e.text.split("/")[0].replace(/\./g,"")))}),nn(a),tn(o),rn(r)},[T]);const vn=(r,a)=>{bn(a)},ln=!window.location.href.includes("/point/"),_n=async()=>{const r=await fetch(`${H()}/task/${s==null?void 0:s.user_id}/by_user?month=${x}`);if(!r.ok)throw new Error(`Error fetching tasks for user ${s==null?void 0:s.user_id}`);const a=await r.json(),o=a.data??[],e=a.reward??[],u=o.filter(j=>{if(!j.end_time||j.status!=="REWARD")return!1;const m=V(j.end_time).toDate();return m.getMonth()===B&&m.getFullYear()===D});mn(e);const Y=e.reduce((j,m)=>j+(m.reward||0),0);return Z(Y),u};function Mn(r,a){const o=new Date(a,r,0).getDate();let e=0;for(let u=1;u<=o;u++){const j=new Date(a,r-1,u).getDay();j===0?e+=f!=null&&f.work_in_sunday?8:0:j===6?e+=f!=null&&f.work_in_saturday_noon?8:4:e+=8}return e}i.useEffect(()=>{var hn;if(!((hn=s==null?void 0:s.items)!=null&&hn.length))return;const r=s.items.filter(w=>{var v,_,M,cn;const h=w.checklist;if(!h)return!1;const S=((_=(v=h.morning)==null?void 0:v.in)==null?void 0:_.time)||((cn=(M=h.noon)==null?void 0:M.in)==null?void 0:cn.time);if(!S)return!1;const k=new Date(S);return k.getMonth()===B&&k.getFullYear()===D});let a=0,o=0,e=0,u=0,Y=0;r.forEach(w=>{var S,k,v,_,M;const h=w.checklist;h&&(s!=null&&s.username.includes("LỘC")&&((S=h.morning)!=null&&S.in||console.log("No morning",w),(k=h.noon)!=null&&k.in||console.log("No noon",w)),(v=h.morning)!=null&&v.in&&(a+=K(h.morning,12),e+=un(h.morning)),(_=h.noon)!=null&&_.in&&(a+=K(h.noon,17),e+=un(h.noon)),(M=h.evening)!=null&&M.in&&(o+=K(h.evening,22)))});const j=Mn(B+1,D),m=s.salary/j;dn(a),fn(e),jn(o),Sn(u),kn(Y),gn(m),_n()},[s,g,f,B,D]);const E={fontStyle:"italic",color:"red"},C={fontSize:10,minWidth:70,maxWidth:70,paddingLeft:l?0:50,paddingRight:l?0:50,whiteSpace:l?"wrap":"nowrap",borderLeft:"1px solid #666"};return n.jsx(Cn,{open:g,onOk:p,onCancel:p,footer:null,title:"",okText:"OK",cancelButtonProps:{style:{display:"none"}},children:n.jsx(En,{children:n.jsxs(Q,{sx:{width:"100%"},children:[n.jsxs(Q,{sx:{width:250,borderRadius:1,backgroundColor:"#00B4B6",px:1,py:1,mb:0,position:"relative","&:after":{content:'""',position:"absolute",right:-26,top:"50%",transform:"translateY(-50%)",width:0,height:0,borderTop:"28px solid transparent",borderBottom:"28px solid transparent",borderLeft:"28px solid #00B4B6"}},children:[n.jsxs(O,{sx:{textTransform:"uppercase",color:"#ccc",fontSize:12,fontWeight:500},children:["BẢNG LƯƠNG THÁNG ",A.format("MM/YYYY")]}),n.jsx(O,{sx:{textTransform:"uppercase",color:"#fff"},children:s==null?void 0:s.username.toUpperCase()})]}),n.jsxs(Yn,{value:b,onChange:vn,"aria-label":"nav tabs example",variant:l?"scrollable":"standard",scrollButtons:"auto",style:{marginTop:10},children:[n.jsx(L,{style:C,label:"Lương",id:"nav-tab-0","aria-controls":"nav-tabpanel-0"}),n.jsx(L,{style:C,label:"Thưởng Phạt",id:"nav-tab-1","aria-controls":"nav-tabpanel-1"}),n.jsx(L,{style:C,label:"Chuyên Cần",id:"nav-tab-2","aria-controls":"nav-tabpanel-2"}),n.jsx(L,{style:C,label:"Ứng Tiền",id:"nav-tab-3","aria-controls":"nav-tabpanel-3"})]}),n.jsxs(N,{value:b,index:0,children:[n.jsx(z,{component:F,sx:{mt:l?0:2,ml:l?-10:0,width:l?400:"100%",scale:l?.75:1},children:n.jsx(J,{style:{padding:0},children:n.jsxs(q,{children:[n.jsxs(c,{children:[n.jsx(t,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(t,{style:{fontWeight:700},children:"Giá trị"}),n.jsx(t,{style:{fontWeight:700},children:"Lương/ĐVT"}),n.jsx(t,{style:{fontWeight:700},children:"Thành tiền"})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Số buổi làm"}),n.jsx(t,{children:I}),n.jsxs(t,{children:[d(y*4)," ₫"]}),n.jsxs(t,{children:[d(y*4*I)," ₫"]})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Số giờ làm"}),n.jsx(t,{children:$.toLocaleString()}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Tổng giờ tăng ca"}),n.jsx(t,{children:G.toFixed(3)}),n.jsxs(t,{children:[d(y*en)," ₫"]}),n.jsxs(t,{children:[d(y*en*G)," ₫"]})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Tổng phụ cấp"}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[d(W)," ₫"]})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Tổng thưởng"}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[d(an)," ₫"]})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Tổng phạt"}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[d(sn)," ₫"]})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Tạm ứng"}),n.jsx(t,{children:"-"}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[d(R)," ₫"]})]})]})})}),n.jsxs(O,{style:{marginTop:20,textAlign:"center",color:"#00B5B4"},children:["Tổng lương: ",d(y*4*I+y*1.5*G+W+an+sn+R)," ₫"]})]}),n.jsxs(N,{value:b,index:1,children:[n.jsx(z,{component:F,sx:{mt:l?0:2,ml:l?-10:0,width:l?400:"100%",scale:l?.75:1},children:n.jsx(J,{style:{padding:0},children:n.jsxs(q,{children:[n.jsxs(c,{children:[n.jsx(t,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(t,{style:{fontWeight:700},children:"Giá trị"}),n.jsx(t,{style:{fontWeight:700},children:"Lương/ĐVT"}),n.jsx(t,{style:{fontWeight:700},children:"Thành tiền"})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Thưởng theo việc"}),n.jsxs(t,{children:[d(W)," ₫"]}),n.jsx(t,{children:"-"}),n.jsxs(t,{children:[d(W)," ₫"]})]}),yn.map((r,a)=>n.jsxs(c,{children:[n.jsxs(t,{style:E,children:["+ ",r.workspace]}),n.jsxs(t,{style:E,children:["(",r.title,")"]}),n.jsx(t,{style:E,children:"-"}),n.jsxs(t,{style:E,children:[d(r.reward)," ₫"]})]},a))]})})}),n.jsx(xn,{targetUserId:s==null?void 0:s.user_id,messages:X.filter(r=>r.type==="bonus-cash"),title:"Thưởng/Phạt",type:"bonus-cash",readOnly:!ln},"cash-assets")]}),n.jsx(N,{value:b,index:2,children:n.jsx(z,{component:F,sx:{mt:l?0:2,ml:l?-10:0,width:l?400:"100%",scale:l?.75:1},children:n.jsx(J,{style:{padding:0},children:n.jsxs(q,{children:[n.jsxs(c,{children:[n.jsx(t,{style:{fontWeight:700},children:"Nội dung"}),n.jsx(t,{style:{fontWeight:700},children:"Giá trị"})]}),n.jsxs(c,{children:[n.jsx(t,{children:"Số phút đi trễ"}),n.jsx(t,{children:wn})]}),U&&U.length===5&&U.map((r,a)=>n.jsxs(c,{children:[n.jsxs(t,{children:["Số việc chấm ",a+1," sao"]}),n.jsx(t,{children:r})]}))]})})})}),n.jsx(N,{value:b,index:3,children:n.jsx(xn,{targetUserId:s==null?void 0:s.user_id,messages:X.filter(r=>r.type==="advance-salary-cash"),title:"Ứng tiền cho nhân viên",type:"advance-salary-cash",readOnly:!ln},"cash-assets")})]})})})};function N(s){const{children:g,value:p,index:x,...$}=s;return n.jsx("div",{role:"tabpanel",hidden:p!==x,id:`nav-tabpanel-${x}`,"aria-labelledby":`nav-tab-${x}`,...$,children:p===x&&n.jsx(Q,{sx:{p:3},children:g})})}export{Vn as S};
