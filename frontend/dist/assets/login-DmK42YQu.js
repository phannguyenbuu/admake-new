import{r as c,I as u,d,ba as h,p as g,t as i,s as e,B as x,bb as p,v as f,z as j,E as v,A as k,G as w,H as y,J as I,K as E,U as b,P as L,L as N,M}from"./index-DwiI2IhC.js";import{A}from"./auth.service-I3GrNf8k.js";import{F as o,I as l}from"./index-udfmYiN-.js";import{R as P}from"./UserOutlined-C2X6IIvp.js";var S={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"lock",theme:"outlined"},T=function(s,n){return c.createElement(u,d({},s,{ref:n,icon:S}))},R=c.forwardRef(T);const z=()=>{const[t,s]=c.useState(!1),n=()=>s(!0),a=()=>s(!1);return{loading:t,toggle:()=>t?a():n()}},B=()=>{const{loading:t,toggle:s}=z(),n=h(),{mutate:a}=g({mutationFn:async r=>{const m={...r,username:r.username};return A.login(m)},onError:r=>{i.error({message:"Đăng nhập thất bại",description:r instanceof Error?r.message:"Đã xảy ra lỗi khi đăng nhập"})},onSuccess:async()=>{n.clear(),i.success({message:"Đăng nhập thành công",description:"Chào mừng bạn quay trở lại!"}),window.location.href="/users"},onMutate:s,onSettled:s});return e.jsxs(o,{name:"login-form",className:"login-form max-w-sm w-full mx-auto mt-10 min-w-[300px]",onFinish:a,layout:"vertical",children:[e.jsx(o.Item,{label:"Tên đăng nhập",name:"username",rules:[{required:!0,message:"Vui lòng nhập tên đăng nhập!"}],children:e.jsx(l,{prefix:e.jsx(P,{}),placeholder:"Nhập tên đăng nhập"})}),e.jsx(o.Item,{label:"Mật khẩu",name:"password",rules:[{required:!0,message:"Vui lòng nhập mật khẩu!"}],children:e.jsx(l.Password,{prefix:e.jsx(R,{}),placeholder:"Nhập mật khẩu"})}),e.jsx(o.Item,{children:e.jsx(x,{type:"primary",htmlType:"submit",className:"w-full",loading:t,children:t?"Đang đăng nhập...":"Đăng nhập"})})]})},V=()=>{const t=p(),s=f();return c.useEffect(()=>{const n=localStorage.getItem("accessToken");if(!n){localStorage.removeItem("accessToken");return}(async()=>{try{(await fetch(`${s}/auth/me`,{headers:{Authorization:`Bearer ${n}`}})).ok?t("/users",{replace:!0}):localStorage.removeItem("accessToken")}catch{localStorage.removeItem("accessToken")}})()},[t,s]),e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md w-full max-w-sm min-w-[400px]",children:[e.jsxs("div",{className:"flex items-center justify-center pb-5",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("img",{src:"/logo.jpg",alt:"logo",className:"w-13 h-13"})}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("img",{src:"/ADMAKE.svg",alt:"ADMAKE",className:"h-8"})})]}),e.jsx(B,{})]})})},H={path:"/",element:e.jsx(k,{children:e.jsx(w,{children:e.jsx(y,{children:e.jsx(I,{})})})}),errorElement:e.jsx(v,{}),children:[{path:"/login",index:!0,element:e.jsx(V,{}),title:"Đăng nhập",ignoreInMenu:!0}]},F=j([H],{});E.createRoot(document.getElementById("root")).render(e.jsx(b,{children:e.jsx(L,{children:e.jsx(N,{fallbackElement:e.jsx(M,{}),future:{v7_startTransition:!0},router:F})})}));
