import{r as n,Z as R,q as U,s as o,v as B}from"./index-DSXg4j8h.js";import{T as E,c as L}from"./data-DLPpVsX8.js";import{S as P}from"./SalaryBoard-D09BWpKR.js";import{U as $}from"./dashboard-MTfjOaBh.js";import{d as l}from"./DeleteConfirm-fc_XuyEG.js";import{T as D,S as w}from"./Add-C2G_wMcD.js";import"./index-DbPdFFKV.js";import"./index-5sgN3aGs.js";import"./CaretUpOutlined-DuUKvZRu.js";import"./QRCode-1UIPng5S.js";import"./TitlePanel-Blu2GmVX.js";import"./JobAsset-D7TWggFq.js";import"./Send-D2xSmM1Y.js";import"./index-BfPcpEh8.js";import"./Popper-D2DKWiam.js";import"./Button-BC5GB06O.js";import"./Tabs-D63ZjrfH.js";import"./TableRow-Cizu5ALW.js";import"./UserOutlined-ixKGLiYK.js";const{Option:I}=w,nt=()=>{const[s,c]=n.useState({page:1,limit:10,search:"",month:l().format("YYYY-MM")}),{setTaskDetail:y}=R(),[j,m]=n.useState([]),[Y,p]=n.useState(!1),[M,h]=n.useState(0),[d,u]=n.useState(!1),[k,g]=n.useState(null),{userLeadId:r,canViewPermission:i}=U(),v=(()=>{const t=[],e=l();let a=l("2025-11-01");for(;a.isBefore(e)||a.isSame(e,"month");)t.unshift({value:a.format("YYYY-MM"),label:a.format("MM/YYYY")}),a=a.add(1,"month");return t})(),T=t=>{g(t),u(!0)},C=()=>{u(!1),g(null)},O=t=>{c(e=>({...e,...t,page:1}))},b=async({page:t,limit:e,search:f,month:a})=>{if(!r||r<=0){m([]),h(0);return}p(!0);try{const x=await(await fetch(`${B()}/workpoint/page?`+new URLSearchParams({lead:r.toString(),page:String(t),limit:String(e),search:f,month:a}))).json();m(x.data),h(x.pagination.total)}catch(S){console.error("Failed to fetch workpoints",S)}finally{p(!1)}};return n.useEffect(()=>{b(s)},[s,r]),n.useEffect(()=>{y(null)},[]),i!=null&&i.view_workpoint?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"min-h-screen p-2 w-full",children:[o.jsxs("div",{style:{marginBottom:16,display:"flex",alignItems:"center",gap:8},children:[o.jsx(D.Text,{strong:!0,style:{whiteSpace:"nowrap"},children:"Chọn tháng:"}),o.jsx(w,{value:s.month,onChange:t=>O({month:t}),style:{width:"50vw"},placeholder:"Chọn tháng",children:v.map(t=>o.jsx(I,{value:t.value,children:t.label},t.value))})]}),o.jsx(E,{columns:L(T,s.month),dataSource:j,loading:Y,pagination:{pageSize:s.limit,current:s.page,total:M,onChange:(t,e)=>{c({...s,page:t,limit:e})},showSizeChanger:!0,showTotal:(t,e)=>`${e[0]}-${e[1]} của ${t} nhân sự`,style:{paddingRight:"15px"},locale:{items_per_page:"/ Trang"}}})]}),d&&o.jsx(P,{selectedRecord:k,modalVisible:d,handleOk:C,month:s.month})]}):o.jsx($,{})};export{nt as default};
