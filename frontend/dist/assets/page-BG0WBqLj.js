import{r as n,c6 as l,Z as R,q as U,s as o,v as B}from"./index-DwiI2IhC.js";import{T as E,c as L}from"./data-u7CbCEC5.js";import{S as P}from"./SalaryBoard-Curg_1a7.js";import{U as $}from"./dashboard-TcPV1bdS.js";import{T as D,S as w}from"./Add-19pJME5G.js";import"./index-udfmYiN-.js";import"./index-CXPK8Dzd.js";import"./JobAsset-CpQQT6M4.js";import"./DeleteConfirm-B-vFUD1g.js";import"./Button-CdbztWtG.js";import"./Send-kh9MbFaG.js";import"./index-CW0pHrm9.js";import"./Popper-DWsuAb0h.js";import"./CaretUpOutlined-Dq7FnadQ.js";import"./QRCode-oaCYiJOe.js";import"./TitlePanel-eEfI5l9A.js";import"./Tabs-n6Qg6r42.js";import"./TableRow-CeqF3v0U.js";import"./UserOutlined-C2X6IIvp.js";const{Option:I}=w,nt=()=>{const[s,c]=n.useState({page:1,limit:10,search:"",month:l().format("YYYY-MM")}),{setTaskDetail:y}=R(),[j,p]=n.useState([]),[Y,m]=n.useState(!1),[M,h]=n.useState(0),[d,u]=n.useState(!1),[k,g]=n.useState(null),{userLeadId:r,canViewPermission:i}=U(),v=(()=>{const t=[],e=l();let a=l("2025-11-01");for(;a.isBefore(e)||a.isSame(e,"month");)t.unshift({value:a.format("YYYY-MM"),label:a.format("MM/YYYY")}),a=a.add(1,"month");return t})(),T=t=>{g(t),u(!0)},C=()=>{u(!1),g(null)},O=t=>{c(e=>({...e,...t,page:1}))},b=async({page:t,limit:e,search:f,month:a})=>{if(!r||r<=0){p([]),h(0);return}m(!0);try{const x=await(await fetch(`${B()}/workpoint/page?`+new URLSearchParams({lead:r.toString(),page:String(t),limit:String(e),search:f,month:a}))).json();p(x.data),h(x.pagination.total)}catch(S){console.error("Failed to fetch workpoints",S)}finally{m(!1)}};return n.useEffect(()=>{b(s)},[s,r]),n.useEffect(()=>{y(null)},[]),i!=null&&i.view_workpoint?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"min-h-screen p-2 w-full",children:[o.jsxs("div",{style:{marginBottom:16,display:"flex",alignItems:"center",gap:8},children:[o.jsx(D.Text,{strong:!0,style:{whiteSpace:"nowrap"},children:"Chọn tháng:"}),o.jsx(w,{value:s.month,onChange:t=>O({month:t}),style:{width:"50vw"},placeholder:"Chọn tháng",children:v.map(t=>o.jsx(I,{value:t.value,children:t.label},t.value))})]}),o.jsx(E,{columns:L(T,s.month),dataSource:j,loading:Y,pagination:{pageSize:s.limit,current:s.page,total:M,onChange:(t,e)=>{c({...s,page:t,limit:e})},showSizeChanger:!0,showTotal:(t,e)=>`${e[0]}-${e[1]} của ${t} nhân sự`,style:{paddingRight:"15px"},locale:{items_per_page:"/ Trang"}}})]}),d&&o.jsx(P,{selectedRecord:k,modalVisible:d,handleOk:C,month:s.month})]}):o.jsx($,{})};export{nt as default};
