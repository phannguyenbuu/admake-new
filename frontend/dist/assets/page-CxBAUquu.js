import{Y as J,s as e,q as W,r as c,c6 as C,v as X}from"./index-CvmxeaZS.js";import{D as Z}from"./DeleteConfirm-D8XnyFyC.js";import{M as ee}from"./Add-BqJp5ChU.js";import"./Button-_0_IxFv3.js";import"./index-DzQYez8T.js";const te=J(e.jsx("path",{d:"m14.06 9.02.92.92L5.92 19H5v-.92zM17.66 3c-.25 0-.51.1-.7.29l-1.83 1.83 3.75 3.75 1.83-1.83c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.2-.2-.45-.29-.71-.29m-3.6 3.19L3 17.25V21h3.75L17.81 9.94z"})),r=s=>Number(s||0).toLocaleString("vi-VN",{maximumFractionDigits:0}),T=C().format("YYYY-MM"),L={from_month:T,to_month:T,total_people:0,total_staff:0,total_supplier:0,total_base_salary:0,total_overtime_salary:0,total_bonus:0,total_punish:0,total_advance:0,total_net_salary:0},M={total_people:0,total_base_salary:0,total_overtime_salary:0,total_bonus:0,total_punish:0,total_advance:0,total_net_salary:0},D=s=>s.trim().replace(/\s+/g," "),F=s=>{const a=D(s||"");if(!a)return"";const l=a.split(" ");return l[l.length-1]||""};function z(s){return{total_people:s.length,total_base_salary:s.reduce((a,l)=>a+Number(l.salary_base_total||0),0),total_overtime_salary:s.reduce((a,l)=>a+Number(l.salary_overtime_total||0),0),total_bonus:s.reduce((a,l)=>a+Number(l.bonus_total||0),0),total_punish:s.reduce((a,l)=>a+Number(l.punish_total||0),0),total_advance:s.reduce((a,l)=>a+Number(l.advance_total||0),0),total_net_salary:s.reduce((a,l)=>a+Number(l.net_salary||0),0)}}function V({title:s,rows:a,summary:l,isLoading:u}){return e.jsxs("div",{className:"overflow-x-auto bg-white rounded-2xl border border-slate-100 shadow-sm",children:[e.jsxs("div",{className:"px-4 py-3 border-b bg-slate-50 flex flex-col gap-2 lg:flex-row lg:items-center lg:justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-700",children:s}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[e.jsxs("span",{className:"px-2 py-1 rounded-md bg-white border border-slate-200 text-slate-600",children:["Lương: ",e.jsxs("b",{children:[r(l.total_base_salary)," ","đ"]})]}),e.jsxs("span",{className:"px-2 py-1 rounded-md bg-white border border-slate-200 text-slate-600",children:["Tăng ca: ",e.jsxs("b",{children:[r(l.total_overtime_salary)," ","đ"]})]}),e.jsxs("span",{className:"px-2 py-1 rounded-md bg-white border border-slate-200 text-emerald-700",children:["Thưởng: ",e.jsxs("b",{children:[r(l.total_bonus)," ","đ"]})]}),e.jsxs("span",{className:"px-2 py-1 rounded-md bg-white border border-slate-200 text-rose-700",children:["Phạt: ",e.jsxs("b",{children:[r(l.total_punish)," ","đ"]})]}),e.jsxs("span",{className:"px-2 py-1 rounded-md bg-teal-50 border border-teal-200 text-teal-700",children:["Thực nhận: ",e.jsxs("b",{children:[r(l.total_net_salary)," ","đ"]})]})]})]}),e.jsxs("table",{className:"w-full text-sm text-left border-collapse min-w-[1450px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-slate-500 text-xs border-b bg-slate-50",children:[e.jsx("th",{className:"py-3 px-3",children:"STT"}),e.jsx("th",{className:"py-3 px-3",children:"Họ tên"}),e.jsx("th",{className:"py-3 px-3",children:"SĐT"}),e.jsx("th",{className:"py-3 px-3",children:"Bộ phận"}),e.jsx("th",{className:"py-3 px-3",children:"Lương cơ bản"}),e.jsx("th",{className:"py-3 px-3",children:"Số buổi"}),e.jsx("th",{className:"py-3 px-3",children:"Số giờ"}),e.jsx("th",{className:"py-3 px-3",children:"Tăng ca (giờ)"}),e.jsx("th",{className:"py-3 px-3",children:"Tiền lương"}),e.jsx("th",{className:"py-3 px-3",children:"Tiền tăng ca"}),e.jsx("th",{className:"py-3 px-3",children:"Thưởng"}),e.jsx("th",{className:"py-3 px-3",children:"Phạt"}),e.jsx("th",{className:"py-3 px-3",children:"Tạm ứng"}),e.jsx("th",{className:"py-3 px-3",children:"Thực nhận"})]})}),e.jsx("tbody",{children:u?e.jsx("tr",{children:e.jsx("td",{className:"py-8 px-3 text-center text-slate-500",colSpan:14,children:"Đang tải dữ liệu bảng lương..."})}):a.length===0?e.jsx("tr",{children:e.jsx("td",{className:"py-8 px-3 text-center text-slate-500",colSpan:14,children:"Không có dữ liệu cho kỳ đã chọn."})}):a.map((o,x)=>e.jsxs("tr",{className:"border-b last:border-0 hover:bg-slate-50/70",children:[e.jsx("td",{className:"py-3 px-3 text-slate-600",children:x+1}),e.jsx("td",{className:"py-3 px-3 text-slate-700 font-medium",children:o.full_name}),e.jsx("td",{className:"py-3 px-3 text-slate-600",children:o.phone||"-"}),e.jsx("td",{className:"py-3 px-3 text-slate-600",children:o.department||"-"}),e.jsxs("td",{className:"py-3 px-3 text-slate-700",children:[r(o.salary_base)," đ"]}),e.jsx("td",{className:"py-3 px-3 text-slate-600",children:o.period_work}),e.jsx("td",{className:"py-3 px-3 text-slate-600",children:o.work_hours}),e.jsx("td",{className:"py-3 px-3 text-slate-600",children:o.overtime_hours}),e.jsxs("td",{className:"py-3 px-3 text-slate-700",children:[r(o.salary_base_total)," đ"]}),e.jsxs("td",{className:"py-3 px-3 text-slate-700",children:[r(o.salary_overtime_total)," đ"]}),e.jsxs("td",{className:"py-3 px-3 text-emerald-600 font-semibold",children:[r(o.bonus_total)," đ"]}),e.jsxs("td",{className:"py-3 px-3 text-rose-600 font-semibold",children:[r(o.punish_total)," đ"]}),e.jsxs("td",{className:"py-3 px-3 text-amber-700 font-semibold",children:[r(o.advance_total)," đ"]}),e.jsxs("td",{className:"py-3 px-3 text-teal-700 font-semibold",children:[r(o.net_salary)," đ"]})]},o.user_id))}),!u&&a.length>0&&e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t bg-slate-50 font-semibold text-slate-700",children:[e.jsx("td",{className:"py-3 px-3",colSpan:8,children:"Tổng cộng"}),e.jsxs("td",{className:"py-3 px-3",children:[r(l.total_base_salary)," đ"]}),e.jsxs("td",{className:"py-3 px-3",children:[r(l.total_overtime_salary)," đ"]}),e.jsxs("td",{className:"py-3 px-3 text-emerald-700",children:[r(l.total_bonus)," đ"]}),e.jsxs("td",{className:"py-3 px-3 text-rose-700",children:[r(l.total_punish)," đ"]}),e.jsxs("td",{className:"py-3 px-3 text-amber-700",children:[r(l.total_advance)," đ"]}),e.jsxs("td",{className:"py-3 px-3 text-teal-700",children:[r(l.total_net_salary)," đ"]})]})})]})]})}function se(){const{userLeadId:s}=W(),[a,l]=c.useState("single"),[u,o]=c.useState(T),[x,g]=c.useState(T),[d,m]=c.useState(T),[N,y]=c.useState(!1),[i,j]=c.useState(L),[p,S]=c.useState([]),[q,b]=c.useState([]),[t,n]=c.useState(M),[f,w]=c.useState(M),U=c.useMemo(()=>!i.from_month||!i.to_month?"Không xác định":i.from_month===i.to_month?C(`${i.from_month}-01`).format("MM/YYYY"):`${C(`${i.from_month}-01`).format("MM/YYYY")} - ${C(`${i.to_month}-01`).format("MM/YYYY")}`,[i.from_month,i.to_month]),Y=async()=>{if(s){y(!0);try{const h=new URLSearchParams({lead:String(s)});a==="single"?h.set("month",u):(h.set("from_month",x),h.set("to_month",d));const R=await fetch(`${X()}/workpoint/payroll-summary?${h.toString()}`);if(!R.ok)throw new Error(`Cannot fetch payroll summary: ${R.status}`);const k=await R.json(),B=k.rows||[],P=new Intl.Collator("vi",{sensitivity:"base",usage:"sort",numeric:!0}),$=(v,Q)=>{const K=D(v.full_name||""),A=D(Q.full_name||""),G=P.compare(F(K),F(A));return G!==0?G:P.compare(K,A)},I=[...k.staff_rows||B.filter(v=>v.group_type==="staff")].sort($),E=[...k.supplier_rows||B.filter(v=>v.group_type==="supplier")].sort($);S(I),b(E),j(k.summary||L),n(k.staff_summary||z(I)),w(k.supplier_summary||z(E))}catch(h){console.error("Failed to fetch payroll summary",h),j(L),S([]),b([]),n(M),w(M)}finally{y(!1)}}};return c.useEffect(()=>{Y()},[a,u,x,d,s]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"text-sm text-slate-500",children:"Tổng hợp bảng lương nhân sự và thầu phụ theo kỳ, bao gồm lương cơ bản, tăng ca, thưởng/phạt, tạm ứng và thực nhận."}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Kiểu lọc"}),e.jsxs("select",{value:a,onChange:h=>l(h.target.value),className:"border border-slate-200 rounded-lg px-3 py-2 bg-white",children:[e.jsx("option",{value:"single",children:"Theo tháng"}),e.jsx("option",{value:"range",children:"Theo khoảng tháng"})]})]}),a==="single"?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Tháng"}),e.jsx("input",{type:"month",value:u,onChange:h=>o(h.target.value),className:"border border-slate-200 rounded-lg px-3 py-2 bg-white"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Từ tháng"}),e.jsx("input",{type:"month",value:x,onChange:h=>g(h.target.value),className:"border border-slate-200 rounded-lg px-3 py-2 bg-white"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Đến tháng"}),e.jsx("input",{type:"month",value:d,onChange:h=>m(h.target.value),className:"border border-slate-200 rounded-lg px-3 py-2 bg-white"})]})]}),e.jsx("button",{type:"button",onClick:Y,className:"bg-teal-500 text-white rounded-lg px-4 py-2 text-sm font-semibold",children:"Tải lại"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Duration"}),e.jsx("div",{className:"text-sm font-semibold text-slate-700",children:U})]}),e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Nhân sự / Thầu phụ"}),e.jsxs("div",{className:"text-sm font-semibold text-slate-700",children:[i.total_staff," / ",i.total_supplier]})]}),e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Tổng nhân sự tính lương"}),e.jsx("div",{className:"text-sm font-semibold text-slate-700",children:i.total_people})]}),e.jsxs("div",{className:"rounded-xl border border-teal-200 bg-teal-50 p-3",children:[e.jsx("div",{className:"text-xs text-teal-700",children:"Tổng thực nhận"}),e.jsxs("div",{className:"text-sm font-semibold text-teal-700",children:[r(i.total_net_salary)," đ"]})]})]}),e.jsx(V,{title:"Bảng lương Nhân sự",rows:p,summary:t,isLoading:N}),e.jsx(V,{title:"Bảng lương Thầu phụ",rows:q,summary:f,isLoading:N})]})}const H=[{key:"bang-luong",label:"Bảng lương nhân sự"},{key:"tai-khoan",label:"Tài khoản kế toán"},{key:"chung-tu",label:"Chứng từ kế toán"},{key:"quy-tac",label:"Quy tắc chỉnh sửa & Kiểm soát dữ liệu"},{key:"kiem-tra",label:"Báo cáo kiểm tra"},{key:"tong-quan",label:"Thống kê tổng quan"}],O={"tai-khoan":{key:"tai-khoan",title:"Danh sách tài khoản kế toán",addLabel:"+ Thêm tài khoản",description:"Nhập liệu thủ công danh mục tài khoản và trạng thái sử dụng.",columns:[{key:"col1",label:"Mã/Tên tài khoản"},{key:"col2",label:"Phân loại"},{key:"col3",label:"Theo dõi chi tiết"},{key:"col4",label:"Ghi chú"},{key:"status",label:"Trạng thái"}]},"chung-tu":{key:"chung-tu",title:"Danh sách chứng từ kế toán",addLabel:"+ Thêm chứng từ",description:"Nhập tay các chứng từ, số tiền và trạng thái xử lý.",columns:[{key:"col1",label:"Mã chứng từ"},{key:"col2",label:"Loại chứng từ"},{key:"col3",label:"Ngày chứng từ"},{key:"col4",label:"Số tiền / nội dung"},{key:"status",label:"Trạng thái"}]},"quy-tac":{key:"quy-tac",title:"Danh sách quy tắc kiểm soát",addLabel:"+ Thêm quy tắc",description:"Quản lý các quy tắc kiểm soát dữ liệu nhập liệu thủ công.",columns:[{key:"col1",label:"Mã quy tắc"},{key:"col2",label:"Nhóm quy tắc"},{key:"col3",label:"Nội dung quy tắc"},{key:"col4",label:"Giá trị kiểm soát"},{key:"status",label:"Trạng thái"}]},"kiem-tra":{key:"kiem-tra",title:"Danh sách lỗi cần kiểm tra",addLabel:"+ Thêm lỗi kiểm tra",description:"Ghi nhận lỗi nhập liệu và hướng xử lý theo từng kỳ.",columns:[{key:"col1",label:"Ngày ghi sổ"},{key:"col2",label:"Đối tượng"},{key:"col3",label:"Sổ/Báo cáo"},{key:"col4",label:"Mô tả lỗi / hướng xử lý"},{key:"status",label:"Trạng thái"}]},"tong-quan":{key:"tong-quan",title:"Danh sách chỉ tiêu tổng quan",addLabel:"+ Thêm chỉ tiêu",description:"Nhập thủ công các chỉ tiêu để theo dõi tổng quan kế toán.",columns:[{key:"col1",label:"Tên chỉ tiêu"},{key:"col2",label:"Nhóm chỉ tiêu"},{key:"col3",label:"Kỳ áp dụng"},{key:"col4",label:"Giá trị"},{key:"status",label:"Trạng thái"}]}},_={"tai-khoan":[{id:1,col1:"1111 - Tiền mặt",col2:"Tài sản",col3:"Kho",col4:"Tài khoản con",status:"Active"},{id:2,col1:"1121 - Tiền gửi ngân hàng",col2:"Tài sản",col3:"Ngân hàng",col4:"Theo dõi phát sinh",status:"Active"}],"chung-tu":[{id:1,col1:"CT0001",col2:"Chi",col3:"01/02/2026",col4:"10.000.000 đ",status:"Draft"},{id:2,col1:"CT0002",col2:"Thu",col3:"02/02/2026",col4:"6.200.000 đ",status:"Posted"}],"quy-tac":[{id:1,col1:"RULE-01",col2:"Sửa dữ liệu",col3:"Không cho sửa chứng từ đã khóa",col4:"Mức khóa: theo tháng",status:"Bật"},{id:2,col1:"RULE-02",col2:"Nhập liệu",col3:"Không cho tổng Nợ/Có lệch",col4:"Sai lệch cho phép: 0",status:"Bật"}],"kiem-tra":[{id:1,col1:"19/02/2026",col2:"Công ty ABC",col3:"Sổ nhật ký chung",col4:"Thiếu tài khoản đối ứng",status:"Chưa xử lý"},{id:2,col1:"20/02/2026",col2:"Kho vật tư",col3:"Báo cáo tồn kho",col4:"Tồn kho âm cần đối chiếu",status:"Đang xử lý"}],"tong-quan":[{id:1,col1:"Tổng phát sinh Nợ",col2:"Phát sinh",col3:"02/2026",col4:"8.500.000.000 đ",status:"Đã chốt"},{id:2,col1:"Tổng phải thu",col2:"Công nợ",col3:"02/2026",col4:"2.100.000.000 đ",status:"Theo dõi"}]},le=({config:s,rows:a,onRowsChange:l})=>{const[u,o]=c.useState(!1),[x,g]=c.useState(null),[d,m]=c.useState({col1:"",col2:"",col3:"",col4:"",status:""}),N=x?"Cập nhật bản ghi":"Tạo bản ghi mới",y=c.useMemo(()=>!d.col1.trim()||!d.status.trim(),[d.col1,d.status]),i=()=>{o(!1),g(null),m({col1:"",col2:"",col3:"",col4:"",status:""})},j=()=>{g(null),m({col1:"",col2:"",col3:"",col4:"",status:"Active"}),o(!0)},p=t=>{g(t.id),m({col1:t.col1,col2:t.col2,col3:t.col3,col4:t.col4,status:t.status}),o(!0)},S=()=>{if(!y){if(x)l(t=>t.map(n=>n.id===x?{...n,...d}:n));else{const t=a.length?Math.max(...a.map(n=>n.id))+1:1;l(n=>[...n,{id:t,...d}])}i()}},q=t=>{const n=Number(t);Number.isNaN(n)||l(f=>f.filter(w=>w.id!==n))},b=s.columns.reduce((t,n)=>(t[n.key]=n.label,t),{});return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3",children:[e.jsx("p",{className:"text-sm text-slate-500",children:s.description}),e.jsx("button",{onClick:j,className:"bg-teal-500 text-white rounded-lg px-4 py-2 text-sm font-semibold",children:s.addLabel})]}),e.jsx("div",{className:"overflow-x-auto bg-white rounded-2xl border border-slate-100 shadow-sm",children:e.jsxs("table",{className:"w-full text-sm text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-slate-400 text-xs border-b",children:[e.jsx("th",{className:"py-3 px-3",children:"STT"}),s.columns.map(t=>e.jsx("th",{className:"py-3 px-3",children:t.label},t.key)),e.jsx("th",{className:"py-3 px-3 text-center",children:"Thao tác"})]})}),e.jsxs("tbody",{children:[a.map((t,n)=>e.jsxs("tr",{className:"border-b last:border-0",children:[e.jsx("td",{className:"py-3 px-3 text-slate-700",children:n+1}),s.columns.map(f=>e.jsx("td",{className:"py-3 px-3 text-slate-700",children:t[f.key]},`${t.id}-${f.key}`)),e.jsx("td",{className:"py-3 px-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>p(t),className:"inline-flex items-center justify-center w-8 h-8 rounded-md border border-slate-200 text-slate-600 hover:bg-slate-50",title:"Sửa",children:e.jsx(te,{fontSize:"small"})}),e.jsx(Z,{text:"bản ghi này",elId:t.id,onDelete:q})]})})]},t.id)),a.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"py-6 px-3 text-center text-slate-500",colSpan:s.columns.length+2,children:"Chưa có dữ liệu"})})]})]})}),e.jsx(ee,{title:N,open:u,onOk:S,onCancel:i,okText:x?"Cập nhật":"Tạo mới",cancelText:"Hủy",okButtonProps:{disabled:y},children:e.jsxs("div",{className:"grid grid-cols-1 gap-3 pt-2",children:[e.jsxs("label",{className:"text-sm text-slate-600",children:[b.col1,e.jsx("input",{value:d.col1,onChange:t=>m(n=>({...n,col1:t.target.value})),className:"w-full border border-slate-200 rounded-lg px-3 py-2 mt-1"})]}),e.jsxs("label",{className:"text-sm text-slate-600",children:[b.col2,e.jsx("input",{value:d.col2,onChange:t=>m(n=>({...n,col2:t.target.value})),className:"w-full border border-slate-200 rounded-lg px-3 py-2 mt-1"})]}),e.jsxs("label",{className:"text-sm text-slate-600",children:[b.col3,e.jsx("input",{value:d.col3,onChange:t=>m(n=>({...n,col3:t.target.value})),className:"w-full border border-slate-200 rounded-lg px-3 py-2 mt-1"})]}),e.jsxs("label",{className:"text-sm text-slate-600",children:[b.col4,e.jsx("input",{value:d.col4,onChange:t=>m(n=>({...n,col4:t.target.value})),className:"w-full border border-slate-200 rounded-lg px-3 py-2 mt-1"})]}),e.jsxs("label",{className:"text-sm text-slate-600",children:[b.status,e.jsx("input",{value:d.status,onChange:t=>m(n=>({...n,status:t.target.value})),className:"w-full border border-slate-200 rounded-lg px-3 py-2 mt-1"})]})]})})]})},ie=()=>{const[s,a]=c.useState(H[0].key),[l,u]=c.useState(_["tai-khoan"]),[o,x]=c.useState(_["chung-tu"]),[g,d]=c.useState(_["quy-tac"]),[m,N]=c.useState(_["kiem-tra"]),[y,i]=c.useState(_["tong-quan"]),j={"tai-khoan":[l,u],"chung-tu":[o,x],"quy-tac":[g,d],"kiem-tra":[m,N],"tong-quan":[y,i]};return e.jsx("div",{className:"w-full flex flex-col gap-6 pb-10",children:e.jsxs("section",{className:"bg-white/90 rounded-2xl shadow-md border border-slate-100 p-6",children:[e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-teal-600",children:"Nhập liệu kế toán"}),e.jsx("div",{className:"text-sm text-slate-500",children:"Các tab bên dưới hỗ trợ thêm, sửa, xóa dữ liệu thủ công bằng modal."})]})}),e.jsx("div",{className:"flex flex-wrap gap-2 border-b border-slate-200 mb-4",children:H.map(p=>e.jsx("button",{onClick:()=>a(p.key),className:`px-4 py-2 text-sm font-semibold rounded-t-lg border border-b-0 ${s===p.key?"bg-teal-50 text-teal-600 border-teal-200":"bg-white text-slate-500 border-transparent"}`,children:p.label},p.key))}),s==="bang-luong"&&e.jsx(se,{}),s!=="bang-luong"&&O[s]&&e.jsx(le,{config:O[s],rows:j[s][0],onRowsChange:j[s][1]})]})})};export{ie as default};
