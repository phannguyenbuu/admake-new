import{r as a,s as e,Q as z,q as V,V as Le,X as H,v as L,Y as E,Z as Ie,R as Y,$ as me,S as T,a0 as Ne,a1 as _e,p as fe,a2 as xe,a3 as ze,a4 as Ue,t as ce,O as Ye,z as He,E as Je,A as Ke,G as Ve,H as Ge,J as qe,K as Xe,U as Qe,P as Ze,L as Ee,M as et}from"./index-DwiI2IhC.js";import{C as J}from"./TitlePanel-eEfI5l9A.js";import{B as R}from"./Button-CdbztWtG.js";import{T as tt,a as nt,b as le,c as $,d as ot}from"./TableRow-CeqF3v0U.js";import{T as st,C as de}from"./TableHead-Dw0Hu1W6.js";import{M as at,a as rt}from"./Add-19pJME5G.js";import{g as it,J as ct}from"./Managerment-DrLHxmhB.js";import{J as he,L as pe,A as je,D as Z}from"./JobAsset-CpQQT6M4.js";import{I as lt}from"./index-udfmYiN-.js";import"./useUpdateButtonTask-DAS3BaAS.js";import{T as dt,a as ue}from"./Tabs-n6Qg6r42.js";import{T as K}from"./Send-kh9MbFaG.js";import{S as ht}from"./SalaryBoard-Curg_1a7.js";import"./DeleteConfirm-B-vFUD1g.js";import"./index-CW0pHrm9.js";import"./Popper-DWsuAb0h.js";const ut=()=>new Date().toLocaleString("vi-VN",{weekday:"long",year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),gt=()=>{const[t,o]=a.useState(new Date);return a.useEffect(()=>{const n=setInterval(()=>{o(new Date)},1e3);return()=>clearInterval(n)},[]),e.jsx(J,{children:e.jsxs(z,{variant:"body1",children:[ut()," "]})})},mt=[{key:"morning",label:"Sáng"},{key:"noon",label:"Chiều"},{key:"evening",label:"Tối"}];function ft(){const t=new Date,o=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${o}-${n}-${s}`}function xt({workpoint:t,fetchWorkpoint:o}){const n={maxHeight:15,fontSize:14,fontWeight:700,whiteSpace:"nowrap",maxWidth:60},[s,y]=a.useState(!1),{userId:g,userLeadId:f}=V(),[c,h]=a.useState(!1),p=()=>{h(!0)},D=async()=>{h(!1),y(!0);try{const m=`${L()}/workpoint/remove/${t==null?void 0:t.user_id}/?day=${ft()}`,b=await fetch(m,{method:"PUT"});if(!b.ok)throw new Error(`Network error: ${b.status}`);const d=await b.json();return o(),d}catch(m){throw console.error("Fetch error:",m),m}};return e.jsxs(e.Fragment,{children:[t&&!s&&e.jsxs(R,{sx:{borderRadius:10,border:"1px solid orange",color:"orange",mt:.5,height:30,maxWidth:300,mb:1},onClick:p,children:[e.jsx("img",{src:"/remove-bookmark-svgrepo-com.svg",alt:"ADMAKE",style:{width:20}}),"Xóa điểm danh gần nhất"]}),e.jsx(tt,{component:Le,sx:{maxWidth:800,minHeight:250,gap:5,background:"none"},children:e.jsxs(nt,{children:[e.jsx(st,{children:e.jsxs(le,{sx:n,children:[e.jsx($,{sx:n,children:"Buổi"}),e.jsx($,{sx:n,children:"Vào"}),e.jsx($,{sx:n,children:"Ra"}),e.jsx($,{sx:n,children:"Số giờ"})]})}),e.jsx(ot,{children:t&&t.checklist&&mt.map(({key:m,label:b})=>{var l,M,O,x;let d=null;if(m==="morning"||m==="noon"||m==="evening"){const v=m;d=(l=t==null?void 0:t.checklist)==null?void 0:l[v]}return e.jsxs(le,{sx:{height:60},children:[e.jsx($,{sx:n,children:b}),e.jsx($,{sx:n,children:(M=d==null?void 0:d.in)!=null&&M.time?e.jsx(H,{sx:{background:"#00B4B6",p:1,borderRadius:2},children:new Date(d.in.time).toLocaleTimeString()}):"---"}),e.jsx($,{sx:n,children:(O=d==null?void 0:d.out)!=null&&O.time?e.jsx(H,{sx:{background:"#00B4B6",p:1,borderRadius:2},children:new Date(d.out.time).toLocaleTimeString()}):"---"}),e.jsx($,{sx:n,children:(x=d==null?void 0:d.out)!=null&&x.time&&(d==null?void 0:d.workhour)!==void 0?d.workhour.toFixed(2):"---"})]},m)})})]})}),e.jsx(at,{title:"Bạn có chắc muốn xóa điểm danh ?",open:c,onOk:D,onCancel:()=>h(!1)})]})}const pt=E(e.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"})),jt=E(e.jsx("path",{d:"M17.77 3.77 16 2 6 12l10 10 1.77-1.77L9.54 12z"})),yt=E(e.jsx("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"})),{TextArea:St}=lt,wt=async t=>{const o=await fetch(`${L()}/task/${t}/by_user`);if(!o.ok)throw new Error(`Error fetching tasks for user ${t}`);const n=await o.json();return console.log("taskk",n.data),n.data},kt=()=>fe({mutationFn:wt}),vt=({userId:t,fullName:o,open:n,onCancel:s})=>{const[y,g]=a.useState("task"),{mutate:f,data:c,isPending:h,isError:p,error:D}=kt(),{isMobile:m,notifyAdmin:b,generateDatetimeId:d}=V(),{taskDetail:l,setTaskDetail:M}=Ie(),O=()=>{const u={id:d(),user_id:t,type:"task",description:l==null?void 0:l.workspace_id,text:`<${l==null?void 0:l.workspace}/${l==null?void 0:l.title}> hoàn thành. Vui lòng chuyển trạng thái !`,target:`/dashboard/work-tables/${l==null?void 0:l.workspace_id}`};console.log("Note",u),b(u)};a.useEffect(()=>{t&&f(t)},[]);const[x,v]=Y.useState(1),I=1,P=c&&c.length>0?c.slice((x-1)*I,x*I):[],k=c?Math.ceil(c.length/I):1;a.useEffect(()=>{c&&c.length>0&&M(c[x-1]||c[0])},[x,c]);const B={color:"#fff",padding:10,paddingLeft:30,paddingRight:30,backgroundColor:"#00B5B4",whiteSpace:"nowrap",borderRadius:10};return e.jsx(me,{open:n,onCancel:s,footer:null,children:e.jsxs(J,{children:[e.jsxs("div",{style:{marginTop:0,display:"flex",justifyContent:"center",alignItems:"center",gap:16},children:[e.jsx("button",{onClick:()=>v(u=>Math.max(u-1,1)),disabled:x===1,children:e.jsx(jt,{fontSize:"small"})}),e.jsxs("span",{children:["Trang ",x," / ",k]}),e.jsx("button",{onClick:()=>v(u=>Math.min(u+1,k)),disabled:x===k,children:e.jsx(yt,{fontSize:"small"})})]}),e.jsx(T,{spacing:5,py:2,alignItems:"flex-start",justifyContent:"flex-start",style:{boxSizing:"border-box"},children:P.length>0?P.map(u=>e.jsxs(T,{spacing:1,style:{background:"#ddd",padding:10,borderRadius:20,width:m?340:""},children:[e.jsxs(T,{direction:"row",spacing:1,children:[e.jsxs(R,{style:B,onClick:O,children:[e.jsx(pt,{}),it((u==null?void 0:u.status)??"")]}),u.workspace&&e.jsxs(T,{direction:"column",children:[e.jsx(z,{style:{marginTop:8,fontStyle:"italic",color:"#00B5B4",fontSize:10,fontWeight:500},children:u==null?void 0:u.workspace}),e.jsx(z,{style:{marginTop:8,fontStyle:"italic",color:"#00B5B4",fontSize:10,fontWeight:500},children:l==null?void 0:l.title})]})]}),e.jsx(St,{readOnly:!0,value:u==null?void 0:u.description,rows:3,showCount:!0,maxLength:1e3,placeholder:"Mô tả chi tiết về công việc cần thực hiện...",className:"!rounded-lg !border !border-gray-300 focus:!border-cyan-500 focus:!shadow-lg hover:!border-cyan-500 !transition-all !duration-200 !shadow-sm !resize-none !text-xs sm:!text-sm h-40"}),(l==null?void 0:l.icon)&&e.jsx(Ne,{src:`${_e()}/${l.icon}`,alt:"Task icon",sx:{width:100,height:70,borderRadius:0}}),e.jsx(ct,{form:null},u.id),e.jsx(rt,{activeKey:y,onChange:G=>g(G),items:[{key:"task",label:"Tài Liệu",children:e.jsx(he,{title:"Tài liệu",type:"task",readOnly:!0})},{key:"comments",label:"Bình luận",children:e.jsx(he,{title:"Bình luận cho mọi người",type:"comment"})}]})]},u.id)):e.jsx(z,{style:{fontStyle:"italic",textAlign:"center"},children:"Chưa có nhiệm vụ"})})]})})};function bt({value:t,onChange:o,checkedMorning:n,checkedAfternoon:s,onCheckMorning:y,onCheckAfternoon:g}){const[f,c]=a.useState(!1),h=p=>{o(p),c(!1)};return e.jsxs(pe,{dateAdapter:je,children:[e.jsx(Z,{label:"Ngày xin nghỉ",open:f,onOpen:()=>c(!0),onClose:()=>c(!1),value:t,onChange:h,enableAccessibleFieldDOMStructure:!1,format:"DD/MM/YYYY",slots:{textField:K},slotProps:{textField:{variant:"outlined",size:"small"}},disablePast:!0}),e.jsxs(T,{direction:"row",spacing:2,mt:1,children:[e.jsx(de,{checked:n,onChange:p=>y(p.target.checked)}),e.jsx("span",{style:{marginTop:10},children:"Sáng"}),e.jsx(de,{checked:s,onChange:p=>g(p.target.checked)}),e.jsx("span",{style:{marginTop:10},children:"Chiều"})]})]})}function Ct({startValue:t,endValue:o,onStartChange:n,onEndChange:s}){const y=t&&o?o.startOf("day").diff(t.startOf("day"),"day")+1:0,[g,f]=a.useState(!1),[c,h]=a.useState(!1),p=m=>{n(m),f(!1)},D=m=>{s(m),h(!1)};return e.jsxs(pe,{dateAdapter:je,children:[e.jsxs(T,{direction:"column",spacing:2,children:[e.jsx(Z,{label:"Ngày bắt đầu",open:g,onOpen:()=>f(!0),onClose:()=>f(!1),value:t,onChange:p,enableAccessibleFieldDOMStructure:!1,slots:{textField:K},slotProps:{textField:{variant:"outlined",size:"small"}},disablePast:!0}),e.jsx(Z,{label:"Ngày kết thúc",open:c,onOpen:()=>h(!0),onClose:()=>h(!1),value:o,onChange:D,enableAccessibleFieldDOMStructure:!1,slots:{textField:K},slotProps:{textField:{variant:"outlined",size:"small"}},disablePast:!0,minDate:t??void 0})]}),e.jsxs("div",{style:{marginTop:12},children:["Số ngày nghỉ: ",e.jsx("strong",{children:y>0?y:0})]})]})}const Tt=async t=>{const o=await fetch(`${L()}/leave/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o.ok)throw new Error("Failed to create leave request");return o.json()},Dt=({userId:t,open:o,onCancel:n})=>{const[s,y]=a.useState("oneDay"),{notifyAdmin:g,fullName:f}=V(),[c,h]=a.useState(null),[p,D]=a.useState(!0),[m,b]=a.useState(!0),[d,l]=a.useState(""),[M,O]=a.useState(null),[x,v]=a.useState(null),I=fe({mutationFn:Tt,onSuccess:()=>{g({text:"Nhân sự xin nghỉ phép",description:f??"",target:"/dashboard/workpoints"}),n()},onError:k=>{console.error("Lỗi khi tạo yêu cầu nghỉ phép:",k.message)}}),P=()=>{if(!t)return;let k=null,B=null;if(s==="oneDay"){if(!c)return;const u=c.format("YYYY-MM-DD");k=u,B=u}else{if(!M||!x)return;k=M.format("YYYY-MM-DD"),B=x.format("YYYY-MM-DD")}I.mutate({user_id:t,start_time:k,end_time:B,morning:p,noon:m,reason:d})};return e.jsx(me,{open:o,onCancel:n,style:{padding:20},okButtonProps:{style:{display:"none"}},cancelButtonProps:{style:{display:"none"}},children:e.jsxs(T,{children:[e.jsxs(dt,{value:s,onChange:(k,B)=>y(B),"aria-label":"Chọn loại nghỉ phép",centered:!0,children:[e.jsx(ue,{label:"1 ngày",value:"oneDay"}),e.jsx(ue,{label:"nhiều ngày",value:"multiDays"})]}),e.jsxs("div",{style:{marginTop:20},children:[s==="oneDay"&&e.jsx(bt,{value:c,onChange:h,checkedMorning:p,checkedAfternoon:m,onCheckMorning:D,onCheckAfternoon:b}),s==="multiDays"&&e.jsx(Ct,{startValue:M,endValue:x,onStartChange:O,onEndChange:v})]}),e.jsx(K,{label:"Lý do xin nghỉ",value:d,onChange:k=>l(k.target.value),multiline:!0,rows:3,variant:"outlined",fullWidth:!0,margin:"normal",placeholder:"Nhập lý do xin nghỉ..."}),e.jsx(R,{fullWidth:!0,style:{marginTop:20,borderRadius:10,backgroundColor:"#00B4B6",color:"#fff"},onClick:P,disabled:s==="oneDay"&&!c||s==="multiDays"&&(!M||!x),children:"Tạo yêu cầu nghỉ phép"})]})})};function ge(t,o){const n=t.getContext("2d");if(!n)return;const s=t.height/1080,y=t.height;n.fillStyle="red",n.font=`${s*150}px Oswald`;const g=s*50,f=y-s*200;n.fillText((o==null?void 0:o[1])||"",g,f),n.font=`${s*50}px Poppins`,n.fillStyle="white",n.fillText((o==null?void 0:o[0])||"",g,f+s*80),n.font=`${s*20}px Arial`,n.fillStyle="#333",n.fillText((o==null?void 0:o[2])||"",g+s*400,f+s*80),n.fillText((o==null?void 0:o[3])||"",g+s*600,f+s*80)}const Mt=({userEl:t})=>{const o=a.useRef(null),n=a.useRef(null),[s,y]=a.useState({latitude:null,longitude:null}),[g,f]=a.useState(null),[c,h]=a.useState("environment"),[p,D]=a.useState(null),[m,b]=a.useState(null),[d,l]=a.useState(""),[M,O]=a.useState(""),[x,v]=a.useState(1),[I,P]=a.useState(!1),[k,B]=a.useState(null),[u,G]=a.useState(!0),[ee,N]=a.useState(null),[ye,q]=a.useState((t==null?void 0:t.role)&&(t==null?void 0:t.role_id)>100),[Se,te]=a.useState(!1),[we,ne]=a.useState(!1),{workpointEl:ke,fetchWorkpointEl:ve}=xe(),[be,oe]=a.useState(!1),{userLeadId:Ce,setUserLeadId:Te,setUserId:De}=V();a.useEffect(()=>{console.log("UserEL",t),t&&t!=null&&t.id&&(Ce===0&&Te(t.lead_id),ve(t.id),De(t==null?void 0:t.id))},[t]);const Me=()=>{oe(!1)},se=ze();a.useEffect(()=>{const r=window.location.href;if(r.includes("?zarsrc")){const i=r.split("?zarsrc")[0];se.pathname+se.search!==new URL(i).pathname+new URL(i).search&&(window.location.href=i)}},[]);function X(){fetch(`${L()}/workpoint/today/${t==null?void 0:t.id}`).then(r=>{if(!r.ok)throw new Error(`HTTP error! Status: ${r.status}`);return r.json()}).then(r=>{B(r),console.log(r),N(null)}).catch(r=>{N(r.message),B(null)}).finally(()=>{G(!1)})}a.useEffect(()=>{navigator.mediaDevices.enumerateDevices().then(i=>{const C=i.filter(j=>j.kind==="videoinput");ne(C.length>0)}).catch(()=>ne(!1));const r=JSON.parse(localStorage.getItem("Admake-User-Access")||"{}");console.log(r.user_id,r.username),X()},[]),a.useEffect(()=>((async()=>{try{g&&g.getTracks().forEach(C=>C.stop());const i=await navigator.mediaDevices.getUserMedia({video:{facingMode:c}});f(i),o.current&&(o.current.srcObject=i)}catch(i){N("Lỗi truy cập camera: "+i.message)}})(),()=>{g&&g.getTracks().forEach(i=>i.stop())}),[c,x]);const ae=()=>{if(!navigator.geolocation){N("Trình duyệt không hỗ trợ định vị GPS");return}navigator.geolocation.getCurrentPosition(r=>{y({latitude:r.coords.latitude,longitude:r.coords.longitude}),l(`Vị trí: ${r.coords.latitude.toFixed(6)}, ${r.coords.longitude.toFixed(6)}`),N(null)},r=>N("Lỗi lấy vị trí:"+r.message),{enableHighAccuracy:!0})},re=()=>{var j,w;const r=new Date,i=r.toLocaleDateString(),C=r.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return[i,C,((j=s.latitude)==null?void 0:j.toString())??"-",((w=s.longitude)==null?void 0:w.toString())??"-"]},Be=()=>{const r=o.current,i=n.current;if(!we||!i||!r){console.log("Không có camera, tạo canvas đen 480x640");const j=n.current,w=480,W=640;j.width=w,j.height=W;const A=j.getContext("2d");if(!A)return;A.fillStyle="black",A.fillRect(0,0,w,W),ge(j,re()),j.toBlob(_=>{D(_),_&&(console.log("Tạo url từ blob để hiển thị hoặc gửi đi!"),b(URL.createObjectURL(_)))},"image/jpeg",.95),P(!0),ae(),v(2);return}if(!i)return;i.width=r.videoWidth,i.height=r.videoHeight;const C=i.getContext("2d");C&&(C.drawImage(r,0,0,i.width,i.height),ge(i,re()),i.toBlob(j=>{D(j),j&&b(URL.createObjectURL(j))},"image/jpeg",.95),P(!0),ae(),v(2))};async function Ae(r,i,C){const j=`${L()}/workpoint/check/${t==null?void 0:t.id}/`;try{const w=await fetch(j,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({img:r,lat:i,long:C})});if(!w.ok)throw new Error(`HTTP error! status: ${w.status}`);const W=await w.json();return console.log("Response data:",W),W}catch(w){throw console.error("Fetch error:",w),w}}const Re=()=>{v(1),P(!1)},Pe=async()=>{var _,ie;if(console.log("handleSend",p),!p)return;let r="0",i="0";const w=(S=>{const F=Q=>Q<10?"0"+Q:Q;return S.getFullYear().toString()+F(S.getMonth()+1)+F(S.getDate())+"_"+F(S.getHours())+F(S.getMinutes())+F(S.getSeconds())})(new Date);r=s.latitude?s.latitude.toFixed(6):"-",i=s.longitude?s.longitude.toFixed(6):"-";const W=`workpoint_${t==null?void 0:t.id}_${w}_${r}_${i}.jpg`,A=new FormData;A.append("latitude",((_=s.latitude)==null?void 0:_.toString())??""),A.append("longitude",((ie=s.longitude)==null?void 0:ie.toString())??""),A.append("time",w),A.append("file",p,W),fetch(`${L()}/message/upload`,{method:"POST",body:A}).then(S=>{if(!S.ok)throw new Error(`HTTP error! status: ${S.status}`);return S.json()}).then(S=>{console.log(S.data.file_url,S.data.link);const F=S.data.file_url;Ae(F,r,i),setTimeout(()=>{ce.success({message:"Đã gửi thành công!"}),v(1),q(!0),X()},1e3)}).catch(S=>{ce.error({message:"Lỗi upload ảnh: "+S.message})}),D(null)},$e=()=>{q(!1),v(1)},Oe=()=>{te(!1),v(1)},We=()=>{q(!0)},Fe=()=>{te(!0)},U=(t==null?void 0:t.role_id)&&(t==null?void 0:t.role_id)>100;return e.jsxs(T,{p:1,height:"100vh",spacing:1,children:[e.jsxs(T,{direction:"row",spacing:0,style:{width:"90vw",marginLeft:10},children:[e.jsx(Ue,{}),e.jsx(H,{style:{width:"50vw",fontWeight:500,marginTop:10,marginLeft:20},children:t==null?void 0:t.fullName})]}),x===1&&e.jsx(e.Fragment,{children:e.jsxs(J,{children:[!U&&e.jsxs(e.Fragment,{children:[e.jsx(gt,{}),e.jsxs(R,{variant:"contained",sx:{backgroundColor:"orange",borderRadius:20,mt:1,height:50,maxWidth:300,mb:1},onClick:Be,children:[e.jsx("img",{src:"/alarm-svgrepo-com.svg",alt:"ADMAKE",style:{width:40}}),"Điểm danh nhé !"]}),e.jsx(xt,{workpoint:k,fetchWorkpoint:X})]}),e.jsxs(T,{direction:"row",spacing:1,p:1,children:[!U&&e.jsx(e.Fragment,{children:e.jsxs(R,{variant:"contained",sx:{borderRadius:40,backgroundColor:"#00B4B6",fontSize:10,whiteSpace:"nowrap",mt:1,height:50,maxWidth:300,mb:1},onClick:Fe,children:[e.jsx("img",{src:"/holiday-island-tourism-svgrepo-com.svg",alt:"ADMAKE",style:{width:32}}),"Nghỉ phép"]})}),e.jsxs(R,{variant:"contained",sx:{borderRadius:40,backgroundColor:"#00B4B6",fontSize:10,textAlign:"left",whiteSpace:"nowrap",mt:1,height:50,maxWidth:300,mb:1},onClick:We,children:[e.jsx("img",{src:"/task-done-svgrepo-com.svg",alt:"ADMAKE",style:{width:32}}),"Nhiệm vụ"]}),!U&&e.jsxs(R,{sx:{borderRadius:40,color:"#fff",fontSize:10,backgroundColor:"#00B4B6",textAlign:"left",whiteSpace:"nowrap",mt:1,height:50,maxWidth:300,mb:1},onClick:()=>oe(!0),children:[e.jsx("img",{src:"/pay-svgrepo-com.svg",alt:"ADMAKE",style:{width:32}}),"Bảng lương"]})]}),!U&&e.jsx("video",{ref:o,width:"100%",height:"auto",autoPlay:!0,playsInline:!0,style:{borderRadius:8,backgroundColor:"#000",width:"100%",maxWidth:400}})]})}),x===2&&e.jsxs(e.Fragment,{children:[e.jsxs(J,{children:[e.jsxs(H,{sx:{textAlign:"center",mt:1},children:[m&&e.jsx("img",{src:m,alt:"Ảnh đã chụp",style:{maxWidth:"100%",borderRadius:8,height:"60vh"}}),s.latitude&&s.longitude&&e.jsx(z,{sx:{mt:1},children:d})]}),ee&&e.jsx(z,{color:"error",sx:{mt:1},children:ee})]}),e.jsxs(T,{spacing:2,direction:"row",sx:{position:"fixed",bottom:50,left:"50%",transform:"translateX(-50%)"},children:[e.jsx(R,{onClick:Pe,variant:"contained",sx:{backgroundColor:"#00B4B6"},children:"Gửi"}),e.jsx(R,{onClick:Re,children:"Chụp lại"})]})]}),e.jsx("canvas",{ref:n,style:{display:"none"}}),e.jsx(vt,{open:ye,userId:t==null?void 0:t.id,fullName:t==null?void 0:t.fullName,onCancel:$e}),!U&&e.jsx(Dt,{open:Se,userId:t==null?void 0:t.id,onCancel:Oe}),e.jsx(ht,{selectedRecord:ke,modalVisible:be,handleOk:Me})]})},Bt=()=>{const{id:t}=Ye(),{workpointEl:o}=xe(),[n,s]=Y.useState(null),[y,g]=Y.useState(!1),[f,c]=Y.useState(!0);return Y.useEffect(()=>{t&&fetch(`${L()}/workpoint/check-access/${t}`).then(h=>{if(h.status===401||h.status===403)throw window.location.href="/login",new Error("Unauthorized");return h.json()}).then(h=>{console.log(h),h.valid?(g(!0),s(h.data),localStorage.setItem("Admake-User-Access",JSON.stringify({user_id:h.data.id,username:h.data.fullName}))):(g(!1),window.location.href="/login"),c(!1)}).catch(()=>{g(!1),c(!1)})},[t]),f?e.jsx("div",{children:"Loading...Workpoint"}):y?e.jsx(Mt,{userEl:n}):e.jsx("div",{children:"Access denied or invalid token"})},At={path:"/",element:e.jsx(Ke,{children:e.jsx(Ve,{children:e.jsx(Ge,{children:e.jsx(qe,{})})})}),errorElement:e.jsx(Je,{}),children:[{path:"/point/:id/",element:e.jsx(Bt,{}),title:"Workpoint",ignoreInMenu:!0}]},Rt=He([At],{});Xe.createRoot(document.getElementById("root")).render(e.jsx(Qe,{children:e.jsx(Ze,{children:e.jsx(Ee,{fallbackElement:e.jsx(et,{}),future:{v7_startTransition:!0},router:Rt})})}));
